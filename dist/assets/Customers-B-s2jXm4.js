import{r as a,u as ue,p as e,s as n,D as me,B as pe,M as r}from"./index-Bq7SEXuf.js";import{I as fe,i as f,R as he}from"./axios-GhlsiOT5.js";import{B as xe,F as ge,N as je,R as ve}from"./FollowUpDrawer-BkBDsWyG.js";import{R as we,E as Ce}from"./jspdf.es.min-zBOFm9dL.js";import ye from"./html2canvas.esm-CBrSDip1.js";import{C as Ie}from"./index-C_L1RLLK.js";import{T as Se,a as h}from"./index-SmLCrNGy.js";import{a as be}from"./index-BOPJqWeZ.js";import{T as G}from"./index-CbdXlDe3.js";import{F as B,R as Ne}from"./Table-Bf67WVZ7.js";import{E as M}from"./index-gpSYoz0o.js";import{M as U}from"./index-D0lY9ADb.js";import{R as De}from"./moment-CYyrXtnG.js";import{R as Fe}from"./MessageOutlined-DEnj2zof.js";import{R as Ae}from"./DeleteOutlined-DFLVsPO1.js";import"./index-BnkNshhY.js";import"./index-DadFFg_X.js";import"./context-B8wIWz00.js";import"./index-DF_iAJZB.js";import"./index-Dsy7Z7ff.js";import"./index-46gWX4pY.js";import"./index-JPHp6_-t.js";import"./index-BMaUSiUl.js";const{Title:Te}=Se,{TabPane:W}=G,tt=()=>{const[b,H]=a.useState(""),[O,K]=a.useState("active"),[q,N]=a.useState([]),[x,l]=a.useState(!1),[z,w]=a.useState(!1),[i,D]=a.useState(null),[Y,C]=a.useState(!1),[p,J]=a.useState(null),[F,Q]=a.useState(null),[X,y]=a.useState(!1),[d,A]=a.useState(null),[Z,T]=a.useState(!1),[ee,R]=a.useState(!1),[g,_]=a.useState(null),te=ue(),m=()=>{l(!0),f.get("/api/accounts/customers").then(t=>{const s=Array.isArray(t.data)?t.data:[];N(s),n.success("Customers loaded")}).catch(()=>{n.error("Failed to load customers"),N([])}).finally(()=>l(!1))};a.useEffect(()=>{m()},[]);const se=t=>{D(t),w(!0)},ae=t=>{l(!0),(i!=null&&i._id?f.put(`/api/accounts/${i._id}`,t):f.post("/api/accounts",t)).then(()=>{n.success(`Customer ${i!=null&&i._id?"updated":"created"} successfully`),m()}).catch(()=>{n.error(`Failed to ${i!=null&&i._id?"update":"create"} customer`)}).finally(()=>{w(!1),D(null),l(!1)})},$=(t,s)=>{J(s),Q(t?"Active":"Inactive"),C(!0)},oe=()=>{l(!0);const t={...p,status:F};f.put(`/api/accounts/${p._id}`,t).then(()=>{n.success("Status updated"),m()}).catch(()=>{n.error("Failed to update status")}).finally(()=>{C(!1),l(!1)})},ne=t=>{A(t),y(!0)},ie=()=>{d!=null&&d._id&&(l(!0),f.delete(`/api/accounts/${d._id}`).then(()=>{n.success("Customer deleted successfully"),m()}).catch(()=>{n.error("Failed to delete customer")}).finally(()=>{y(!1),A(null),l(!1)}))},re=t=>{_(t),T(!0)},le=t=>{_(t),R(!0)},ce=t=>{te(`/customers/${t._id}`)},de=async t=>{const s=document.getElementById(`customer-pdf-content-${t._id}`);if(!s){n.error("PDF content not found. Please ensure the customer details are rendered when generating PDF.");return}n.loading("Generating PDF...",{id:"pdf-toast"});try{const o=await ye(s,{scale:2}),c=o.toDataURL("image/png"),u=new Ce("p","mm","a4"),I=210,L=297,j=o.height*I/o.width;let v=j,S=0;for(u.addImage(c,"PNG",0,S,I,j),v-=L;v>=0;)S=v-j,u.addPage(),u.addImage(c,"PNG",0,S,I,j),v-=L;u.save(`${t.businessName}-details.pdf`),n.success("PDF generated!",{id:"pdf-toast"})}catch(o){console.error("Error generating PDF:",o),n.error("Failed to generate PDF.",{id:"pdf-toast"})}},P=q.filter(t=>{var o,c,u;const s=b.toLowerCase();return((o=t.businessName)==null?void 0:o.toLowerCase().includes(s))||((c=t.contactName)==null?void 0:c.toLowerCase().includes(s))||((u=t.email)==null?void 0:u.toLowerCase().includes(s))}),k=P.filter(t=>t.status==="Active"),V=P.filter(t=>t.status==="Inactive"),E=[{title:"Sno.",render:(t,s,o)=>o+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName",responsive:["md","lg"]},{title:"Email Id",dataIndex:"email",responsive:["lg"]},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(h,{color:"red",children:"Hot"});case"Warm":return e.jsx(h,{color:"orange",children:"Warm"});case"Cold":return e.jsx(h,{color:"blue",children:"Cold"});default:return e.jsx(h,{children:"Unknown"})}},responsive:["md","lg"]},{title:"Latest Note",render:(t,s)=>{var c;const o=(c=s.notes)==null?void 0:c[s.notes.length-1];return o?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:o.timestamp}),e.jsx("br",{}),o.text]}):e.jsx("em",{children:"No notes"})},responsive:["lg"]},{title:"Status",render:(t,s)=>e.jsx(h,{color:s.status==="Active"?"green":"red",children:s.status}),responsive:["sm","md","lg"]},{title:"Actions",width:80,render:(t,s)=>e.jsx(me,{overlay:e.jsxs(r,{children:[e.jsx(r.Item,{icon:e.jsx(Ne,{}),onClick:()=>se(s),children:"Edit Customer"},"edit"),e.jsx(r.Item,{icon:e.jsx(Fe,{}),onClick:()=>re(s),children:"View/Add Notes"},"notes"),e.jsx(r.Item,{icon:e.jsx(ve,{}),onClick:()=>le(s),children:"View/Add Follow-ups"},"followups"),e.jsx(r.Item,{icon:e.jsx(he,{}),onClick:()=>ce(s),children:"View Profile"},"view-profile"),e.jsx(r.Item,{icon:e.jsx(we,{}),onClick:()=>de(s),children:"Generate PDF"},"generate-pdf"),s.status==="Active"?e.jsx(r.Item,{onClick:()=>$(!1,s),children:"Change to Inactive"},"change-to-inactive"):e.jsx(r.Item,{onClick:()=>$(!0,s),children:"Change to Active"},"change-to-active"),e.jsx(r.Item,{icon:e.jsx(Ae,{}),danger:!0,onClick:()=>ne(s),children:"Delete Customer"},"delete")]}),trigger:["click"],children:e.jsx(pe,{icon:e.jsx(De,{})})})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(Ie,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,flexWrap:"wrap",gap:"10px"},children:[e.jsx(Te,{level:4,children:"Customers"}),e.jsx(fe,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(be,{}),value:b,onChange:t=>H(t.target.value),style:{width:"100%",maxWidth:400}})]}),e.jsxs(G,{activeKey:O,onChange:K,children:[e.jsx(W,{tab:`Active (${k.length})`,children:e.jsx(B,{columns:E,dataSource:k,rowKey:"_id",pagination:{pageSize:10},loading:x,locale:{emptyText:e.jsx(M,{description:"No active customers"})},scroll:{x:"max-content"}})},"active"),e.jsx(W,{tab:`Inactive (${V.length})`,children:e.jsx(B,{columns:E,dataSource:V,rowKey:"_id",pagination:{pageSize:10},loading:x,locale:{emptyText:e.jsx(M,{description:"No inactive customers"})},scroll:{x:"max-content"}})},"inactive")]})]}),e.jsx(xe,{visible:z,onClose:()=>w(!1),onSave:ae,initialValues:i}),e.jsx(U,{title:"Confirm Status Change",open:Y,onOk:oe,onCancel:()=>C(!1),okText:"Yes",cancelText:"No",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:p==null?void 0:p.businessName})," to ",e.jsx("strong",{children:F}),"?"]})}),e.jsx(U,{title:"Confirm Delete",open:X,onOk:ie,onCancel:()=>y(!1),okText:"Delete",okButtonProps:{danger:!0},cancelText:"Cancel",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:d==null?void 0:d.businessName}),"?"]})}),g&&e.jsx(ge,{visible:ee,onClose:()=>R(!1),account:g,refreshAccounts:m}),g&&e.jsx(je,{visible:Z,onClose:()=>T(!1),account:g,refreshAccounts:m})]})};export{tt as default};
