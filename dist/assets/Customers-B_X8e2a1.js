import{r as a,E as he,n as e,P as o,U as xe,B as ge,W as l}from"./index-DFkeGJve.js";import{c as je,i as f}from"./axios-CXM2YcLm.js";import{B as Ce,F as we,N as ve,R as ye}from"./FollowUpDrawer-FTTpbVf-.js";import{R as Se,h as Ie,E as be}from"./html2canvas.esm-q3sVWcd6.js";import{C as Ne}from"./index-BxobYtMX.js";import{T as Ae,a as h}from"./index-CuiCWRnG.js";import{I as Te,b as De}from"./index-Dna1ZuSU.js";import{T as W}from"./index-aFscFpMp.js";import{F as E}from"./Table-KvRATXsL.js";import{M as B}from"./index-ISEoUsk9.js";import{R as Fe}from"./EditOutlined-uiPjFWnN.js";import{R as _e}from"./MessageOutlined-CT12yonJ.js";import{R as $e}from"./PrinterOutlined-CuehxlWX.js";import{R as Re}from"./DeleteOutlined-BH5Qblkw.js";import"./index-oCTpfyYp.js";import"./index-BLLH8eYJ.js";import"./context-D8nqyQHu.js";import"./index-DzANuCSF.js";import"./index-BXtwvscy.js";import"./index-83aYk6oH.js";import"./moment-C5S46NFB.js";import"./index-B5qbg8CL.js";import"./index-2VGcZWEN.js";import"./index-B4ypW-mK.js";import"./InfoCircleFilled-BriGrGii.js";const{Title:ke}=Ae,{TabPane:M}=W,lt=()=>{const[b,G]=a.useState(""),[H,O]=a.useState("active"),[K,q]=a.useState([]),[x,r]=a.useState(!1),[z,Y]=a.useState([]),[J,N]=a.useState(!1),[Q,w]=a.useState(!1),[i,A]=a.useState(null),[X,v]=a.useState(!1),[p,Z]=a.useState(null),[T,ee]=a.useState(null),[te,y]=a.useState(!1),[d,D]=a.useState(null),[se,F]=a.useState(!1),[ae,_]=a.useState(!1),[g,$]=a.useState(null),ne=he(),m=()=>{r(!0),f.get("/api/accounts/customers").then(t=>{q(Array.isArray(t.data)?t.data:[])}).catch(()=>{o.error("Failed to load customers")}).finally(()=>r(!1))},oe=()=>{N(!0),f.get("/api/accounts/users/all").then(t=>{Y(t.data)}).catch(()=>{o.error("Failed to load user list")}).finally(()=>N(!1))};a.useEffect(()=>{m(),oe()},[]);const ie=t=>{A(t),w(!0)},le=t=>{r(!0),(i!=null&&i._id?f.put(`/api/accounts/${i._id}`,t):f.post("/api/accounts",t)).then(()=>{o.success(`Customer ${i!=null&&i._id?"updated":"created"} successfully`),m()}).catch(()=>{o.error(`Failed to ${i!=null&&i._id?"update":"create"} customer`)}).finally(()=>{w(!1),A(null),r(!1)})},R=(t,s)=>{Z(s),ee(t?"Active":"Inactive"),v(!0)},re=()=>{r(!0);const t={...p,status:T};f.put(`/api/accounts/${p._id}`,t).then(()=>{o.success("Status updated"),m()}).catch(()=>{o.error("Failed to update status")}).finally(()=>{v(!1),r(!1)})},ce=t=>{D(t),y(!0)},de=()=>{d!=null&&d._id&&(r(!0),f.delete(`/api/accounts/${d._id}`).then(()=>{o.success("Customer deleted successfully"),m()}).catch(()=>{o.error("Failed to delete customer")}).finally(()=>{y(!1),D(null),r(!1)}))},ue=t=>{$(t),F(!0)},me=t=>{$(t),_(!0)},fe=t=>{ne(`/customers/${t._id}`)},pe=async t=>{const s=document.getElementById(`customer-pdf-content-${t._id}`);if(!s){o.error("PDF content not found.");return}o.loading("Generating PDF...",{id:"pdf-toast"});try{const n=await Ie(s,{scale:2}),c=n.toDataURL("image/png"),u=new be("p","mm","a4"),S=210,L=297,j=n.height*S/n.width;let C=j,I=0;for(u.addImage(c,"PNG",0,I,S,j),C-=L;C>=0;)I=C-j,u.addPage(),u.addImage(c,"PNG",0,I,S,j),C-=L;u.save(`${t.businessName}-details.pdf`),o.success("PDF generated!",{id:"pdf-toast"})}catch{o.error("Failed to generate PDF.",{id:"pdf-toast"})}},k=K.filter(t=>{var n,c,u;const s=b.toLowerCase();return((n=t.businessName)==null?void 0:n.toLowerCase().includes(s))||((c=t.contactName)==null?void 0:c.toLowerCase().includes(s))||((u=t.email)==null?void 0:u.toLowerCase().includes(s))}),P=k.filter(t=>t.status==="Active"),V=k.filter(t=>t.status==="Inactive"),U=[{title:"Sno.",render:(t,s,n)=>n+1,width:60},{title:"Business Name",dataIndex:"businessName"},{title:"Contact Name",dataIndex:"contactName"},{title:"Email Id",dataIndex:"email"},{title:"Type",dataIndex:"type",render:t=>{switch(t){case"Hot":return e.jsx(h,{color:"red",children:"Hot"});case"Warm":return e.jsx(h,{color:"orange",children:"Warm"});case"Cold":return e.jsx(h,{color:"blue",children:"Cold"});default:return e.jsx(h,{children:"Unknown"})}}},{title:"Assigned To",render:(t,s)=>s.assignedTo?e.jsxs("span",{children:[s.assignedTo.name," (",s.assignedTo.role,")"]}):e.jsx("em",{children:"Unassigned"})},{title:"Latest Note",render:(t,s)=>{var c;const n=(c=s.notes)==null?void 0:c[s.notes.length-1];return n?e.jsxs("div",{children:[e.jsx("small",{style:{color:"#888"},children:n.timestamp}),e.jsx("br",{}),n.text]}):e.jsx("em",{children:"No notes"})}},{title:"Status",render:(t,s)=>e.jsx(h,{color:s.status==="Active"?"green":"red",children:s.status})},{title:"Actions",render:(t,s)=>e.jsx(xe,{overlay:e.jsxs(l,{children:[e.jsx(l.Item,{icon:e.jsx(Fe,{}),onClick:()=>ie(s),children:"Edit Customer"},"edit"),e.jsx(l.Item,{icon:e.jsx(_e,{}),onClick:()=>ue(s),children:"View/Add Notes"},"notes"),e.jsx(l.Item,{icon:e.jsx(ye,{}),onClick:()=>me(s),children:"View/Add Follow-ups"},"followups"),e.jsx(l.Item,{icon:e.jsx(De,{}),onClick:()=>fe(s),children:"View Profile"},"view-profile"),e.jsx(l.Item,{icon:e.jsx($e,{}),onClick:()=>pe(s),children:"Generate PDF"},"generate-pdf"),s.status==="Active"?e.jsx(l.Item,{onClick:()=>R(!1,s),children:"Change to Inactive"},"inactive"):e.jsx(l.Item,{onClick:()=>R(!0,s),children:"Change to Active"},"active"),e.jsx(l.Item,{icon:e.jsx(Re,{}),danger:!0,onClick:()=>ce(s),children:"Delete Customer"},"delete")]}),children:e.jsx(ge,{icon:e.jsx(Se,{})})})}];return e.jsxs("div",{style:{padding:"24px"},children:[e.jsxs(Ne,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,flexWrap:"wrap"},children:[e.jsx(ke,{level:4,children:"Customers"}),e.jsx(Te,{placeholder:"Search by Business Name, Contact Name or Email",prefix:e.jsx(je,{}),value:b,onChange:t=>G(t.target.value),style:{width:"100%",maxWidth:400}})]}),e.jsxs(W,{activeKey:H,onChange:O,children:[e.jsx(M,{tab:`Active (${P.length})`,children:e.jsx(E,{columns:U,dataSource:P,rowKey:"_id",pagination:{pageSize:10},loading:x,scroll:{x:"max-content"}})},"active"),e.jsx(M,{tab:`Inactive (${V.length})`,children:e.jsx(E,{columns:U,dataSource:V,rowKey:"_id",pagination:{pageSize:10},loading:x,scroll:{x:"max-content"}})},"inactive")]})]}),e.jsx(Ce,{visible:Q,onClose:()=>w(!1),onSave:le,initialValues:i,allUsers:z,loadingUsers:J}),e.jsx(B,{title:"Confirm Status Change",open:X,onOk:re,onCancel:()=>v(!1),okText:"Yes",cancelText:"No",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to change the status of ",e.jsx("strong",{children:p==null?void 0:p.businessName})," to ",e.jsx("strong",{children:T}),"?"]})}),e.jsx(B,{title:"Confirm Delete",open:te,onOk:de,onCancel:()=>y(!1),okText:"Delete",okButtonProps:{danger:!0},cancelText:"Cancel",confirmLoading:x,children:e.jsxs("p",{children:["Are you sure you want to delete ",e.jsx("strong",{children:d==null?void 0:d.businessName}),"?"]})}),g&&e.jsx(we,{visible:ae,onClose:()=>_(!1),account:g,refreshAccounts:m}),g&&e.jsx(ve,{visible:se,onClose:()=>F(!1),account:g,refreshAccounts:m})]})};export{lt as default};
