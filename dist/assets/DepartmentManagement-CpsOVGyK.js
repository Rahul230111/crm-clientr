import{r as f,X as m,U as e,a0 as o,bd as I,a2 as R,aC as v,a4 as E,ao as A,aa as O,a6 as p,ar as i}from"./index-CdWk2t8q.js";import{P as _}from"./index-BWEg3k1d.js";import{R as $}from"./DeleteOutlined-ArRDP0IZ.js";const M=({departments:D,fetchDepartments:u,fetchTeams:x,fetchUsers:g})=>{const[C,n]=f.useState(!1),[l,j]=f.useState(null),[d]=m.useForm(),r=JSON.parse(localStorage.getItem("user")),y=(r==null?void 0:r.role)==="Superadmin",h=(r==null?void 0:r.role)==="Admin",w=()=>{j(null),d.resetFields(),n(!0)},b=a=>{j(a),d.setFieldsValue({name:a.name,description:a.description}),n(!0)},F=async()=>{var a,s;try{const t=await d.validateFields();l?(await p.put(`/api/departments/${l._id}`,t),i.success("Department updated successfully")):(await p.post("/api/departments",t),i.success("Department created successfully")),n(!1),u(),x(),g()}catch(t){console.error(t),i.error(((s=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:s.message)||"Failed to submit department")}},S=async a=>{var s,t;try{await p.delete(`/api/departments/${a}`),i.success("Department deleted"),u(),x(),g()}catch(c){i.error(((t=(s=c==null?void 0:c.response)==null?void 0:s.data)==null?void 0:t.message)||"Delete failed")}},k=[{title:"Name",dataIndex:"name",key:"name"},{title:"Actions",key:"actions",render:(a,s)=>e.jsx(A,{children:(y||h)&&e.jsxs(e.Fragment,{children:[e.jsx(o,{icon:e.jsx(O,{}),onClick:()=>b(s)}),e.jsx(_,{title:"Delete this department?",onConfirm:()=>S(s._id),children:e.jsx(o,{danger:!0,icon:e.jsx($,{})})})]})})}];return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsx("h2",{children:"Department Management"}),(y||h)&&e.jsx(o,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(I,{}),onClick:w,children:"Create Department"})]}),e.jsx(R,{columns:k,dataSource:D,rowKey:"_id",bordered:!0}),e.jsx(v,{title:l?"Edit Department":"Create Department",open:C,onClose:()=>n(!1),width:420,destroyOnClose:!0,footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(o,{onClick:()=>n(!1),style:{marginRight:8},children:"Cancel"}),e.jsx(o,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:F,children:l?"Update":"Create"})]}),children:e.jsx(m,{form:d,layout:"vertical",children:e.jsx(m.Item,{name:"name",label:"Department Name",rules:[{required:!0,message:"Department name is required"}],children:e.jsx(E,{})})})})]})};export{M as default};
