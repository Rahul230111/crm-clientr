import{r as a,I as $,e as q,x as e,S as Y,B as D,an as j,K as G}from"./index-3j2E7pUL.js";import{i as z}from"./axios-CSlAuMiO.js";import{F as s}from"./index-jd3XYpcD.js";import{D as U}from"./index-DVSodFTC.js";import{R as S,C as h}from"./row-BatVd8KW.js";import{I as i}from"./index-CsUGJ7YV.js";import{S as T}from"./index-DiojptZP.js";import{T as _}from"./index-C-eCguuc.js";import{R as W}from"./MinusCircleOutlined-BOYpYwy0.js";import{R as M}from"./PlusOutlined-BdSH2k4o.js";import{T as J}from"./index-VOyckxEQ.js";import{D as H}from"./index-MHS1ptoq.js";import{h as E}from"./moment-C5S46NFB.js";import{D as Q,d as Z}from"./index-NsnFnMr_.js";import{L as k}from"./index-BoISyFuH.js";import{R as K}from"./MessageOutlined-DZkEco9W.js";var X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},V=function(x,r){return a.createElement($,q({},x,{ref:r,icon:X}))},Te=a.forwardRef(V),ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"},te=function(x,r){return a.createElement($,q({},x,{ref:r,icon:ee}))},Fe=a.forwardRef(te),se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M531.3 574.4l.3-1.4c5.8-23.9 13.1-53.7 7.4-80.7-3.8-21.3-19.5-29.6-32.9-30.2-15.8-.7-29.9 8.3-33.4 21.4-6.6 24-.7 56.8 10.1 98.6-13.6 32.4-35.3 79.5-51.2 107.5-29.6 15.3-69.3 38.9-75.2 68.7-1.2 5.5.2 12.5 3.5 18.8 3.7 7 9.6 12.4 16.5 15 3 1.1 6.6 2 10.8 2 17.6 0 46.1-14.2 84.1-79.4 5.8-1.9 11.8-3.9 17.6-5.9 27.2-9.2 55.4-18.8 80.9-23.1 28.2 15.1 60.3 24.8 82.1 24.8 21.6 0 30.1-12.8 33.3-20.5 5.6-13.5 2.9-30.5-6.2-39.6-13.2-13-45.3-16.4-95.3-10.2-24.6-15-40.7-35.4-52.4-65.8zM421.6 726.3c-13.9 20.2-24.4 30.3-30.1 34.7 6.7-12.3 19.8-25.3 30.1-34.7zm87.6-235.5c5.2 8.9 4.5 35.8.5 49.4-4.9-19.9-5.6-48.1-2.7-51.4.8.1 1.5.7 2.2 2zm-1.6 120.5c10.7 18.5 24.2 34.4 39.1 46.2-21.6 4.9-41.3 13-58.9 20.2-4.2 1.7-8.3 3.4-12.3 5 13.3-24.1 24.4-51.4 32.1-71.4zm155.6 65.5c.1.2.2.5-.4.9h-.2l-.2.3c-.8.5-9 5.3-44.3-8.6 40.6-1.9 45 7.3 45.1 7.4zm191.4-388.2L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494z"}}]},name:"file-pdf",theme:"outlined"},re=function(x,r){return a.createElement($,q({},x,{ref:r,icon:se}))},Ae=a.forwardRef(re);const{TextArea:le}=i,{Option:n}=T,{Title:oe}=_,ae="/api/product",ne=async()=>{try{return(await z.get(`${ae}`)).data}catch(c){throw console.error("Error fetching all products:",c),c}},Le=({visible:c,onClose:x,onSave:r,initialValues:d,allUsers:y,loadingUsers:v,allZones:b,loadingZones:f})=>{const[p]=s.useForm(),[N,F]=a.useState(!1),[O,u]=a.useState([]),[g,w]=a.useState(!1),[A,L]=a.useState(y);s.useWatch("sourceType",p);const l=s.useWatch("zone",p);a.useEffect(()=>{var t,o,m;p.resetFields(),d?p.setFieldsValue({...d,assignedTo:((t=d.assignedTo)==null?void 0:t._id)||null,selectedProduct:((o=d.selectedProduct)==null?void 0:o._id)||null,zone:((m=d.zone)==null?void 0:m._id)||null,primaryContactPersonName:d.primaryContactPersonName||null,typeOfLead:d.typeOfLead||[],additionalContactPersons:d.additionalContactPersons||[]}):p.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null,selectedProduct:null,zone:null,primaryContactPersonName:null,typeOfLead:[],additionalContactPersons:[]})},[d,p]),a.useEffect(()=>{c&&(async()=>{w(!0);try{const o=await ne();u(o)}catch(o){console.error("Error fetching products:",o),j.error("Failed to load products.")}finally{w(!1)}})()},[c]),a.useEffect(()=>{(async()=>{if(l)try{const o=await z.get(`/api/users/zone/${l}`);L(o.data);const m=p.getFieldValue("assignedTo");m&&!o.data.some(C=>C._id===m)&&p.setFieldsValue({assignedTo:null})}catch(o){console.error("Failed to fetch users by zone:",o),j.error("Failed to load users for the selected zone."),L([])}else L(y)})()},[l,y,p]);const P=async()=>{try{const t=await p.validateFields();F(!0);const o=new Date().toLocaleString(),m=t.noteInput?{text:t.noteInput,timestamp:o,author:"User"}:null,C=(d==null?void 0:d.notes)||[],I=m?[...C,m]:C,R={...t,notes:I,assignedTo:t.assignedTo===void 0?null:t.assignedTo,selectedProduct:t.selectedProduct===void 0?null:t.selectedProduct,zone:t.zone===void 0?null:t.zone,primaryContactPersonName:t.primaryContactPersonName,typeOfLead:t.typeOfLead,additionalContactPersons:t.additionalContactPersons};delete R.noteInput,await r(R),j.success(`Account ${d?"updated":"created"} successfully!`),x()}catch(t){console.error("Validation Failed or API Error:",t),t&&t.response&&t.response.status===409&&t.response.data&&t.response.data.message?j.error(t.response.data.message):t&&t.errorFields?j.error("Please fill in all required fields correctly."):j.error("Failed to save account. Please try again.")}finally{F(!1)}};return e.jsx(U,{title:d?"Edit Business Account":"Create New Business Account",width:850,onClose:x,open:c,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(D,{onClick:x,style:{marginRight:8},children:"Cancel"}),e.jsx(D,{onClick:P,type:"primary",loading:N,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:d?"Update Account":"Create Account"})]}),children:e.jsx(Y,{spinning:v||g||f,children:e.jsxs(s,{form:p,layout:"vertical",children:[e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(i,{placeholder:"Business Name"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!1,message:"Please enter GST Number"}],children:e.jsx(i,{placeholder:"GST Number"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(i,{placeholder:"Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(i,{placeholder:"Email"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(i,{placeholder:"Phone Number (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(i,{placeholder:"Mobile Number"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"primaryContactPersonName",label:"Primary Contact Person (Optional)",children:e.jsx(i,{placeholder:"Primary Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"typeOfLead",label:"Type of Leads",rules:[{required:!1,message:"Please select type of leads"}],children:e.jsxs(T,{mode:"multiple",placeholder:"Select type(s)",allowClear:!0,children:[e.jsx(n,{value:"Regular",children:"Regular"}),e.jsx(n,{value:"Government",children:"Government"}),e.jsx(n,{value:"Occupational",children:"Occupational"})]})})})]}),e.jsx("div",{style:{marginBottom:16},children:e.jsx(oe,{level:5,style:{marginBottom:8},children:"Additional Contact Persons"})}),e.jsx(s.List,{name:"additionalContactPersons",children:(t,{add:o,remove:m})=>e.jsxs(e.Fragment,{children:[t.map(({key:C,name:I,...R})=>e.jsxs("div",{style:{border:"1px solid #d9d9d9",padding:"16px",marginBottom:"16px",borderRadius:"8px"},children:[e.jsxs(S,{gutter:16,align:"baseline",children:[e.jsx(h,{span:11,children:e.jsx(s.Item,{...R,label:"Contact Name",name:[I,"name"],rules:[{required:!0,message:"Missing contact name"}],children:e.jsx(i,{placeholder:"Contact Name"})})}),e.jsx(h,{span:11,children:e.jsx(s.Item,{...R,label:"Email",name:[I,"email"],rules:[{type:"email",message:"Invalid email"}],children:e.jsx(i,{placeholder:"Email"})})}),e.jsx(h,{span:2,style:{display:"flex",justifyContent:"flex-end",alignItems:"center"},children:e.jsx(W,{onClick:()=>m(I),style:{fontSize:"20px",color:"#999"}})})]}),e.jsxs(S,{gutter:16,align:"baseline",children:[e.jsx(h,{span:11,children:e.jsx(s.Item,{...R,label:"Phone Number",name:[I,"phoneNumber"],children:e.jsx(i,{placeholder:"Phone Number"})})}),e.jsx(h,{span:13})]})]},C)),e.jsx(s.Item,{children:e.jsx(D,{type:"dashed",onClick:()=>o(),block:!0,icon:e.jsx(M,{}),children:"Add Additional Contact Person"})})]})}),e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(i,{placeholder:"Address Line 1"})})}),e.jsx(h,{span:12,children:e.jsx(s.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(i,{placeholder:"Address Line 2 (Optional)"})})})]}),e.jsxs(S,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(i,{placeholder:"City"})})}),e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(J,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(h,{span:8,children:e.jsx(s.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(i,{placeholder:"State"})})})]}),e.jsx(s.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(i,{placeholder:"Country"})}),e.jsx(s.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(i,{placeholder:"https://www.example.com"})}),e.jsx(s.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(T,{placeholder:"Select Type",children:[e.jsx(n,{value:"Hot",children:"Hot"}),e.jsx(n,{value:"Warm",children:"Warm"}),e.jsx(n,{value:"Cold",children:"Cold"})]})}),e.jsx(s.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(T,{placeholder:"Select Status",children:[e.jsx(n,{value:"Active",children:"Lead"}),e.jsx(n,{value:"TargetLeads",children:"Target Leads"}),e.jsx(n,{value:"Pipeline",children:"Enquiry"}),e.jsx(n,{value:"Quotations",children:"Quotations"}),e.jsx(n,{value:"Customer",children:"Converted"}),e.jsx(n,{value:"Closed",children:"Closed"})]})}),e.jsx(s.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(T,{placeholder:"How did you hear about us?",children:[e.jsx(n,{value:"Direct",children:"Direct"}),e.jsx(n,{value:"socialmedia",children:"Social Media"}),e.jsx(n,{value:"online",children:"Website"}),e.jsx(n,{value:"client",children:"Existing Client"}),e.jsx(n,{value:"tradefair",children:"Tradefair"}),e.jsx(n,{value:"Other",children:"Other"})]})}),e.jsx(s.Item,{name:"zone",label:"Zone",children:e.jsx(T,{placeholder:"Select a zone (optional)",allowClear:!0,loading:f,showSearch:!0,optionFilterProp:"children",filterOption:(t,o)=>String(o.children||"").toLowerCase().includes(t.toLowerCase()),children:b&&b.map(t=>e.jsx(n,{value:t._id,children:t.name},t._id))})}),e.jsx(s.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(T,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:v,showSearch:!0,optionFilterProp:"children",filterOption:(t,o)=>String(o.children||"").toLowerCase().includes(t.toLowerCase()),children:A&&A.map(t=>e.jsxs(n,{value:t._id,children:[t.name," (",t.role,")"]},t._id))})}),e.jsx(s.Item,{name:"selectedProduct",label:"Select Product",rules:[{required:!1,message:"Please select a product"}],children:e.jsx(T,{placeholder:"Select a product (optional)",allowClear:!0,loading:g,showSearch:!0,optionFilterProp:"children",filterOption:(t,o)=>String(o.children||"").toLowerCase().includes(t.toLowerCase()),children:O.map(t=>e.jsx(n,{value:t._id,children:t.productName},t._id))})}),e.jsx(s.Item,{name:"noteInput",label:"Add Note",children:e.jsx(le,{rows:3,placeholder:"Add a note (it will be timestamped)"})})]})})})},{TextArea:de}=i,{Title:ie,Text:ce}=_,Oe=({visible:c,onClose:x,account:r,refreshAccounts:d})=>{const[y]=s.useForm(),[v,b]=a.useState(!1),[f,p]=a.useState([]);a.useEffect(()=>{c&&(r!=null&&r._id)&&p(r.notes||[])},[c,r]);const N=()=>{try{const u=JSON.parse(localStorage.getItem("user"));return(u==null?void 0:u.email)||"Unknown"}catch{return"Unknown"}},F=async()=>{try{const{note:u}=await y.validateFields();b(!0);const g={text:u,timestamp:new Date().toLocaleString(),author:N()},w=[...f,g];await z.put(`/api/accounts/${r._id}`,{...r,notes:w}),j.success("Note added successfully!"),p(w),y.resetFields(),d()}catch{j.error("Failed to add note.")}finally{b(!1)}},O=()=>!f||f.length===0?e.jsx(ce,{type:"secondary",children:"No notes to show"}):f.map((u,g)=>{const w=g>0?f[g-1]:null,A=new Date(u.timestamp).toDateString(),L=w?new Date(w.timestamp).toDateString():null,l=A!==L;return e.jsxs("div",{children:[l&&e.jsx("div",{className:"note-date-header",children:A}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[u.author,"    ",u.timestamp]}),e.jsx("div",{className:"note-text",children:u.text})]})]},g)});return e.jsxs(U,{title:e.jsxs(ie,{level:4,style:{margin:0},children:["Notes for ",r.businessName]}),open:c,onClose:x,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[O(),e.jsx(H,{}),e.jsxs(s,{form:y,layout:"vertical",children:[e.jsx(s.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(de,{rows:3,placeholder:"Type your note here...",disabled:v})}),e.jsx(D,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(M,{}),onClick:F,loading:v,block:!0,children:"Add Note"})]})]})},{TextArea:ue}=i,{Text:B}=_,Re=({visible:c,onClose:x,account:r,refreshAccounts:d})=>{const[y,v]=a.useState(""),[b,f]=a.useState(null),[p,N]=a.useState(!1),[F,O]=a.useState([]),[u,g]=a.useState(null);a.useEffect(()=>{c&&(r!=null&&r._id)?w():(O([]),g(null),v(""),f(null))},[c,r]);const w=async()=>{if(r!=null&&r._id){N(!0);try{const l=await z.get(`/api/accounts/${r._id}/followups`);O(l.data.sort((P,t)=>E(t.createdAt).diff(E(P.createdAt)))||[])}catch(l){console.error("Error fetching follow-ups:",l),j.error("Failed to fetch follow-ups")}finally{N(!1)}}},A=()=>{if(!y.trim()||!b){j.error("Please select a date and enter a note for the follow-up.");return}const l=JSON.parse(localStorage.getItem("user")),P=l==null?void 0:l._id;if(!P){j.error("User information not found. Please log in.");return}N(!0);const t={date:b.toISOString(),note:y.trim(),addedBy:P};(u===null?z.post(`/api/accounts/${r._id}/followups`,t):z.put(`/api/accounts/${r._id}/followups/${u._id}`,t)).then(()=>{j.success(u===null?"Follow-up added successfully!":"Follow-up updated successfully!"),v(""),f(null),g(null),w(),typeof d=="function"&&d()}).catch(m=>{var C,I;console.error("Error saving follow-up:",m),j.error(((I=(C=m==null?void 0:m.response)==null?void 0:C.data)==null?void 0:I.message)||"Failed to save follow-up.")}).finally(()=>N(!1))},L=l=>{var P,t;return e.jsx(k.Item,{children:e.jsxs("div",{style:{backgroundColor:"#f0f2f5",borderRadius:"12px",padding:"10px 15px",maxWidth:"calc(100% - 80px)",flexGrow:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",marginBottom:"5px"},children:[e.jsx(G,{style:{marginRight:"5px",color:"#888"}}),e.jsx(B,{strong:!0,style:{marginRight:"10px",color:"#333"},children:((P=l.addedBy)==null?void 0:P.name)||((t=l.addedBy)==null?void 0:t.email)||"Unknown User"}),e.jsx(Z,{style:{marginRight:"5px",color:"#888"}}),e.jsxs(B,{type:"secondary",style:{fontSize:"0.8em"},children:[E(l.createdAt).format("DD/MM/YYYY, h:mm:ss A")," "]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"flex-start"},children:[e.jsx(K,{style:{marginRight:"8px",marginTop:"3px",color:"#555"}}),e.jsx(B,{style:{flexGrow:1},children:l.note})]})]})})};return e.jsxs(U,{title:`Follow-ups for Account: ${(r==null?void 0:r.businessName)||"N/A"}`,open:c,onClose:()=>{g(null),v(""),f(null),x()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(Q,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:b,onChange:l=>f(l),placeholder:"Select follow-up date"}),e.jsx(ue,{rows:4,placeholder:"Enter follow-up note",value:y,onChange:l=>v(l.target.value)}),e.jsx(D,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#ef7a1b",color:"white"},block:!0,onClick:A,loading:p,children:u===null?"Add Follow-up":"Update Follow-up"})]}),e.jsxs(H,{children:["All Follow-ups (",F.length,")"]}),e.jsx(k,{dataSource:F,renderItem:L,locale:{emptyText:"No follow-ups found for this account."},style:{marginTop:16}})]})};export{Le as B,Re as F,Oe as N,Te as R,Ae as a,Fe as b};
