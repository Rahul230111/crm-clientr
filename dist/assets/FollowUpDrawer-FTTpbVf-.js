import{r as u,I as K,u as Q,n as e,B as L,P as x}from"./index-DFkeGJve.js";import{F as r}from"./index-oCTpfyYp.js";import{D as $}from"./index-BLLH8eYJ.js";import{R as C,C as h,i as A}from"./axios-CXM2YcLm.js";import{I as a}from"./index-Dna1ZuSU.js";import{T as X}from"./index-DzANuCSF.js";import{S as P}from"./index-BXtwvscy.js";import{D as z}from"./index-83aYk6oH.js";import{R as Z,T as J}from"./index-aFscFpMp.js";import{T as U}from"./index-CuiCWRnG.js";import{h as S}from"./moment-C5S46NFB.js";import{D as V}from"./index-B5qbg8CL.js";import{L as k}from"./index-2VGcZWEN.js";import{M as ee}from"./index-ISEoUsk9.js";var se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 128c-212.1 0-384 171.9-384 384v360c0 13.3 10.7 24 24 24h184c35.3 0 64-28.7 64-64V624c0-35.3-28.7-64-64-64H200v-48c0-172.3 139.7-312 312-312s312 139.7 312 312v48H688c-35.3 0-64 28.7-64 64v208c0 35.3 28.7 64 64 64h184c13.3 0 24-10.7 24-24V512c0-212.1-171.9-384-384-384zM328 632v192H200V632h128zm496 192H696V632h128v192z"}}]},name:"customer-service",theme:"outlined"},te=function(g,l){return u.createElement(K,Q({},g,{ref:l,icon:se}))},Ne=u.forwardRef(te);const{TextArea:re}=a,{Option:i}=P,ve=({visible:j,onClose:g,onSave:l,initialValues:o,allUsers:f,loadingUsers:y})=>{var T;const[d]=r.useForm(),[m,N]=u.useState(!1),I=r.useWatch("sourceType",d);u.useEffect(()=>{var s;d.resetFields(),o?d.setFieldsValue({...o,assignedTo:((s=o.assignedTo)==null?void 0:s._id)||null}):d.setFieldsValue({sourceType:"Direct",status:"Active",assignedTo:null})},[o,d]);const w=()=>{d.validateFields().then(s=>{N(!0);const n=new Date().toLocaleString(),p=s.noteInput?{text:s.noteInput,timestamp:n}:null,v=(o==null?void 0:o.notes)||[],F=p?[...v,p]:v,b={...s,notes:F,assignedTo:s.assignedTo===null?null:s.assignedTo};delete b.noteInput,b.sourceType!=="Facebook Referral"&&delete b.referralPersonName,l(b),x.success(`Account ${o?"updated":"created"} successfully!`),N(!1),g()}).catch(s=>{console.log("Validate Failed:",s),x.error("Please fill in all required fields correctly.")})};return e.jsx($,{title:o?"Edit Business Account":"Create New Business Account",width:720,onClose:g,visible:j,bodyStyle:{paddingBottom:80},footer:e.jsxs("div",{style:{textAlign:"right"},children:[e.jsx(L,{onClick:g,style:{marginRight:8},children:"Cancel"}),e.jsx(L,{onClick:w,type:"primary",loading:m,children:o?"Update Account":"Create Account"})]}),children:e.jsxs(r,{form:d,layout:"vertical",children:[e.jsxs(C,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"businessName",label:"Business Name",rules:[{required:!0,message:"Please enter business name"}],children:e.jsx(a,{placeholder:"Business Name"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"gstNumber",label:"GST Number",rules:[{required:!0,message:"Please enter GST Number"}],children:e.jsx(a,{placeholder:"GST Number"})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"contactName",label:"Customer Name",rules:[{required:!0,message:"Please enter contact person name"}],children:e.jsx(a,{placeholder:"Contact Person Name"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Please enter email"}],children:e.jsx(a,{placeholder:"Email"})})})]}),e.jsxs(C,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"phoneNumber",label:"Phone Number",children:e.jsx(a,{placeholder:"Phone Number (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"mobileNumber",label:"Mobile Number",rules:[{required:!0,message:"Please enter mobile number"}],children:e.jsx(a,{placeholder:"Mobile Number"})})})]}),e.jsx(r.Item,{name:"addressLine1",label:"Address Line 1",rules:[{required:!0,message:"Please enter address line 1"}],children:e.jsx(a,{placeholder:"Address Line 1"})}),e.jsxs(C,{gutter:16,children:[e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"addressLine2",label:"Address Line 2",children:e.jsx(a,{placeholder:"Address Line 2 (Optional)"})})}),e.jsx(h,{span:12,children:e.jsx(r.Item,{name:"addressLine3",label:"Address Line 3",children:e.jsx(a,{placeholder:"Address Line 3 (Optional)"})})})]}),e.jsx(r.Item,{name:"landmark",label:"Landmark",children:e.jsx(a,{placeholder:"Landmark (Optional)"})}),e.jsxs(C,{gutter:16,children:[e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"city",label:"City",rules:[{required:!0,message:"Please enter city"}],children:e.jsx(a,{placeholder:"City"})})}),e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"pincode",label:"Pincode",rules:[{required:!0,message:"Please enter pincode"}],children:e.jsx(X,{style:{width:"100%"},placeholder:"Pincode"})})}),e.jsx(h,{span:8,children:e.jsx(r.Item,{name:"state",label:"State",rules:[{required:!0,message:"Please enter state"}],children:e.jsx(a,{placeholder:"State"})})})]}),e.jsx(r.Item,{name:"country",label:"Country",rules:[{required:!0,message:"Please enter country"}],children:e.jsx(a,{placeholder:"Country"})}),e.jsx(r.Item,{name:"website",label:"Website URL",rules:[{type:"url",message:"Invalid URL format"}],children:e.jsx(a,{placeholder:"https://www.example.com"})}),e.jsx(r.Item,{name:"type",label:"Lead Type",rules:[{required:!0,message:"Please select a lead type"}],children:e.jsxs(P,{placeholder:"Select Type",children:[e.jsx(i,{value:"Hot",children:"Hot"}),e.jsx(i,{value:"Warm",children:"Warm"}),e.jsx(i,{value:"Cold",children:"Cold"})]})}),e.jsx(r.Item,{name:"status",label:"Account Status",rules:[{required:!0,message:"Please select an account status"}],children:e.jsxs(P,{placeholder:"Select Status",children:[e.jsx(i,{value:"Active",children:"Active"}),e.jsx(i,{value:"Inactive",children:"Inactive"}),e.jsx(i,{value:"Waiting",children:"Waiting"}),e.jsx(i,{value:"Closed",children:"Closed"})]})}),e.jsx(r.Item,{name:"sourceType",label:"Source Type",rules:[{required:!0,message:"Please select a source type"}],children:e.jsxs(P,{placeholder:"How did you hear about us?",children:[e.jsx(i,{value:"Direct",children:"Direct"}),e.jsx(i,{value:"Facebook Referral",children:"Facebook Referral"}),e.jsx(i,{value:"Google Ads",children:"Google Ads"}),e.jsx(i,{value:"Website",children:"Website"}),e.jsx(i,{value:"Cold Call",children:"Cold Call"}),e.jsx(i,{value:"Other",children:"Other"})]})}),I==="Facebook Referral"&&e.jsx(r.Item,{name:"referralPersonName",label:"Referral Person Name",rules:[{required:!0,message:"Please enter the referral person's name"}],children:e.jsx(a,{placeholder:"Name of the person who referred from Facebook"})}),e.jsx(r.Item,{name:"assignedTo",label:"Assigned To",children:e.jsx(P,{placeholder:"Select a user to assign to (optional)",allowClear:!0,loading:y,showSearch:!0,optionFilterProp:"children",filterOption:(s,n)=>n.children.toLowerCase().indexOf(s.toLowerCase())>=0,children:f&&f.map(s=>e.jsxs(i,{value:s._id,children:[s.name," (",s.role,")"]},s._id))})}),e.jsx(r.Item,{name:"noteInput",label:"Add Note",children:e.jsx(re,{rows:3,placeholder:"Add a note (it will be timestamped)"})}),((T=o==null?void 0:o.notes)==null?void 0:T.length)>0&&e.jsxs("div",{style:{marginBottom:24},children:[e.jsx("label",{children:e.jsx("strong",{children:"Previous Notes"})}),e.jsx("ul",{style:{paddingLeft:20},children:o.notes.map((s,n)=>e.jsxs("li",{children:[e.jsxs("strong",{children:[s.timestamp,":"]})," ",s.text]},n))})]})]})})},{TextArea:le}=a,{Title:oe,Text:ae}=U,Ie=({visible:j,onClose:g,account:l,refreshAccounts:o})=>{const[f]=r.useForm(),[y,d]=u.useState(!1),[m,N]=u.useState([]);u.useEffect(()=>{j&&(l!=null&&l._id)&&N(l.notes||[])},[j,l]);const I=()=>{try{const s=JSON.parse(localStorage.getItem("user"));return(s==null?void 0:s.email)||"Unknown"}catch{return"Unknown"}},w=async()=>{try{const{note:s}=await f.validateFields();d(!0);const n={text:s,timestamp:new Date().toLocaleString(),author:I()},p=[...m,n];await A.put(`/api/accounts/${l._id}`,{...l,notes:p}),x.success("Note added successfully!"),N(p),f.resetFields(),o()}catch{x.error("Failed to add note.")}finally{d(!1)}},T=()=>!m||m.length===0?e.jsx(ae,{type:"secondary",children:"No notes to show"}):m.map((s,n)=>{const p=n>0?m[n-1]:null,v=new Date(s.timestamp).toDateString(),F=p?new Date(p.timestamp).toDateString():null,b=v!==F;return e.jsxs("div",{children:[b&&e.jsx("div",{className:"note-date-header",children:v}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[s.author,"    ",s.timestamp]}),e.jsx("div",{className:"note-text",children:s.text})]})]},n)});return e.jsxs($,{title:e.jsxs(oe,{level:4,style:{margin:0},children:["Notes for ",l.businessName]}),open:j,onClose:g,width:440,bodyStyle:{padding:"24px"},destroyOnClose:!0,children:[T(),e.jsx(z,{}),e.jsxs(r,{form:f,layout:"vertical",children:[e.jsx(r.Item,{name:"note",label:"Add Note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(le,{rows:3,placeholder:"Type your note here...",disabled:y})}),e.jsx(L,{type:"primary",icon:e.jsx(Z,{}),onClick:w,loading:y,block:!0,children:"Add Note"})]})]})},{TextArea:ne}=a,{TabPane:R}=J,Te=({visible:j,onClose:g,account:l,refreshAccounts:o})=>{const[f,y]=u.useState(""),[d,m]=u.useState(null),[N,I]=u.useState(!1),[w,T]=u.useState([]),[s,n]=u.useState(null);u.useEffect(()=>{j&&(l!=null&&l._id)&&p()},[j,l]);const p=async()=>{try{const t=await A.get(`/api/accounts/${l._id}/followups`);T(t.data||[])}catch{x.error("Failed to fetch follow-ups")}},v=()=>{if(!f||!d){x.error("Please fill in all fields");return}const t=JSON.parse(localStorage.getItem("user")),c=t==null?void 0:t._id;if(!c){x.error("User not found");return}I(!0);const D={date:d.format("YYYY-MM-DD"),note:f,addedBy:c};(s===null?A.post(`/api/accounts/${l._id}/followups`,D):A.put(`/api/accounts/${l._id}/followups/${s}`,D)).then(()=>{x.success(s===null?"Follow-up added":"Follow-up updated"),y(""),m(null),n(null),p(),o()}).catch(M=>{var H,G;x.error(((G=(H=M==null?void 0:M.response)==null?void 0:H.data)==null?void 0:G.message)||"Failed to save follow-up")}).finally(()=>I(!1))},F=t=>{const c=w[t];y(c.note),m(S(c.date)),n(t)},b=t=>{ee.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up?",okText:"Yes",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{A.delete(`/api/accounts/${l._id}/followups/${t}`).then(()=>{x.success("Follow-up deleted"),p(),o()}).catch(()=>x.error("Failed to delete follow-up"))}})},Y=S().format("YYYY-MM-DD"),O=[...w].sort((t,c)=>new Date(c.date)-new Date(t.date)),E=O.filter(t=>S(t.date).format("YYYY-MM-DD")===Y),_=O.filter(t=>S(t.date).isAfter(Y,"day")),W=O.filter(t=>S(t.date).isBefore(Y,"day")),B=(t,c)=>{var D,q;return e.jsx(k.Item,{actions:[e.jsx("a",{onClick:()=>F(c),children:"Edit"},"edit"),e.jsx("a",{onClick:()=>b(c),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(U.Text,{strong:!0,children:S(t.date).format("DD-MM-YYYY")}),e.jsx("br",{}),t.note,e.jsx("br",{}),e.jsxs(U.Text,{type:"secondary",children:["By ",((D=t.addedBy)==null?void 0:D.name)||((q=t.addedBy)==null?void 0:q.email)||"Unknown"]})]})})};return e.jsxs($,{title:`Follow-ups: ${l==null?void 0:l.businessName}`,open:j,onClose:()=>{n(null),y(""),m(null),g()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(V,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:d,onChange:t=>m(t)}),e.jsx(ne,{rows:4,placeholder:"Enter follow-up note",value:f,onChange:t=>y(t.target.value)}),e.jsx(L,{type:"primary",block:!0,onClick:v,loading:N,style:{marginTop:10},children:s===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(z,{}),e.jsxs(J,{defaultActiveKey:"today",children:[e.jsx(R,{tab:`Today's Follow-ups (${E.length})`,children:e.jsx(k,{dataSource:E,renderItem:(t,c)=>B(t,w.indexOf(t)),locale:{emptyText:"No follow-ups for today"}})},"today"),e.jsx(R,{tab:`Upcoming Follow-ups (${_.length})`,children:e.jsx(k,{dataSource:_,renderItem:(t,c)=>B(t,w.indexOf(t)),locale:{emptyText:"No upcoming follow-ups"}})},"upcoming"),e.jsx(R,{tab:`Past Follow-ups (${W.length})`,children:e.jsx(k,{dataSource:W,renderItem:(t,c)=>B(t,w.indexOf(t)),locale:{emptyText:"No past follow-ups"}})},"past")]})]})};export{ve as B,Te as F,Ie as N,Ne as R};
