import{r as x,I as Ge,k as Xe,O as re,X as _,U as e,aC as be,an as qe,a4 as ee,a0 as V,W as ue,a6 as q,a7 as De,ao as ye,S as Y,a5 as ce,P as xe,a2 as D,a3 as pe,ar as z,be as Q,aB as ie,bb as W,bf as le,V as We,bg as Ke,bd as Je,$ as ve,by as Ee,ab as Qe,bh as Ze,bi as X,ac as et,aa as tt}from"./index-CDYSMnhF.js";import{u as he,w as st}from"./xlsx-CyWl6TWy.js";import{R as nt}from"./SendOutlined-DatyELq4.js";import{D as I}from"./index-DldMnm3Y.js";import{P as _e}from"./index-BaWZJApH.js";import{h as se}from"./moment-C5S46NFB.js";import{E as ot,h as at,R as rt}from"./html2canvas.esm-DzcwRW7F.js";import{R as lt}from"./PrinterOutlined-obAkroLj.js";import{R as it}from"./MessageOutlined-BKyq4j-V.js";import{R as dt}from"./ScheduleOutlined-Dd1mtLaq.js";import{R as ct}from"./DeleteOutlined-C8bxn61I.js";var pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372zm47.7-395.2l-25.4-5.9V348.6c38 5.2 61.5 29 65.5 58.2.5 4 3.9 6.9 7.9 6.9h44.9c4.7 0 8.4-4.1 8-8.8-6.1-62.3-57.4-102.3-125.9-109.2V263c0-4.4-3.6-8-8-8h-28.1c-4.4 0-8 3.6-8 8v33c-70.8 6.9-126.2 46-126.2 119 0 67.6 49.8 100.2 102.1 112.7l24.7 6.3v142.7c-44.2-5.9-69-29.5-74.1-61.3-.6-3.8-4-6.6-7.9-6.6H363c-4.7 0-8.4 4-8 8.7 4.5 55 46.2 105.6 135.2 112.1V761c0 4.4 3.6 8 8 8h28.4c4.4 0 8-3.6 8-8.1l-.2-31.7c78.3-6.9 134.3-48.8 134.3-124-.1-69.4-44.2-100.4-109-116.4zm-68.6-16.2c-5.6-1.6-10.3-3.1-15-5-33.8-12.2-49.5-31.9-49.5-57.3 0-36.3 27.5-57 64.5-61.7v124zM534.3 677V543.3c3.1.9 5.9 1.6 8.8 2.2 47.3 14.4 63.2 34.4 63.2 65.1 0 39.1-29.4 62.6-72 66.4z"}}]},name:"dollar",theme:"outlined"},ut=function(A,n){return x.createElement(Ge,Xe({},A,{ref:n,icon:pt}))},mt=x.forwardRef(ut),de={exports:{}},xt=de.exports,Me;function ht(){return Me||(Me=1,function(a,A){(function(n,u){u()})(xt,function(){function n(i,t){return typeof t>"u"?t={autoBom:!1}:typeof t!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function u(i,t,c){var r=new XMLHttpRequest;r.open("GET",i),r.responseType="blob",r.onload=function(){T(r.response,t,c)},r.onerror=function(){console.error("could not download file")},r.send()}function S(i){var t=new XMLHttpRequest;t.open("HEAD",i,!1);try{t.send()}catch{}return 200<=t.status&&299>=t.status}function b(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(t)}}var f=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof re=="object"&&re.global===re?re:void 0,y=f.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),T=f.saveAs||(typeof window!="object"||window!==f?function(){}:"download"in HTMLAnchorElement.prototype&&!y?function(i,t,c){var r=f.URL||f.webkitURL,h=document.createElement("a");t=t||i.name||"download",h.download=t,h.rel="noopener",typeof i=="string"?(h.href=i,h.origin===location.origin?b(h):S(h.href)?u(i,t,c):b(h,h.target="_blank")):(h.href=r.createObjectURL(i),setTimeout(function(){r.revokeObjectURL(h.href)},4e4),setTimeout(function(){b(h)},0))}:"msSaveOrOpenBlob"in navigator?function(i,t,c){if(t=t||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(n(i,c),t);else if(S(i))u(i,t,c);else{var r=document.createElement("a");r.href=i,r.target="_blank",setTimeout(function(){b(r)})}}:function(i,t,c,r){if(r=r||open("","_blank"),r&&(r.document.title=r.document.body.innerText="downloading..."),typeof i=="string")return u(i,t,c);var h=i.type==="application/octet-stream",B=/constructor/i.test(f.HTMLElement)||f.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||h&&B||y)&&typeof FileReader<"u"){var m=new FileReader;m.onloadend=function(){var N=m.result;N=E?N:N.replace(/^data:[^;]*;/,"data:attachment/file;"),r?r.location.href=N:location=N,r=null},m.readAsDataURL(i)}else{var C=f.URL||f.webkitURL,j=C.createObjectURL(i);r?r.location=j:location.href=j,r=null,setTimeout(function(){C.revokeObjectURL(j)},4e4)}});f.saveAs=T.saveAs=T,a.exports=T})}(de)),de.exports}var Re=ht();const{TextArea:gt}=ee,ft=({visible:a,onClose:A,account:n,invoice:u,refreshInvoices:S,refreshAccounts:b})=>{const[f]=_.useForm(),[y,T]=x.useState([]),[i,t]=x.useState(!1);x.useEffect(()=>{var C;const m=((C=u||n)==null?void 0:C.notes)||[];T(Array.isArray(m)?m:[])},[u,n]);const c=()=>{try{const m=JSON.parse(localStorage.getItem("user"));return(m==null?void 0:m.name)||(m==null?void 0:m.email)||"Unknown"}catch{return"Unknown"}},r=()=>u?`/api/invoices/${u._id}`:`/api/accounts/${n._id}`,h=async({note:m})=>{if(!m)return;const C={text:m,timestamp:new Date().toISOString(),addedBy:c()},j=[...y,C];try{t(!0),await q.put(r(),{...u||n,notes:j}),De.success("Note added"),T(j),f.resetFields(),u?S==null||S():b==null||b()}catch(N){console.error("Failed to add note:",N),De.error("Failed to add note")}finally{t(!1)}},E=(m=>{const C={};return m.forEach(j=>{if(!j||typeof j!="object")return;const N=j.timestamp?new Date(j.timestamp).toLocaleDateString():"Unknown Date";C[N]||(C[N]=[]),C[N].push(j)}),C})(y);return e.jsx(be,{title:e.jsxs("div",{children:["Notes for ",u?"Invoice":"Account"," ",e.jsxs(ue.Text,{code:!0,children:["#",(u==null?void 0:u.invoiceNumber)||(n==null?void 0:n.businessName)]})]}),open:a,onClose:A,width:450,destroyOnClose:!0,children:e.jsxs(qe,{spinning:i,children:[e.jsx("div",{style:{padding:"0 8px"},children:Object.entries(E).map(([m,C])=>e.jsxs("div",{children:[e.jsx("div",{className:"note-date-header",children:m}),C.map((j,N)=>e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[j.addedBy||"Unknown"," • ",j.timestamp?new Date(j.timestamp).toLocaleTimeString():""]}),e.jsx("div",{className:"note-text",children:typeof j.text=="string"?j.text:JSON.stringify(j.text)})]},N))]},m))}),e.jsxs(_,{form:f,layout:"vertical",onFinish:h,style:{marginTop:16},children:[e.jsx(_.Item,{name:"note",rules:[{required:!0,message:"Enter note"}],children:e.jsx(gt,{rows:3,placeholder:"Type your note here..."})}),e.jsx(V,{htmlType:"submit",type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:e.jsx(nt,{}),block:!0,children:"Add Note"})]})]})})},{Text:ge}=ue,yt=({visible:a,onClose:A,invoice:n,refreshInvoices:u})=>{var R;const[S]=_.useForm(),[b]=_.useForm(),[f,y]=x.useState(!1),[T,i]=x.useState({paymentHistory:[]}),[t,c]=x.useState(!1),[r,h]=x.useState(null),[B,E]=x.useState(0),[m,C]=x.useState(0),[j,N]=x.useState(!1),L=g=>{const w=g.paymentHistory.reduce((F,U)=>F+U.amount,0);if(E(w),n!=null&&n.totalAmount){const F=n.totalAmount-w;C(F),N(F<=.01)}else C(0),N(!1)},G=()=>{try{const g=JSON.parse(localStorage.getItem("user"));return(g==null?void 0:g.email)||"Unknown"}catch{return"Unknown"}},p=async()=>{if(n!=null&&n._id)try{const g=await q.get(`/api/invoices/${n._id}`),w={...g.data,paymentHistory:Array.isArray(g.data.paymentHistory)?g.data.paymentHistory:[]};i(w),L(w)}catch(g){z.error("Failed to fetch invoice details."),console.error("Error fetching invoice:",g),i({paymentHistory:[]}),L({paymentHistory:[]})}};x.useEffect(()=>{a&&p()},[a,n==null?void 0:n._id]),x.useEffect(()=>{L(T)},[n==null?void 0:n.totalAmount,T.paymentHistory]);const H=async g=>{const w=parseFloat(g.amount);if(isNaN(w)||w<=0){z.error("Please enter a valid positive amount!");return}const F=T.paymentHistory.reduce((K,me)=>K+me.amount,0),U=(n==null?void 0:n.totalAmount)||0;if(F+w>U+.01){z.error(`Payment amount exceeds outstanding balance. Outstanding: ₹${(U-F).toFixed(2)}`);return}y(!0);try{const K={...g,date:g.date.format("YYYY-MM-DD"),addedBy:G()};await q.post(`/api/invoices/${n._id}/payments`,K),z.success("Payment added successfully!"),S.resetFields(),await p(),u()}catch(K){z.error("Failed to add payment."),console.error("Error adding payment:",K)}finally{y(!1)}},d=async g=>{try{await q.delete(`/api/invoices/${n._id}/payments/${g}`),z.success("Payment deleted successfully!"),await p(),u()}catch(w){z.error("Failed to delete payment."),console.error("Error deleting payment:",w)}},P=async g=>{try{const w={...g,date:g.date.format("YYYY-MM-DD")};await q.put(`/api/invoices/${n._id}/payments/${r}`,w),z.success("Payment updated successfully!"),c(!1),await p(),u()}catch(w){z.error("Failed to update payment."),console.error("Error updating payment:",w)}},M=[{title:"Amount",dataIndex:"amount",key:"amount",render:g=>`₹${Number(g).toFixed(2)}`},{title:"Method",dataIndex:"method",key:"method"},{title:"Reference",dataIndex:"reference",key:"reference"},{title:"Date",dataIndex:"date",key:"date",render:g=>xe(g).format("DD/MM/YYYY")},{title:"Added By",dataIndex:"addedBy",key:"addedBy"},{title:"Actions",key:"actions",render:(g,w)=>e.jsxs(ye,{size:"middle",children:[e.jsx(V,{type:"link",onClick:()=>{h(w._id),b.setFieldsValue({amount:w.amount,method:w.method,reference:w.reference,date:xe(w.date)}),c(!0)},children:"Edit"}),e.jsx(_e,{title:"Are you sure to delete this payment?",onConfirm:()=>d(w._id),okText:"Yes",cancelText:"No",children:e.jsx(V,{type:"link",danger:!0,children:"Delete"})})]})}];return e.jsxs(be,{title:`Payment History for Invoice #${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,placement:"right",onClose:A,open:a,width:720,children:[e.jsxs(I,{bordered:!0,column:1,size:"small",style:{marginBottom:20},children:[e.jsx(I.Item,{label:"Invoice Total",children:e.jsxs(ge,{strong:!0,children:["₹",((R=n==null?void 0:n.totalAmount)==null?void 0:R.toFixed(2))||"0.00"]})}),e.jsx(I.Item,{label:"Total Paid",children:e.jsxs(ge,{strong:!0,style:{color:B>0?"green":"inherit"},children:["₹",B.toFixed(2)]})}),e.jsx(I.Item,{label:"Outstanding Balance",children:e.jsxs(ge,{strong:!0,style:{color:m>0?"red":"green"},children:["₹",m.toFixed(2)]})})]}),!j&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Add New Payment"}),e.jsx(_,{form:S,layout:"vertical",onFinish:H,style:{marginBottom:20},children:e.jsxs(ye,{children:[e.jsx(_.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please input amount!"}],children:e.jsx(ee,{type:"number",step:"0.01"})}),e.jsx(_.Item,{name:"method",label:"Method",rules:[{required:!0,message:"Please select method!"}],children:e.jsxs(Y,{style:{width:120},children:[e.jsx(Y.Option,{value:"Cash",children:"Cash"}),e.jsx(Y.Option,{value:"UPI",children:"UPI"}),e.jsx(Y.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(Y.Option,{value:"Card",children:"Card"})]})}),e.jsx(_.Item,{name:"reference",label:"Reference",children:e.jsx(ee,{})}),e.jsx(_.Item,{name:"date",label:"Date",rules:[{required:!0,message:"Please select date!"}],children:e.jsx(ce,{style:{width:"100%"},defaultValue:xe(),format:"DD/MM/YYYY"})}),e.jsx(V,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},htmlType:"submit",loading:f,children:"Add Payment"})]})})]}),e.jsx("h3",{children:"Payment History"}),e.jsx(D,{dataSource:T.paymentHistory,columns:M,rowKey:"_id",pagination:!1,scroll:{x:"max-content"}}),e.jsx(pe,{open:t,title:"Edit Payment Entry",onCancel:()=>c(!1),onOk:()=>b.submit(),okText:"Update",cancelText:"Cancel",children:e.jsxs(_,{layout:"vertical",form:b,onFinish:P,children:[e.jsx(_.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(ee,{type:"number"})}),e.jsx(_.Item,{name:"method",label:"Method",rules:[{required:!0}],children:e.jsxs(Y,{children:[e.jsx(Y.Option,{value:"Cash",children:"Cash"}),e.jsx(Y.Option,{value:"UPI",children:"UPI"}),e.jsx(Y.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(Y.Option,{value:"Card",children:"Card"})]})}),e.jsx(_.Item,{name:"reference",label:"Reference",rules:[{required:!0}],children:e.jsx(ee,{})}),e.jsx(_.Item,{name:"date",label:"Date",rules:[{required:!0}],children:e.jsx(ce,{style:{width:"100%"},format:"DD/MM/YYYY"})})]})})]})},{TextArea:bt}=ee,{TabPane:fe}=W,{Text:Be}=ue,wt=({visible:a,onClose:A,invoice:n,refreshInvoices:u})=>{const[S,b]=x.useState(""),[f,y]=x.useState(null),[T,i]=x.useState(!1),[t,c]=x.useState([]),[r,h]=x.useState(null);x.useEffect(()=>{a&&(n!=null&&n._id)&&B()},[a,n]);const B=async()=>{try{const d=await q.get(`/api/invoices/${n._id}/followups`);c(d.data||[])}catch(d){console.error("Failed to fetch follow-ups:",d),Q.error("Failed to fetch follow-ups")}},E=()=>{if(!S||!f){Q.error("Please fill in both date and note fields.");return}const d=JSON.parse(localStorage.getItem("user")),P=d==null?void 0:d._id;if(!P){Q.error("User information not found. Please log in.");return}i(!0);const M={date:f.format("YYYY-MM-DD"),note:S,addedBy:P};(r===null?q.post(`/api/invoices/${n._id}/followups`,M):q.put(`/api/invoices/${n._id}/followups/${r}`,M)).then(()=>{Q.success(r===null?"Follow-up added successfully!":"Follow-up updated successfully!"),b(""),y(null),h(null),B(),u()}).catch(g=>{var w,F;console.error("Error saving follow-up:",g),Q.error(((F=(w=g==null?void 0:g.response)==null?void 0:w.data)==null?void 0:F.message)||"Failed to save follow-up.")}).finally(()=>i(!1))},m=d=>{const P=t[d];b(P.note),y(se(P.date)),h(d)},C=d=>{pe.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up? This action cannot be undone.",okText:"Yes, Delete",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{q.delete(`/api/invoices/${n._id}/followups/${d}`).then(()=>{Q.success("Follow-up deleted successfully!"),B(),u()}).catch(P=>{var M,R;console.error("Error deleting follow-up:",P),Q.error(((R=(M=P==null?void 0:P.response)==null?void 0:M.data)==null?void 0:R.message)||"Failed to delete follow-up.")})}})},j=se().format("YYYY-MM-DD"),N=[...t].sort((d,P)=>new Date(P.date)-new Date(d.date)),L=N.filter(d=>se(d.date).format("YYYY-MM-DD")===j),G=N.filter(d=>se(d.date).isAfter(j,"day")),p=N.filter(d=>se(d.date).isBefore(j,"day")),H=(d,P)=>{var M,R;return e.jsx(le.Item,{actions:[e.jsx(V,{type:"link",onClick:()=>m(P),children:"Edit"},"edit"),e.jsx(V,{type:"link",danger:!0,onClick:()=>C(P),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(Be,{strong:!0,children:se(d.date).format("DD-MM-YYYY")}),e.jsx("br",{}),d.note,e.jsx("br",{}),e.jsxs(Be,{type:"secondary",children:["By ",((M=d.addedBy)==null?void 0:M.name)||((R=d.addedBy)==null?void 0:R.email)||"Unknown User"]})]})})};return e.jsxs(be,{title:`Follow-ups for Invoice: ${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,open:a,onClose:()=>{h(null),b(""),y(null),A()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(ce,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:f,onChange:d=>y(d),placeholder:"Select follow-up date"}),e.jsx(bt,{rows:4,placeholder:"Enter follow-up note",value:S,onChange:d=>b(d.target.value)}),e.jsx(V,{type:"primary",style:{marginTop:10,backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},block:!0,onClick:E,loading:T,children:r===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(ie,{children:"Existing Follow-ups"}),e.jsxs(W,{defaultActiveKey:"today",children:[e.jsx(fe,{tab:`Today's (${L.length})`,children:e.jsx(le,{dataSource:L,renderItem:d=>H(d,t.indexOf(d)),locale:{emptyText:"No follow-ups scheduled for today."}})},"today"),e.jsx(fe,{tab:`Upcoming (${G.length})`,children:e.jsx(le,{dataSource:G,renderItem:d=>H(d,t.indexOf(d)),locale:{emptyText:"No upcoming follow-ups."}})},"upcoming"),e.jsx(fe,{tab:`Past (${p.length})`,children:e.jsx(le,{dataSource:p,renderItem:d=>H(d,t.indexOf(d)),locale:{emptyText:"No past follow-ups."}})},"past")]})]})},Oe="/assets/Primary%20Logo%2001-CdgCE0FA.png",Z=a=>isNaN(a)?"0.00":a.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),jt=a=>{if(typeof a!="number"||isNaN(a))return"N/A";let A=Math.floor(a),n=Math.round((a-A)*100);const u=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],S=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],b=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],f=["","Thousand","Lakh","Crore"],y=r=>r<10?u[r]:r>=10&&r<20?S[r-10]:b[Math.floor(r/10)]+(r%10!==0?" "+u[r%10]:"");let T=[],i=0;if(A===0)T.push("Zero");else{let r=A%1e3;for(r>0&&(r<100?T.push(y(r)):T.push(u[Math.floor(r/100)]+" Hundred"+(r%100!==0?" "+y(r%100):""))),A=Math.floor(A/1e3);A>0;){let h=A%100;h>0?T.push(y(h)+" "+f[++i]):i++,A=Math.floor(A/100)}}const t=T.reverse().filter(Boolean).join(" ").trim();let c=t?t+" Rupees":"Zero Rupees";return n>0&&(c+=` and ${y(n)} Paisa`),c+=" Only",c.replace(/\s+/g," ")},It=a=>{var E,m,C,j,N,L,G;const A=((E=a.businessId)==null?void 0:E.contactName)||a.contactName||"N/A",n=a.mobileNumber||((m=a.businessId)==null?void 0:m.mobileNumber)||((C=a.businessId)==null?void 0:C.phone)||"N/A",u=((j=a.businessId)==null?void 0:j.email)||a.email||"N/A",S=((N=a.businessId)==null?void 0:N.gstNumber)||a.gstin||"N/A",b=a.businessId?`${a.businessId.addressLine1||""}, ${a.businessId.addressLine2||""}, ${a.businessId.addressLine3||""}, ${a.businessId.city||""} - ${a.businessId.pincode||""}, ${a.businessId.state||""}, ${a.businessId.country||""}`:a.customerAddress||"N/A",f=parseFloat(a.subTotal)||0,y=parseFloat(a.igstAmount)||0,T=parseFloat(a.cgstAmount)||0,i=parseFloat(a.sgstAmount)||0,t=parseFloat(a.totalAmount)||0,c=Oe,r=Oe,h=()=>{if(a.gstType==="interstate")return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">IGST (${a.gstPercentage||0}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Z(y)}</td>
                </tr>
            `;if(a.gstType==="intrastate"){const p=(a.gstPercentage||0)/2;return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">CGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Z(T)}</td>
                </tr>
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">SGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${Z(i)}</td>
                </tr>
            `}return""},B=a.notes&&Array.isArray(a.notes)&&a.notes.length>0?a.notes.map(p=>`<p style="margin: 2px 0;">${p.text}</p>`).join(""):'<p style="margin: 2px 0;">Thank you for your business!</p>';return`
    <div style="padding: 10px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; width: 100%; box-sizing: border-box;">
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="display: flex; align-items: center;">
                    <img src="${c}" alt="Company Logo" style="height: 60px; margin-right: 10px;">
                    <div>
                        <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 3px;">ACE AUTOMATION</h2>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">S.F. No. 91, 14B, Padiveedu Thottam,</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Kalapatty road, Saravanampatti (PO),</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Coimbatore - 641 035. TN, INDIA.</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">+91 98422 53389 | aceautomation.cbe@gmail.com</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">www.aceautomation.in | GST No. : 33AVDPD3093Q1ZD</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; padding: 10px 20px; font-weight: 600; font-size: 18px; text-align: center; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    TAX INVOICE
                </div>
            </div>
            <div style="border-bottom: 1px solid #eee; margin-bottom: 10px;"></div>
        </div>

        <div style="margin-bottom: 20px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Bill To</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${((L=a.businessId)==null?void 0:L.businessName)||a.customerName||"N/A"}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Invoice No</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${a.invoiceNumber||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Contact Person</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${A}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${a.date||new Date().toLocaleDateString("en-IN")}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Mobile</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${n}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Due Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${a.dueDate||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Email</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${u}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">GSTIN</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${S}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Address</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${b}
                    </td>
                </tr>
            </table>
        </div>

        ${((G=a.items)==null?void 0:G.length)>0?`
                <div style="margin-top: 20px; overflow: hidden; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; font-size: 11px;">
                        <colgroup>
                            <col style="width: 5%;"> <col style="width: 20%;"> <col style="width: 25%;"> <col style="width: 10%;"> <col style="width: 8%;"> <col style="width: 12%;"> <col style="width: 10%;"> <col style="width: 10%;"> </colgroup>
                        <thead>
                            <tr style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white;">
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">S.No</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Product Name</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Specification</th>
                                <th style="1px solid #2c3e50; padding: 8px; text-align: center;">Qty</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">HSN/SAC</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Unit Price (₹)</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Total (₹)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${a.items.map((p,H)=>{var w;let d=(p==null?void 0:p.productName)||(p==null?void 0:p.description)||"";if(!d&&((w=p.specifications)==null?void 0:w.length)>0){const F=p.specifications.find(U=>U.name==="Model");F?d=F.value:p.specifications.length>0&&(d=p.specifications.map(U=>`${U.name}: ${U.value}`).join(", "))}d=d||"N/A";const P=p!=null&&p.specifications&&p.specifications.length>0?p.specifications.map(F=>`${F.name}: ${F.value}`).join(", "):"N/A",M=parseFloat(p.quantity)||0,R=parseFloat(p.rate)||0,g=(M*R).toFixed(2);return`
                                    <tr style="${H%2===0?"background: #fff;":"background: #f9fafb;"}">
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${H+1}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${d}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${P}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${M}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.quantityType||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.hsnSac||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; vertical-align: top;">₹${Z(R)}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; vertical-align: top;">₹${Z(parseFloat(g))}</td>
                                    </tr>
                                `}).join("")}
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 15px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%; background: #f0f2f5;">Sub Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%;">₹${Z(f)}</td>
                        </tr>
                        ${h()}
                        <tr style="background: #e8f5e9;">
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">Grand Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">₹${Z(t)}</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-top: 10px; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="font-weight: 600; padding: 3px; width: 25%; color: #555;">Amount In Words</td>
                            <td style="padding: 3px; font-style: italic; width: 75%;">${jt(t)}</td>
                        </tr>
                    </table>
                </div>
            `:""}

        <div style="margin-top: 15px; font-size: 11px; color: #555;">
            <p style="margin: 4px 0; font-weight: 600; color: #2c3e50;">Payment Terms:</p>
            <p style="margin: 1px 0;">${a.paymentTerms||"Payment due within 15 days of invoice date."}</p>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Notes:</p>
            <div style="margin-left: 5px;">
                ${B}
            </div>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Bank Details:</p>
            <p style="margin: 1px 0;">Bank Name: Your Bank Name</p>
            <p style="margin: 1px 0;">Account Number: XXXXXXXXXXXX</p>
            <p style="margin: 1px 0;">IFSC Code: XXXXXXXXXX</p>
            <p style="1px 0;">Branch: Your Branch Name</p>
        </div>

        <div style="margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;">
            <div style="text-align: right;">
                <img src="${r}" alt="Authorized Signature" style="height: 50px; display: block; margin-left: auto; margin-bottom: 3px;">
                <p style="margin: 4px 0; font-size: 11px; font-weight: 600; color: #2c3e50;">Authorized Signatory</p>
            </div>
            <p style="text-align: center; font-size: 9px; color: #999; margin-top: 15px;">
                This is Computer Generated Invoice & requires no Signature
            </p>
        </div>
    </div>
    `},St=async a=>{if(!a)return;const A=z.loading("Generating Invoice PDF...",{position:"top-center"});let n=null;try{const u=It(a),S=new ot({orientation:"portrait",unit:"mm",format:"a4",hotfixes:["px_scaling"]});S.setProperties({title:`Invoice - ${a.invoiceNumber}`,subject:"Invoice",author:a.companyName||"ACE AUTOMATION",keywords:"invoice, billing",creator:"Invoice Management System"});const b=S.internal.pageSize.getWidth(),f=S.internal.pageSize.getHeight(),y=5;n=document.createElement("div"),n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",n.style.width=`${b-2*y}mm`,n.style.background="white",n.style.zIndex="-1",n.style.display="block",n.innerHTML=u,document.body.appendChild(n),await new Promise(E=>setTimeout(E,200));const i=(await at(n,{scale:2,useCORS:!0,logging:!1,allowTaint:!0,letterRendering:!0,backgroundColor:"#ffffff"})).toDataURL("image/jpeg",.8),t=S.getImageProperties(i),c=t.height*(b-2*y)/t.width;let r=y,h=f-2*y;if(c>h){let E=c,m=0;for(S.addImage(i,"JPEG",y,r,b-2*y,c),E-=h,m-=h;E>0;)S.addPage(),S.addImage(i,"JPEG",y,m+r,b-2*y,c),E-=h,m-=h}else S.addImage(i,"JPEG",y,r,b-2*y,c);const B=S.output("blob");Re.saveAs(B,`invoice-${a.invoiceNumber||"draft"}.pdf`),z.success("Invoice PDF downloaded successfully!",{id:A})}catch(u){console.error("Error generating PDF:",u),z.error("Failed to generate PDF. Please try again.",{id:A})}finally{n&&document.body.contains(n)&&document.body.removeChild(n)}},{Text:$}=ue,{RangePicker:Nt}=ce,At=({invoices:a,onAddNew:A,onEdit:n,onDelete:u,onSearch:S,refreshInvoices:b})=>{var Ie,Se,Ne,Ae,Te,Ce,Fe,ke;const[f,y]=x.useState(""),[T,i]=x.useState(!1),[t,c]=x.useState(null),[r,h]=x.useState("all"),[B,E]=x.useState(!1),[m,C]=x.useState(!1),[j,N]=x.useState(!1),[L,G]=x.useState(null),[p,H]=x.useState("all"),[d,P]=x.useState(!1),[M,R]=x.useState({}),g=[...new Set(a.map(s=>s.businessName))],w=x.useCallback(s=>{var k;const o=parseFloat(s.totalAmount)||0,l=((k=s.paymentHistory)==null?void 0:k.reduce((O,v)=>O+parseFloat(v.amount||0),0))||0;return o<=0?"N/A":l>=o-.01?"paid":l>0&&l<o?"partial":"pending"},[]);x.useEffect(()=>{const s={};a.forEach(o=>{s[o._id]=w(o)}),R(s)},[a,w]),x.useEffect(()=>{t&&console.log(`Selected Invoice ${t.invoiceNumber} isClosed: ${t.isClosed}`)},[t]);const F=x.useCallback(s=>isNaN(s)?"0.00":s.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),[]),U=s=>{y(s),S(s)},K=s=>{c(s),i(!0)},me=s=>{c(s),E(!0)},Le=s=>{c(s),N(!0)},Ye=s=>{c(s),P(!0)},Ue=s=>{c(s),C(!0)},ze=()=>{const s=we.map((v,J)=>({SNo:J+1,Number:v.invoiceNumber,Business:v.businessName,Customer:v.customerName,ContactName:v.contactName||"N/A",Email:v.email||"N/A",MobileNumber:v.mobileNumber||"N/A",TotalAmount:v.totalAmount||0,Date:v.date,DueDate:v.dueDate||"",Status:M[v._id]||v.paymentStatus})),o=he.json_to_sheet(s),l=he.book_new();he.book_append_sheet(l,o,"Invoices");const k=st(l,{bookType:"xlsx",type:"array"}),O=new Blob([k],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Re.saveAs(O,`Invoices-${new Date().toISOString().split("T")[0]}.xlsx`)},we=a.filter(s=>{var te,oe,ae,ne,$e,Pe;const o=s.invoiceType==="Invoice",l=!f||((te=s.invoiceNumber)==null?void 0:te.toLowerCase().includes(f.toLowerCase()))||((oe=s.businessName)==null?void 0:oe.toLowerCase().includes(f.toLowerCase()))||((ae=s.customerName)==null?void 0:ae.toLowerCase().includes(f.toLowerCase()))||((ne=s.contactName)==null?void 0:ne.toLowerCase().includes(f.toLowerCase()))||(($e=s.email)==null?void 0:$e.toLowerCase().includes(f.toLowerCase()))||((Pe=s.mobileNumber)==null?void 0:Pe.toLowerCase().includes(f.toLowerCase())),k=!L||new Date(s.date)>=L[0].toDate()&&new Date(s.date)<=L[1].toDate(),O=M[s._id],v=r==="all"?!0:r==="overdue"?O!=="paid"&&new Date(s.dueDate)<new Date:O===r,J=p==="all"?!0:s.businessName===p;return o&&l&&k&&v&&J}),je=s=>{let o="red",l="Payment Pending";return s==="paid"?(o="green",l="Completed Payment"):s==="partial"&&(o="orange",l="Partial Payment"),e.jsx(ve,{color:o,children:l})},Ve=()=>[{title:"S.No",width:60,align:"center",render:(s,o,l)=>l+1},{title:"Product Name",dataIndex:"productName",ellipsis:!0,render:(s,o)=>{var k;let l=s||o.description||"";if(!l&&((k=o.specifications)==null?void 0:k.length)>0){const O=o.specifications.find(v=>v.name==="Model");O&&(l=O.value)}return l||"N/A"}},{title:"Description",dataIndex:"description",ellipsis:!0,render:(s,o)=>{var l;if(!s&&((l=o.specifications)==null?void 0:l.length)>0){const k=o.specifications.find(O=>O.name==="SPECIFICATION");return k?k.value:"N/A"}return s||"N/A"}},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center",render:s=>s||"N/A"},{title:"Qty",dataIndex:"quantity",width:80,align:"center",render:s=>parseFloat(s)||0},{title:"Unit Price (₹)",width:140,align:"right",render:(s,o)=>F(o.rate||0)},{title:"Total (₹)",width:140,align:"right",render:(s,o)=>e.jsx($,{strong:!0,style:{color:"#52c41a"},children:F((o.quantity||0)*(o.rate||0))})}],He=[{title:"S.No",render:(s,o,l)=>e.jsx($,{strong:!0,children:l+1}),width:60},{title:"Invoice Number",render:(s,o)=>e.jsx(ve,{icon:e.jsx(Ee,{}),color:"blue",children:o.invoiceNumber})},{title:"Business",render:(s,o)=>{var k;const l=((k=o.businessId)==null?void 0:k.businessName)||o.businessName;return e.jsx(Qe,{title:l,children:e.jsx($,{strong:!0,children:l})})}},{title:"Contact Person",dataIndex:"contactName",render:(s,o)=>{var l;return((l=o.businessId)==null?void 0:l.contactName)||s||"N/A"}},{title:"Email",dataIndex:"email",render:(s,o)=>{var l;return((l=o.businessId)==null?void 0:l.email)||s||"N/A"}},{title:"Mobile",dataIndex:"mobileNumber",render:(s,o)=>{var l,k;return((l=o.businessId)==null?void 0:l.mobileNumber)||((k=o.businessId)==null?void 0:k.phoneNumber)||s||"N/A"}},{title:"Amount",dataIndex:"totalAmount",align:"right",render:s=>e.jsxs($,{style:{color:"#52c41a"},children:["₹",s||0]})},{title:"Due Date",dataIndex:"dueDate",align:"center",render:s=>e.jsx($,{children:s||"N/A"})},{title:"Payment Status",key:"paymentStatusLabel",align:"center",render:(s,o)=>{const l=M[o._id]||"pending";return je(l)}},{title:"Actions",width:80,render:(s,o)=>e.jsx(Ze,{overlay:e.jsxs(X,{children:[e.jsx(X.Item,{icon:e.jsx(et,{}),onClick:()=>K(o),children:"View Invoice Details"},"view"),e.jsx(X.Item,{icon:e.jsx(Ee,{}),onClick:()=>Ye(o),children:"View Item Specifications"},"view-specs"),e.jsx(X.Item,{icon:e.jsx(lt,{}),onClick:()=>St(o),children:"Generate PDF"},"generate-pdf"),e.jsx(X.Item,{icon:e.jsx(it,{}),onClick:()=>me(o),children:"View Notes"},"view-notes"),e.jsx(X.Item,{icon:e.jsx(dt,{}),onClick:()=>Ue(o),children:"Add/View Follow-ups"},"add-followup"),e.jsx(X.Item,{icon:e.jsx(mt,{}),onClick:()=>Le(o),children:"View Payments"},"view-payments"),!o.isClosed&&e.jsx(X.Item,{icon:e.jsx(tt,{}),onClick:()=>n(o),children:"Edit Invoice"},"edit"),e.jsx(X.Item,{icon:e.jsx(ct,{}),disabled:o.isClosed,children:e.jsx(_e,{title:o.isClosed?"This invoice is locked and cannot be deleted.":"Are you sure you want to delete this invoice? This action cannot be undone.",onConfirm:()=>u(o._id),okText:"Yes, Delete",cancelText:"No",disabled:o.isClosed,children:"Delete Invoice"})},"delete")]}),trigger:["click"],children:e.jsx(V,{icon:e.jsx(rt,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsxs(We,{title:"Invoice Management",extra:e.jsxs(ye,{wrap:!0,children:[e.jsx(Nt,{onChange:G,format:"YYYY-MM-DD"}),e.jsxs(Y,{value:p,onChange:H,placeholder:"Filter by Business",style:{width:200},allowClear:!0,children:[e.jsx(Y.Option,{value:"all",children:"All Businesses"}),g.map(s=>e.jsx(Y.Option,{value:s,children:s},s))]}),e.jsx(ee.Search,{placeholder:"Search invoices",onSearch:U,onChange:s=>U(s.target.value),style:{width:240},allowClear:!0,prefix:e.jsx(Ke,{})}),e.jsx(V,{onClick:ze,children:"Export Excel"}),e.jsx(V,{type:"primary",icon:e.jsx(Je,{}),onClick:A,style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:"New Invoice"})]}),children:[e.jsxs(W,{activeKey:r,onChange:h,type:"card",size:"small",children:[e.jsx(W.TabPane,{tab:"All"},"all"),e.jsx(W.TabPane,{tab:"Partial"},"partial"),e.jsx(W.TabPane,{tab:"Pending"},"pending"),e.jsx(W.TabPane,{tab:"Paid"},"paid"),e.jsx(W.TabPane,{tab:"Overdue"},"overdue")," "]}),e.jsx(D,{dataSource:we,columns:He,rowKey:"_id",pagination:{pageSize:10},bordered:!0,scroll:{x:!0}})]}),e.jsx(pe,{title:"Invoice Details",open:T,onCancel:()=>i(!1),footer:e.jsx(V,{onClick:()=>i(!1),children:"Close"}),width:1e3,children:t&&e.jsxs("div",{children:[e.jsxs(I,{bordered:!0,column:2,size:"small",children:[e.jsx(I.Item,{label:"Invoice No",children:t.invoiceNumber}),e.jsx(I.Item,{label:"Date",children:t.date?new Date(t.date).toLocaleDateString("en-IN"):"N/A"}),e.jsx(I.Item,{label:"Due Date",children:t.dueDate?new Date(t.dueDate).toLocaleDateString("en-IN"):"N/A"}),e.jsx(I.Item,{label:"Business",children:t.businessName}),e.jsx(I.Item,{label:"Customer",children:t.contactName||t.customerName||"N/A"}),e.jsx(I.Item,{label:"Contact Person",children:t.contactName||"N/A"}),e.jsx(I.Item,{label:"Email",children:t.email||"N/A"}),e.jsx(I.Item,{label:"Mobile Number",children:t.mobileNumber||"N/A"}),e.jsx(I.Item,{label:"GSTIN",span:2,children:e.jsx($,{code:!0,children:((Ie=t.businessId)==null?void 0:Ie.gstNumber)||t.gstin||"N/A"})}),e.jsx(I.Item,{label:"Business Info",span:2,children:e.jsx($,{style:{whiteSpace:"pre-wrap"},children:t.businessId?`${t.businessId.addressLine1||""}
${t.businessId.addressLine2||""}
${t.businessId.addressLine3||""}
${t.businessId.city||""} - ${t.businessId.pincode||""}
${t.businessId.state||""}, ${t.businessId.country||""}`.trim():t.customerAddress||"N/A"})})]}),((Se=t.items)==null?void 0:Se.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ie,{orientation:"left",children:["Items (",t.items.length,")"]}),e.jsx(D,{dataSource:t.items,columns:Ve(),pagination:!1,size:"small",rowKey:(s,o)=>`${t._id}-item-${o}`,bordered:!0,expandable:{expandedRowRender:s=>{var o;return e.jsx("div",{style:{margin:0,padding:0},children:((o=s.specifications)==null?void 0:o.length)>0&&e.jsx(I,{column:1,size:"small",children:s.specifications.filter(l=>l.name!=="SPECIFICATION").map((l,k)=>e.jsx(I.Item,{label:l.name,children:l.value},k))})})},rowExpandable:s=>{var o;return((o=s.specifications)==null?void 0:o.length)>0}},summary:s=>{const o=s.reduce((ae,ne)=>ae+(ne.quantity||0)*(ne.rate||0),0),l=t.gstPercentage||0,k=t.gstType||"intrastate";let O=0,v=0,J=0,te=0;k==="interstate"?(te=o*(l/100),O=te):(v=o*(l/200),J=o*(l/200),O=v+J);const oe=o+O;return e.jsxs(D.Summary,{fixed:!0,children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsx($,{strong:!0,children:"Sub Total:"})}),e.jsx(D.Summary.Cell,{index:7,children:e.jsx($,{strong:!0,children:F(o)})})]}),k==="interstate"?e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsxs($,{strong:!0,children:["IGST (",l,"%):"]})}),e.jsx(D.Summary.Cell,{index:7,children:e.jsx($,{strong:!0,children:F(te)})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsxs($,{strong:!0,children:["CGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx($,{strong:!0,children:F(v)})})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsxs($,{strong:!0,children:["SGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx($,{strong:!0,children:F(J)})})]})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:7,align:"right",children:e.jsx($,{strong:!0,children:"Grand Total:"})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx($,{strong:!0,style:{color:"#52c41a"},children:F(oe)})})]}),e.jsx(D.Summary.Row,{children:e.jsx(D.Summary.Cell,{index:0,colSpan:6,children:e.jsxs($,{italic:!0,children:["Amount in words:"," ","Rupees Only"]})})})]})}})]}),e.jsxs(I,{column:4,bordered:!0,size:"small",style:{marginTop:"20px"},children:[e.jsxs(I.Item,{label:"Sub Total",span:2,children:["₹",((Ne=t.subTotal)==null?void 0:Ne.toFixed(2))||"0.00"]}),t.gstType==="interstate"?e.jsxs(I.Item,{label:"IGST Amount",span:2,children:["₹",((Ae=t.igstAmount)==null?void 0:Ae.toFixed(2))||"0.00"]}):e.jsxs(e.Fragment,{children:[e.jsxs(I.Item,{label:"CGST Amount",span:1,children:["₹",((Te=t.cgstAmount)==null?void 0:Te.toFixed(2))||"0.00"]}),e.jsxs(I.Item,{label:"SGST Amount",span:1,children:["₹",((Ce=t.sgstAmount)==null?void 0:Ce.toFixed(2))||"0.00"]})]}),e.jsx(I.Item,{label:"Grand Total",span:2,children:e.jsxs($,{strong:!0,style:{fontSize:"18px",color:"#52c41a"},children:["₹",((Fe=t.totalAmount)==null?void 0:Fe.toFixed(2))||"0.00"]})}),e.jsx(I.Item,{label:"Amount in Words",span:2,children:e.jsx($,{italic:!0,children:"Rupees Only"})}),e.jsx(I.Item,{label:"Status",span:2,children:je(M[t._id])})]}),((ke=t.notes)==null?void 0:ke.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ie,{orientation:"left",children:["Notes (",t.notes.length,")"]}),t.notes.map((s,o)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx($,{strong:!0,children:s.author})," on"," ",e.jsx($,{type:"secondary",children:s.timestamp}),e.jsx("p",{children:s.text})]},o))]})]})}),e.jsx(pe,{title:"Item Specifications",open:d,onCancel:()=>P(!1),footer:e.jsx(V,{onClick:()=>P(!1),children:"Close"}),width:800,children:t&&t.items&&t.items.map((s,o)=>e.jsxs("div",{style:{marginBottom:"20px",border:"1px solid #f0f0f0",padding:"15px",borderRadius:"5px"},children:[e.jsxs($,{strong:!0,style:{fontSize:"16px",marginBottom:"10px",display:"block"},children:["Item ",o+1,": ",s.productName||s.description||"N/A"]}),e.jsxs(I,{bordered:!0,column:2,size:"small",style:{marginBottom:"15px"},children:[e.jsx(I.Item,{label:"Name",children:s.productName||s.description||"N/A"}),e.jsxs(I.Item,{label:"Price",children:["₹",F(s.rate)]}),e.jsx(I.Item,{label:"Qty",children:s.quantity}),e.jsx(I.Item,{label:"Description",children:s.description||"N/A"})]}),s.specifications&&s.specifications.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ie,{orientation:"left",style:{margin:"15px 0"},children:e.jsx($,{strong:!0,children:"Product Options"})}),e.jsx(D,{dataSource:s.specifications,columns:[{title:"Type",dataIndex:"name",render:l=>l||"N/A"},{title:"Description",dataIndex:"value",render:l=>l||"N/A"}],pagination:!1,size:"small",rowKey:(l,k)=>`spec-${k}`,bordered:!0})]})]},o))}),t&&e.jsx(ft,{visible:B,onClose:()=>E(!1),invoice:t,refreshInvoices:b}),t&&e.jsx(wt,{visible:m,onClose:()=>C(!1),invoice:t,refreshInvoices:b}),e.jsx(yt,{visible:j,onClose:()=>N(!1),invoice:t,refreshInvoices:b})]})},Ot=Object.freeze(Object.defineProperty({__proto__:null,default:At},Symbol.toStringTag,{value:"Module"}));export{At as I,ft as N,Ot as a};
