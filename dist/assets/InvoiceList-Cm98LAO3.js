import{r as m,I as Re,u as Be,m as le,n as e,S as Ke,B as H,D as fe,V as R,P as Q,Q as Pe,Z as De,T as Qe,U as Je,W as V}from"./index-DFkeGJve.js";import{u as me,w as Ze}from"./xlsx-CyWl6TWy.js";import{i as G,c as et}from"./axios-CXM2YcLm.js";import{F as L}from"./index-oCTpfyYp.js";import{D as be}from"./index-BLLH8eYJ.js";import{I as Z,b as tt}from"./index-Dna1ZuSU.js";import{R as st}from"./SendOutlined-DgfFi3Lj.js";import{T as ue,a as ie}from"./index-CuiCWRnG.js";import{s as Ee}from"./index-DBFsFtmF.js";import{D as ce,d as xe}from"./index-B5qbg8CL.js";import{D as A}from"./index-fnliRwNJ.js";import{S as M}from"./index-BXtwvscy.js";import{F as D}from"./Table-KvRATXsL.js";import{M as ne}from"./index-ISEoUsk9.js";import{P as _e}from"./index-BYTsHZqg.js";import{h as se}from"./moment-C5S46NFB.js";import{D as ye}from"./index-83aYk6oH.js";import{T as Le,R as nt}from"./index-aFscFpMp.js";import{L as ee}from"./index-2VGcZWEN.js";import{E as ot,h as rt,R as at}from"./html2canvas.esm-q3sVWcd6.js";import{C as lt}from"./index-BxobYtMX.js";import{R as it}from"./PrinterOutlined-CuehxlWX.js";import{R as dt}from"./MessageOutlined-CT12yonJ.js";import{R as ct}from"./ScheduleOutlined-CBj-i2N2.js";import{R as ut}from"./DollarOutlined-B1B1da7m.js";import{R as pt}from"./EditOutlined-uiPjFWnN.js";import{R as mt}from"./DeleteOutlined-BH5Qblkw.js";var xt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464h-68V240c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zM332 240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v224H332V240zm460 600H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"lock",theme:"outlined"},ht=function(S,n){return m.createElement(Re,Be({},S,{ref:n,icon:xt}))},gt=m.forwardRef(ht),ft={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M832 464H332V240c0-30.9 25.1-56 56-56h248c30.9 0 56 25.1 56 56v68c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-68c0-70.7-57.3-128-128-128H388c-70.7 0-128 57.3-128 128v224h-68c-17.7 0-32 14.3-32 32v384c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V496c0-17.7-14.3-32-32-32zm-40 376H232V536h560v304zM484 701v53c0 4.4 3.6 8 8 8h40c4.4 0 8-3.6 8-8v-53a48.01 48.01 0 10-56 0z"}}]},name:"unlock",theme:"outlined"},yt=function(S,n){return m.createElement(Re,Be({},S,{ref:n,icon:ft}))},bt=m.forwardRef(yt),de={exports:{}},wt=de.exports,Me;function jt(){return Me||(Me=1,function(r,S){(function(n,x){x()})(wt,function(){function n(i,s){return typeof s>"u"?s={autoBom:!1}:typeof s!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),s={autoBom:!s}),s.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(i.type)?new Blob(["\uFEFF",i],{type:i.type}):i}function x(i,s,u){var a=new XMLHttpRequest;a.open("GET",i),a.responseType="blob",a.onload=function(){k(a.response,s,u)},a.onerror=function(){console.error("could not download file")},a.send()}function I(i){var s=new XMLHttpRequest;s.open("HEAD",i,!1);try{s.send()}catch{}return 200<=s.status&&299>=s.status}function c(i){try{i.dispatchEvent(new MouseEvent("click"))}catch{var s=document.createEvent("MouseEvents");s.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),i.dispatchEvent(s)}}var y=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof le=="object"&&le.global===le?le:void 0,b=y.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),k=y.saveAs||(typeof window!="object"||window!==y?function(){}:"download"in HTMLAnchorElement.prototype&&!b?function(i,s,u){var a=y.URL||y.webkitURL,g=document.createElement("a");s=s||i.name||"download",g.download=s,g.rel="noopener",typeof i=="string"?(g.href=i,g.origin===location.origin?c(g):I(g.href)?x(i,s,u):c(g,g.target="_blank")):(g.href=a.createObjectURL(i),setTimeout(function(){a.revokeObjectURL(g.href)},4e4),setTimeout(function(){c(g)},0))}:"msSaveOrOpenBlob"in navigator?function(i,s,u){if(s=s||i.name||"download",typeof i!="string")navigator.msSaveOrOpenBlob(n(i,u),s);else if(I(i))x(i,s,u);else{var a=document.createElement("a");a.href=i,a.target="_blank",setTimeout(function(){c(a)})}}:function(i,s,u,a){if(a=a||open("","_blank"),a&&(a.document.title=a.document.body.innerText="downloading..."),typeof i=="string")return x(i,s,u);var g=i.type==="application/octet-stream",B=/constructor/i.test(y.HTMLElement)||y.safari,E=/CriOS\/[\d]+/.test(navigator.userAgent);if((E||g&&B||b)&&typeof FileReader<"u"){var h=new FileReader;h.onloadend=function(){var T=h.result;T=E?T:T.replace(/^data:[^;]*;/,"data:attachment/file;"),a?a.location.href=T:location=T,a=null},h.readAsDataURL(i)}else{var C=y.URL||y.webkitURL,j=C.createObjectURL(i);a?a.location=j:location.href=j,a=null,setTimeout(function(){C.revokeObjectURL(j)},4e4)}});y.saveAs=k.saveAs=k,r.exports=k})}(de)),de.exports}var Ye=jt();const{TextArea:It}=Z,St=({visible:r,onClose:S,account:n,invoice:x,refreshInvoices:I,refreshAccounts:c})=>{const[y]=L.useForm(),[b,k]=m.useState([]),[i,s]=m.useState(!1);m.useEffect(()=>{var C;const h=((C=x||n)==null?void 0:C.notes)||[];k(Array.isArray(h)?h:[])},[x,n]);const u=()=>{try{const h=JSON.parse(localStorage.getItem("user"));return(h==null?void 0:h.name)||(h==null?void 0:h.email)||"Unknown"}catch{return"Unknown"}},a=()=>x?`/api/invoices/${x._id}`:`/api/accounts/${n._id}`,g=async({note:h})=>{if(!h)return;const C={text:h,timestamp:new Date().toISOString(),addedBy:u()},j=[...b,C];try{s(!0),await G.put(a(),{...x||n,notes:j}),Ee.success("Note added"),k(j),y.resetFields(),x?I==null||I():c==null||c()}catch(T){console.error("Failed to add note:",T),Ee.error("Failed to add note")}finally{s(!1)}},E=(h=>{const C={};return h.forEach(j=>{if(!j||typeof j!="object")return;const T=j.timestamp?new Date(j.timestamp).toLocaleDateString():"Unknown Date";C[T]||(C[T]=[]),C[T].push(j)}),C})(b);return e.jsx(be,{title:e.jsxs("div",{children:["Notes for ",x?"Invoice":"Account"," ",e.jsxs(ue.Text,{code:!0,children:["#",(x==null?void 0:x.invoiceNumber)||(n==null?void 0:n.businessName)]})]}),open:r,onClose:S,width:450,destroyOnClose:!0,children:e.jsxs(Ke,{spinning:i,children:[e.jsx("div",{style:{padding:"0 8px"},children:Object.entries(E).map(([h,C])=>e.jsxs("div",{children:[e.jsx("div",{className:"note-date-header",children:h}),C.map((j,T)=>e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[j.addedBy||"Unknown"," • ",j.timestamp?new Date(j.timestamp).toLocaleTimeString():""]}),e.jsx("div",{className:"note-text",children:typeof j.text=="string"?j.text:JSON.stringify(j.text)})]},T))]},h))}),e.jsxs(L,{form:y,layout:"vertical",onFinish:g,style:{marginTop:16},children:[e.jsx(L.Item,{name:"note",rules:[{required:!0,message:"Enter note"}],children:e.jsx(It,{rows:3,placeholder:"Type your note here..."})}),e.jsx(H,{htmlType:"submit",type:"primary",icon:e.jsx(st,{}),block:!0,children:"Add Note"})]})]})})},{Text:he}=ue,Nt=({visible:r,onClose:S,invoice:n,refreshInvoices:x})=>{var Y;const[I]=L.useForm(),[c]=L.useForm(),[y,b]=m.useState(!1),[k,i]=m.useState({paymentHistory:[]}),[s,u]=m.useState(!1),[a,g]=m.useState(null),[B,E]=m.useState(0),[h,C]=m.useState(0),[j,T]=m.useState(!1),U=f=>{const w=f.paymentHistory.reduce((F,z)=>F+z.amount,0);if(E(w),n!=null&&n.totalAmount){const F=n.totalAmount-w;C(F),T(F<=.01)}else C(0),T(!1)},q=()=>{try{const f=JSON.parse(localStorage.getItem("user"));return(f==null?void 0:f.email)||"Unknown"}catch{return"Unknown"}},p=async()=>{if(n!=null&&n._id)try{const f=await G.get(`/api/invoices/${n._id}`),w={...f.data,paymentHistory:Array.isArray(f.data.paymentHistory)?f.data.paymentHistory:[]};i(w),U(w)}catch(f){R.error("Failed to fetch invoice details."),console.error("Error fetching invoice:",f),i({paymentHistory:[]}),U({paymentHistory:[]})}};m.useEffect(()=>{r&&p()},[r,n==null?void 0:n._id]),m.useEffect(()=>{U(k)},[n==null?void 0:n.totalAmount,k.paymentHistory]);const X=async f=>{const w=parseFloat(f.amount);if(isNaN(w)||w<=0){R.error("Please enter a valid positive amount!");return}const F=k.paymentHistory.reduce((W,pe)=>W+pe.amount,0),z=(n==null?void 0:n.totalAmount)||0;if(F+w>z+.01){R.error(`Payment amount exceeds outstanding balance. Outstanding: ₹${(z-F).toFixed(2)}`);return}b(!0);try{const W={...f,date:f.date.format("YYYY-MM-DD"),addedBy:q()};await G.post(`/api/invoices/${n._id}/payments`,W),R.success("Payment added successfully!"),I.resetFields(),await p(),x()}catch(W){R.error("Failed to add payment."),console.error("Error adding payment:",W)}finally{b(!1)}},d=async f=>{try{await G.delete(`/api/invoices/${n._id}/payments/${f}`),R.success("Payment deleted successfully!"),await p(),x()}catch(w){R.error("Failed to delete payment."),console.error("Error deleting payment:",w)}},v=async f=>{try{const w={...f,date:f.date.format("YYYY-MM-DD")};await G.put(`/api/invoices/${n._id}/payments/${a}`,w),R.success("Payment updated successfully!"),u(!1),await p(),x()}catch(w){R.error("Failed to update payment."),console.error("Error updating payment:",w)}},O=[{title:"Amount",dataIndex:"amount",key:"amount",render:f=>`₹${Number(f).toFixed(2)}`},{title:"Method",dataIndex:"method",key:"method"},{title:"Reference",dataIndex:"reference",key:"reference"},{title:"Date",dataIndex:"date",key:"date",render:f=>xe(f).format("DD/MM/YYYY")},{title:"Added By",dataIndex:"addedBy",key:"addedBy"},{title:"Actions",key:"actions",render:(f,w)=>e.jsxs(fe,{size:"middle",children:[e.jsx(H,{type:"link",onClick:()=>{g(w._id),c.setFieldsValue({amount:w.amount,method:w.method,reference:w.reference,date:xe(w.date)}),u(!0)},children:"Edit"}),e.jsx(_e,{title:"Are you sure to delete this payment?",onConfirm:()=>d(w._id),okText:"Yes",cancelText:"No",children:e.jsx(H,{type:"link",danger:!0,children:"Delete"})})]})}];return e.jsxs(be,{title:`Payment History for Invoice #${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,placement:"right",onClose:S,open:r,width:720,children:[e.jsxs(A,{bordered:!0,column:1,size:"small",style:{marginBottom:20},children:[e.jsx(A.Item,{label:"Invoice Total",children:e.jsxs(he,{strong:!0,children:["₹",((Y=n==null?void 0:n.totalAmount)==null?void 0:Y.toFixed(2))||"0.00"]})}),e.jsx(A.Item,{label:"Total Paid",children:e.jsxs(he,{strong:!0,style:{color:B>0?"green":"inherit"},children:["₹",B.toFixed(2)]})}),e.jsx(A.Item,{label:"Outstanding Balance",children:e.jsxs(he,{strong:!0,style:{color:h>0?"red":"green"},children:["₹",h.toFixed(2)]})})]}),!j&&e.jsxs(e.Fragment,{children:[e.jsx("h3",{children:"Add New Payment"}),e.jsx(L,{form:I,layout:"vertical",onFinish:X,style:{marginBottom:20},children:e.jsxs(fe,{children:[e.jsx(L.Item,{name:"amount",label:"Amount",rules:[{required:!0,message:"Please input amount!"}],children:e.jsx(Z,{type:"number",step:"0.01"})}),e.jsx(L.Item,{name:"method",label:"Method",rules:[{required:!0,message:"Please select method!"}],children:e.jsxs(M,{style:{width:120},children:[e.jsx(M.Option,{value:"Cash",children:"Cash"}),e.jsx(M.Option,{value:"UPI",children:"UPI"}),e.jsx(M.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(M.Option,{value:"Card",children:"Card"})]})}),e.jsx(L.Item,{name:"reference",label:"Reference",children:e.jsx(Z,{})}),e.jsx(L.Item,{name:"date",label:"Date",rules:[{required:!0,message:"Please select date!"}],children:e.jsx(ce,{style:{width:"100%"},defaultValue:xe(),format:"DD/MM/YYYY"})}),e.jsx(H,{type:"primary",htmlType:"submit",loading:y,children:"Add Payment"})]})})]}),e.jsx("h3",{children:"Payment History"}),e.jsx(D,{dataSource:k.paymentHistory,columns:O,rowKey:"_id",pagination:!1,scroll:{x:"max-content"}}),e.jsx(ne,{open:s,title:"Edit Payment Entry",onCancel:()=>u(!1),onOk:()=>c.submit(),okText:"Update",cancelText:"Cancel",children:e.jsxs(L,{layout:"vertical",form:c,onFinish:v,children:[e.jsx(L.Item,{name:"amount",label:"Amount",rules:[{required:!0}],children:e.jsx(Z,{type:"number"})}),e.jsx(L.Item,{name:"method",label:"Method",rules:[{required:!0}],children:e.jsxs(M,{children:[e.jsx(M.Option,{value:"Cash",children:"Cash"}),e.jsx(M.Option,{value:"UPI",children:"UPI"}),e.jsx(M.Option,{value:"Bank Transfer",children:"Bank Transfer"}),e.jsx(M.Option,{value:"Card",children:"Card"})]})}),e.jsx(L.Item,{name:"reference",label:"Reference",rules:[{required:!0}],children:e.jsx(Z,{})}),e.jsx(L.Item,{name:"date",label:"Date",rules:[{required:!0}],children:e.jsx(ce,{style:{width:"100%"},format:"DD/MM/YYYY"})})]})})]})},{TextArea:Tt}=Z,{TabPane:ge}=Le,{Text:Oe}=ue,At=({visible:r,onClose:S,invoice:n,refreshInvoices:x})=>{const[I,c]=m.useState(""),[y,b]=m.useState(null),[k,i]=m.useState(!1),[s,u]=m.useState([]),[a,g]=m.useState(null);m.useEffect(()=>{r&&(n!=null&&n._id)&&B()},[r,n]);const B=async()=>{try{const d=await G.get(`/api/invoices/${n._id}/followups`);u(d.data||[])}catch(d){console.error("Failed to fetch follow-ups:",d),Q.error("Failed to fetch follow-ups")}},E=()=>{if(!I||!y){Q.error("Please fill in both date and note fields.");return}const d=JSON.parse(localStorage.getItem("user")),v=d==null?void 0:d._id;if(!v){Q.error("User information not found. Please log in.");return}i(!0);const O={date:y.format("YYYY-MM-DD"),note:I,addedBy:v};(a===null?G.post(`/api/invoices/${n._id}/followups`,O):G.put(`/api/invoices/${n._id}/followups/${a}`,O)).then(()=>{Q.success(a===null?"Follow-up added successfully!":"Follow-up updated successfully!"),c(""),b(null),g(null),B(),x()}).catch(f=>{var w,F;console.error("Error saving follow-up:",f),Q.error(((F=(w=f==null?void 0:f.response)==null?void 0:w.data)==null?void 0:F.message)||"Failed to save follow-up.")}).finally(()=>i(!1))},h=d=>{const v=s[d];c(v.note),b(se(v.date)),g(d)},C=d=>{ne.confirm({title:"Delete Follow-up",content:"Are you sure you want to delete this follow-up? This action cannot be undone.",okText:"Yes, Delete",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>{G.delete(`/api/invoices/${n._id}/followups/${d}`).then(()=>{Q.success("Follow-up deleted successfully!"),B(),x()}).catch(v=>{var O,Y;console.error("Error deleting follow-up:",v),Q.error(((Y=(O=v==null?void 0:v.response)==null?void 0:O.data)==null?void 0:Y.message)||"Failed to delete follow-up.")})}})},j=se().format("YYYY-MM-DD"),T=[...s].sort((d,v)=>new Date(v.date)-new Date(d.date)),U=T.filter(d=>se(d.date).format("YYYY-MM-DD")===j),q=T.filter(d=>se(d.date).isAfter(j,"day")),p=T.filter(d=>se(d.date).isBefore(j,"day")),X=(d,v)=>{var O,Y;return e.jsx(ee.Item,{actions:[e.jsx(H,{type:"link",onClick:()=>h(v),children:"Edit"},"edit"),e.jsx(H,{type:"link",danger:!0,onClick:()=>C(v),children:"Delete"},"delete")],children:e.jsxs("div",{children:[e.jsx(Oe,{strong:!0,children:se(d.date).format("DD-MM-YYYY")}),e.jsx("br",{}),d.note,e.jsx("br",{}),e.jsxs(Oe,{type:"secondary",children:["By ",((O=d.addedBy)==null?void 0:O.name)||((Y=d.addedBy)==null?void 0:Y.email)||"Unknown User"]})]})})};return e.jsxs(be,{title:`Follow-ups for Invoice: ${(n==null?void 0:n.invoiceNumber)||(n==null?void 0:n.proformaNumber)||"N/A"}`,open:r,onClose:()=>{g(null),c(""),b(null),S()},width:720,children:[e.jsxs("div",{style:{marginBottom:20},children:[e.jsx(ce,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:y,onChange:d=>b(d),placeholder:"Select follow-up date"}),e.jsx(Tt,{rows:4,placeholder:"Enter follow-up note",value:I,onChange:d=>c(d.target.value)}),e.jsx(H,{type:"primary",block:!0,onClick:E,loading:k,style:{marginTop:10},children:a===null?"Add Follow-up":"Update Follow-up"})]}),e.jsx(ye,{children:"Existing Follow-ups"}),e.jsxs(Le,{defaultActiveKey:"today",children:[e.jsx(ge,{tab:`Today's (${U.length})`,children:e.jsx(ee,{dataSource:U,renderItem:d=>X(d,s.indexOf(d)),locale:{emptyText:"No follow-ups scheduled for today."}})},"today"),e.jsx(ge,{tab:`Upcoming (${q.length})`,children:e.jsx(ee,{dataSource:q,renderItem:d=>X(d,s.indexOf(d)),locale:{emptyText:"No upcoming follow-ups."}})},"upcoming"),e.jsx(ge,{tab:`Past (${p.length})`,children:e.jsx(ee,{dataSource:p,renderItem:d=>X(d,s.indexOf(d)),locale:{emptyText:"No past follow-ups."}})},"past")]})]})},J=r=>isNaN(r)?"0.00":r.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),kt=r=>{if(typeof r!="number"||isNaN(r))return"N/A";let S=Math.floor(r),n=Math.round((r-S)*100);const x=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],I=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],c=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],y=["","Thousand","Lakh","Crore"],b=a=>a<10?x[a]:a>=10&&a<20?I[a-10]:c[Math.floor(a/10)]+(a%10!==0?" "+x[a%10]:"");let k=[],i=0;if(S===0)k.push("Zero");else{let a=S%1e3;for(a>0&&(a<100?k.push(b(a)):k.push(x[Math.floor(a/100)]+" Hundred"+(a%100!==0?" "+b(a%100):""))),S=Math.floor(S/1e3);S>0;){let g=S%100;g>0?k.push(b(g)+" "+y[++i]):i++,S=Math.floor(S/100)}}const s=k.reverse().filter(Boolean).join(" ").trim();let u=s?s+" Rupees":"Zero Rupees";return n>0&&(u+=` and ${b(n)} Paisa`),u+=" Only",u.replace(/\s+/g," ")},Ct=r=>{var E,h,C,j,T,U,q;const S=((E=r.businessId)==null?void 0:E.contactName)||r.contactName||"N/A",n=r.mobileNumber||((h=r.businessId)==null?void 0:h.mobileNumber)||((C=r.businessId)==null?void 0:C.phone)||"N/A",x=((j=r.businessId)==null?void 0:j.email)||r.email||"N/A",I=((T=r.businessId)==null?void 0:T.gstNumber)||r.gstin||"N/A",c=r.businessId?`${r.businessId.addressLine1||""}, ${r.businessId.addressLine2||""}, ${r.businessId.addressLine3||""}, ${r.businessId.city||""} - ${r.businessId.pincode||""}, ${r.businessId.state||""}, ${r.businessId.country||""}`:r.customerAddress||"N/A",y=parseFloat(r.subTotal)||0,b=parseFloat(r.igstAmount)||0,k=parseFloat(r.cgstAmount)||0,i=parseFloat(r.sgstAmount)||0,s=parseFloat(r.totalAmount)||0,u=Pe,a=Pe,g=()=>{if(r.gstType==="interstate")return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">IGST (${r.gstPercentage||0}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${J(b)}</td>
                </tr>
            `;if(r.gstType==="intrastate"){const p=(r.gstPercentage||0)/2;return`
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">CGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${J(k)}</td>
                </tr>
                <tr>
                    <td style="width: 70%;"></td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%; background: #f0f2f5;">SGST (${p}%)</td>
                    <td style="border: 1px solid #e0e0e0; padding: 10px; text-align: right; width: 15%;">₹${J(i)}</td>
                </tr>
            `}return""},B=r.notes&&Array.isArray(r.notes)&&r.notes.length>0?r.notes.map(p=>`<p style="margin: 2px 0;">${p.text}</p>`).join(""):'<p style="margin: 2px 0;">Thank you for your business!</p>';return`
    <div style="padding: 10px; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; width: 100%; box-sizing: border-box;">
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                <div style="display: flex; align-items: center;">
                    <img src="${u}" alt="Company Logo" style="height: 60px; margin-right: 10px;">
                    <div>
                        <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: #2c3e50; margin-bottom: 3px;">ACE AUTOMATION</h2>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">S.F. No. 91, 14B, Padiveedu Thottam,</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Kalapatty road, Saravanampatti (PO),</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">Coimbatore - 641 035. TN, INDIA.</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">+91 98422 53389 | aceautomation.cbe@gmail.com</p>
                        <p style="margin: 1px 0; font-size: 9px; color: #555;">www.aceautomation.in | GST No. : 33AVDPD3093Q1ZD</p>
                    </div>
                </div>

                <div style="background: linear-gradient(135deg, #4CAF50, #8BC34A); color: white; padding: 10px 20px; font-weight: 600; font-size: 18px; text-align: center; border-radius: 4px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                    TAX INVOICE
                </div>
            </div>
            <div style="border-bottom: 1px solid #eee; margin-bottom: 10px;"></div>
        </div>

        <div style="margin-bottom: 20px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
            <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Bill To</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${((U=r.businessId)==null?void 0:U.businessName)||r.customerName||"N/A"}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; width: 25%; background: #f0f2f5;">Invoice No</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; width: 25%;">
                        ${r.invoiceNumber||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Contact Person</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${S}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${r.date||new Date().toLocaleDateString("en-IN")}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Mobile</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${n}
                    </td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Due Date</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;">
                        ${r.dueDate||"N/A"}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Email</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${x}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">GSTIN</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${I}
                    </td>
                </tr>
                <tr>
                    <td style="border: 1px solid #e0e0e0; padding: 6px; font-weight: 600; background: #f0f2f5;">Address</td>
                    <td style="border: 1px solid #e0e0e0; padding: 6px;" colspan="3">
                        ${c}
                    </td>
                </tr>
            </table>
        </div>

        ${((q=r.items)==null?void 0:q.length)>0?`
                <div style="margin-top: 20px; overflow: hidden; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px; table-layout: fixed; font-size: 11px;">
                        <colgroup>
                            <col style="width: 5%;"> <col style="width: 20%;"> <col style="width: 25%;"> <col style="width: 10%;"> <col style="width: 8%;"> <col style="width: 12%;"> <col style="width: 10%;"> <col style="width: 10%;"> </colgroup>
                        <thead>
                            <tr style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white;">
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">S.No</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Product Name</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: left;">Specification</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">Qty</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">Unit</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: center;">HSN/SAC</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Unit Price (₹)</th>
                                <th style="border: 1px solid #2c3e50; padding: 8px; text-align: right;">Total (₹)</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${r.items.map((p,X)=>{var w;let d=(p==null?void 0:p.productName)||(p==null?void 0:p.description)||"";if(!d&&((w=p.specifications)==null?void 0:w.length)>0){const F=p.specifications.find(z=>z.name==="Model");F?d=F.value:p.specifications.length>0&&(d=p.specifications.map(z=>`${z.name}: ${z.value}`).join(", "))}d=d||"N/A";const v=p!=null&&p.specifications&&p.specifications.length>0?p.specifications.map(F=>`${F.name}: ${F.value}`).join(", "):"N/A",O=parseFloat(p.quantity)||0,Y=parseFloat(p.rate)||0,f=(O*Y).toFixed(2);return`
                                    <tr style="${X%2===0?"background: #fff;":"background: #f9fafb;"}">
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${X+1}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${d}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: left; vertical-align: top;">${v}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${O}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.quantityType||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: center; vertical-align: top;">${p.hsnSac||"N/A"}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; vertical-align: top;">₹${J(Y)}</td>
                                        <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; vertical-align: top;">₹${J(parseFloat(f))}</td>
                                    </tr>
                                `}).join("")}
                        </tbody>
                    </table>
                </div>

                <div style="margin-top: 15px; background: #f9fafb; border-radius: 4px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%; background: #f0f2f5;">Sub Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; width: 15%;">₹${J(y)}</td>
                        </tr>
                        ${g()}
                        <tr style="background: #e8f5e9;">
                            <td style="width: 70%;"></td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">Grand Total</td>
                            <td style="border: 1px solid #e0e0e0; padding: 8px; text-align: right; font-weight: 600; font-size: 12px; width: 15%;">₹${J(s)}</td>
                        </tr>
                    </table>
                </div>

                <div style="margin-top: 10px; background: #f5f5f5; border: 1px solid #e0e0e0; border-radius: 4px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05);">
                    <table style="width: 100%; border-collapse: collapse; font-size: 11px;">
                        <tr>
                            <td style="font-weight: 600; padding: 3px; width: 25%; color: #555;">Amount In Words</td>
                            <td style="padding: 3px; font-style: italic; width: 75%;">${kt(s)}</td>
                        </tr>
                    </table>
                </div>
            `:""}

        <div style="margin-top: 15px; font-size: 11px; color: #555;">
            <p style="margin: 4px 0; font-weight: 600; color: #2c3e50;">Payment Terms:</p>
            <p style="margin: 1px 0;">${r.paymentTerms||"Payment due within 15 days of invoice date."}</p>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Notes:</p>
            <div style="margin-left: 5px;">
                ${B}
            </div>

            <p style="margin: 8px 0; font-weight: 600; color: #2c3e50;">Bank Details:</p>
            <p style="margin: 1px 0;">Bank Name: Your Bank Name</p>
            <p style="margin: 1px 0;">Account Number: XXXXXXXXXXXX</p>
            <p style="margin: 1px 0;">IFSC Code: XXXXXXXXXX</p>
            <p style="margin: 1px 0;">Branch: Your Branch Name</p>
        </div>

        <div style="margin-top: 25px; border-top: 1px solid #eee; padding-top: 15px;">
            <div style="text-align: right;">
                <img src="${a}" alt="Authorized Signature" style="height: 50px; display: block; margin-left: auto; margin-bottom: 3px;">
                <p style="margin: 4px 0; font-size: 11px; font-weight: 600; color: #2c3e50;">Authorized Signatory</p>
            </div>
            <p style="text-align: center; font-size: 9px; color: #999; margin-top: 15px;">
                This is Computer Generated Invoice & requires no Signature
            </p>
        </div>
    </div>
    `},Ft=async r=>{if(!r)return;const S=R.loading("Generating Invoice PDF...",{position:"top-center"});let n=null;try{const x=Ct(r),I=new ot({orientation:"portrait",unit:"mm",format:"a4",hotfixes:["px_scaling"]});I.setProperties({title:`Invoice - ${r.invoiceNumber}`,subject:"Invoice",author:r.companyName||"ACE AUTOMATION",keywords:"invoice, billing",creator:"Invoice Management System"});const c=I.internal.pageSize.getWidth(),y=I.internal.pageSize.getHeight(),b=5;n=document.createElement("div"),n.style.position="fixed",n.style.top="-9999px",n.style.left="-9999px",n.style.width=`${c-2*b}mm`,n.style.background="white",n.style.zIndex="-1",n.style.display="block",n.innerHTML=x,document.body.appendChild(n),await new Promise(E=>setTimeout(E,200));const i=(await rt(n,{scale:3,useCORS:!0,logging:!1,allowTaint:!0,letterRendering:!0,backgroundColor:"#ffffff"})).toDataURL("image/png",1),s=I.getImageProperties(i),u=s.height*(c-2*b)/s.width;let a=b,g=y-2*b;if(u>g){let E=u,h=0;for(I.addImage(i,"PNG",b,a,c-2*b,u),E-=g,h-=g;E>0;)I.addPage(),I.addImage(i,"PNG",b,h+a,c-2*b,u),E-=g,h-=g}else I.addImage(i,"PNG",b,a,c-2*b,u);const B=I.output("blob");Ye.saveAs(B,`invoice-${r.invoiceNumber||"draft"}.pdf`),R.success("Invoice PDF downloaded successfully!",{id:S})}catch(x){console.error("Error generating PDF:",x),R.error("Failed to generate PDF. Please try again.",{id:S})}finally{n&&document.body.contains(n)&&document.body.removeChild(n)}},{Text:N}=ue,{RangePicker:$t}=ce,vt=({invoices:r,onAddNew:S,onEdit:n,onDelete:x,onSearch:I,refreshInvoices:c})=>{var Ie,Se,Ne,Te,Ae,ke,Ce,Fe;const[y,b]=m.useState(""),[k,i]=m.useState(!1),[s,u]=m.useState(null),[a,g]=m.useState("all"),[B,E]=m.useState(!1),[h,C]=m.useState(!1),[j,T]=m.useState(!1),[U,q]=m.useState(null),[p,X]=m.useState("all"),[d,v]=m.useState(!1),[O,Y]=m.useState({}),f=[...new Set(r.map(t=>t.businessName))],w=m.useCallback(t=>{var $;const o=parseFloat(t.totalAmount)||0,l=(($=t.paymentHistory)==null?void 0:$.reduce((_,P)=>_+parseFloat(P.amount||0),0))||0;return o<=0?"N/A":l>=o-.01?"paid":l>0&&l<o?"partial":"pending"},[]);m.useEffect(()=>{const t={};r.forEach(o=>{t[o._id]=w(o)}),Y(t)},[r,w]);const F=m.useCallback(t=>isNaN(t)?"0.00":t.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2}),[]),z=t=>{b(t),I(t)},W=t=>{u(t),i(!0)},pe=t=>{u(t),E(!0)},Ue=t=>{u(t),T(!0)},ze=t=>{u(t),v(!0)},He=t=>{u(t),C(!0)},Ve=async t=>{const o=R.loading("Closing invoice...");try{await G.patch(`/api/invoices/${t}/close`),R.success("Invoice closed successfully",{id:o}),c==null||c()}catch(l){console.error("Error closing invoice:",l),R.error("Failed to close invoice",{id:o})}},Ge=async t=>{const o=R.loading("Unlocking invoice...");try{await G.patch(`/api/invoices/${t}/unlock`),R.success("Invoice unlocked successfully",{id:o}),c==null||c()}catch(l){console.error("Error unlocking invoice:",l),R.error("Failed to unlock invoice",{id:o})}},Xe=()=>{const t=we.map((P,K)=>({SNo:K+1,Number:P.invoiceNumber,Business:P.businessName,Customer:P.customerName,ContactName:P.contactName||"N/A",Email:P.email||"N/A",MobileNumber:P.mobileNumber||"N/A",TotalAmount:P.totalAmount||0,Date:P.date,DueDate:P.dueDate||"",Status:O[P._id]||P.paymentStatus,Closed:P.isClosed?"Yes":"No"})),o=me.json_to_sheet(t),l=me.book_new();me.book_append_sheet(l,o,"Invoices");const $=Ze(l,{bookType:"xlsx",type:"array"}),_=new Blob([$],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});Ye.saveAs(_,`Invoices-${new Date().toISOString().split("T")[0]}.xlsx`)},we=r.filter(t=>{var te,re,ae,oe,$e,ve;const o=t.invoiceType==="Invoice",l=!y||((te=t.invoiceNumber)==null?void 0:te.toLowerCase().includes(y.toLowerCase()))||((re=t.businessName)==null?void 0:re.toLowerCase().includes(y.toLowerCase()))||((ae=t.customerName)==null?void 0:ae.toLowerCase().includes(y.toLowerCase()))||((oe=t.contactName)==null?void 0:oe.toLowerCase().includes(y.toLowerCase()))||(($e=t.email)==null?void 0:$e.toLowerCase().includes(y.toLowerCase()))||((ve=t.mobileNumber)==null?void 0:ve.toLowerCase().includes(y.toLowerCase())),$=!U||new Date(t.date)>=U[0].toDate()&&new Date(t.date)<=U[1].toDate(),_=O[t._id],P=a==="all"?!0:a==="overdue"?_!=="paid"&&new Date(t.dueDate)<new Date:_===a,K=p==="all"?!0:t.businessName===p;return o&&l&&$&&P&&K}),je=t=>{let o="red",l="Payment Pending";return t==="paid"?(o="green",l="Completed Payment"):t==="partial"&&(o="orange",l="Partial Payment"),e.jsx(ie,{color:o,children:l})},qe=()=>[{title:"S.No",width:60,align:"center",render:(t,o,l)=>l+1},{title:"Product Name",dataIndex:"productName",ellipsis:!0,render:(t,o)=>{var $;let l=t||o.description||"";if(!l&&(($=o.specifications)==null?void 0:$.length)>0){const _=o.specifications.find(P=>P.name==="Model");_&&(l=_.value)}return l||"N/A"}},{title:"Description",dataIndex:"description",ellipsis:!0,render:(t,o)=>{var l;if(!t&&((l=o.specifications)==null?void 0:l.length)>0){const $=o.specifications.find(_=>_.name==="SPECIFICATION");return $?$.value:"N/A"}return t||"N/A"}},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center",render:t=>t||"N/A"},{title:"Qty",dataIndex:"quantity",width:80,align:"center",render:t=>parseFloat(t)||0},{title:"Unit Price (₹)",width:140,align:"right",render:(t,o)=>F(o.rate||0)},{title:"Total (₹)",width:140,align:"right",render:(t,o)=>e.jsx(N,{strong:!0,style:{color:"#52c41a"},children:F((o.quantity||0)*(o.rate||0))})}],We=[{title:"S.No",render:(t,o,l)=>e.jsx(N,{strong:!0,children:l+1}),width:60},{title:"Invoice Number",render:(t,o)=>e.jsx(ie,{icon:e.jsx(De,{}),color:"blue",children:o.invoiceNumber})},{title:"Business",render:(t,o)=>{var $;const l=(($=o.businessId)==null?void 0:$.businessName)||o.businessName;return e.jsx(Qe,{title:l,children:e.jsx(N,{strong:!0,children:l})})}},{title:"Contact Person",dataIndex:"contactName",render:(t,o)=>{var l;return((l=o.businessId)==null?void 0:l.contactName)||t||"N/A"}},{title:"Email",dataIndex:"email",render:(t,o)=>{var l;return((l=o.businessId)==null?void 0:l.email)||t||"N/A"}},{title:"Mobile",dataIndex:"mobileNumber",render:(t,o)=>{var l,$;return((l=o.businessId)==null?void 0:l.mobileNumber)||(($=o.businessId)==null?void 0:$.phoneNumber)||t||"N/A"}},{title:"Amount",dataIndex:"totalAmount",align:"right",render:t=>e.jsxs(N,{style:{color:"#52c41a"},children:["₹",t||0]})},{title:"Due Date",dataIndex:"dueDate",align:"center",render:t=>e.jsx(N,{children:t||"N/A"})},{title:"Payment Status",key:"paymentStatusLabel",align:"center",render:(t,o)=>{const l=O[o._id]||"pending";return je(l)}},{title:"Actions",width:80,render:(t,o)=>e.jsx(Je,{overlay:e.jsxs(V,{children:[e.jsx(V.Item,{icon:e.jsx(tt,{}),onClick:()=>W(o),children:"View Invoice Details"},"view"),e.jsx(V.Item,{icon:e.jsx(De,{}),onClick:()=>ze(o),children:"View Item Specifications"},"view-specs"),e.jsx(V.Item,{icon:e.jsx(it,{}),onClick:()=>Ft(o),children:"Generate PDF"},"generate-pdf"),e.jsx(V.Item,{icon:e.jsx(dt,{}),onClick:()=>pe(o),children:"View Notes"},"view-notes"),e.jsx(V.Item,{icon:e.jsx(ct,{}),onClick:()=>He(o),children:"Add/View Follow-ups"},"add-followup"),e.jsx(V.Item,{icon:e.jsx(ut,{}),onClick:()=>Ue(o),children:"View Payments"},"view-payments"),!o.isClosed&&e.jsx(V.Item,{icon:e.jsx(pt,{}),onClick:()=>n(o),children:"Edit Invoice"},"edit"),o.isClosed?e.jsx(V.Item,{icon:e.jsx(bt,{}),onClick:()=>{ne.confirm({title:"Unlock Invoice",content:"Are you sure you want to unlock this invoice? It will become editable again.",okText:"Yes, Unlock",cancelText:"No",onOk:()=>Ge(o._id)})},children:"Unlock Invoice"},"unlock"):e.jsx(V.Item,{icon:e.jsx(gt,{}),onClick:()=>{ne.confirm({title:"Close Invoice",content:"Are you sure you want to close this invoice? It will become uneditable.",okText:"Yes, Close",cancelText:"No",okButtonProps:{danger:!0},onOk:()=>Ve(o._id)})},children:"Lock Invoice"},"lock"),e.jsx(V.Item,{icon:e.jsx(mt,{}),children:e.jsx(_e,{title:"Are you sure you want to delete this invoice?",onConfirm:()=>x(o._id),okText:"Yes",cancelText:"No",children:"Delete Invoice"})},"delete")]}),trigger:["click"],children:e.jsx(H,{icon:e.jsx(at,{})})})}];return e.jsxs(e.Fragment,{children:[e.jsx(lt,{title:"Invoice Management",extra:e.jsxs(fe,{wrap:!0,children:[e.jsx($t,{onChange:q,format:"YYYY-MM-DD"}),e.jsxs(M,{value:a,onChange:g,style:{width:140},children:[e.jsx(M.Option,{value:"all",children:"All Status"}),e.jsx(M.Option,{value:"paid",children:"Paid"}),e.jsx(M.Option,{value:"pending",children:"Pending"}),e.jsx(M.Option,{value:"partial",children:"Partial"}),e.jsx(M.Option,{value:"overdue",children:"Overdue"})]}),e.jsxs(M,{value:p,onChange:X,placeholder:"Filter by Business",style:{width:200},allowClear:!0,children:[e.jsx(M.Option,{value:"all",children:"All Businesses"}),f.map(t=>e.jsx(M.Option,{value:t,children:t},t))]}),e.jsx(Z.Search,{placeholder:"Search invoices",onSearch:z,onChange:t=>z(t.target.value),style:{width:240},allowClear:!0,prefix:e.jsx(et,{})}),e.jsx(H,{onClick:Xe,children:"Export Excel"}),e.jsx(H,{type:"primary",icon:e.jsx(nt,{}),onClick:S,children:"New Invoice"})]}),children:e.jsx(D,{dataSource:we,columns:We,rowKey:"_id",pagination:{pageSize:10},bordered:!0,scroll:{x:!0}})}),e.jsx(ne,{title:"Invoice Details",open:k,onCancel:()=>i(!1),footer:e.jsx(H,{onClick:()=>i(!1),children:"Close"}),width:1e3,children:s&&e.jsxs("div",{children:[e.jsxs(A,{bordered:!0,column:2,size:"small",children:[e.jsx(A.Item,{label:"Invoice No",children:s.invoiceNumber}),e.jsx(A.Item,{label:"Date",children:s.date?new Date(s.date).toLocaleDateString("en-IN"):"N/A"}),e.jsx(A.Item,{label:"Due Date",children:s.dueDate?new Date(s.dueDate).toLocaleDateString("en-IN"):"N/A"}),e.jsx(A.Item,{label:"Business",children:s.businessName}),e.jsx(A.Item,{label:"Customer",children:s.contactName||s.customerName||"N/A"}),e.jsx(A.Item,{label:"Contact Person",children:s.contactName||"N/A"}),e.jsx(A.Item,{label:"Email",children:s.email||"N/A"}),e.jsx(A.Item,{label:"Mobile Number",children:s.mobileNumber||"N/A"}),e.jsx(A.Item,{label:"GSTIN",span:2,children:e.jsx(N,{code:!0,children:((Ie=s.businessId)==null?void 0:Ie.gstNumber)||s.gstin||"N/A"})}),e.jsx(A.Item,{label:"Business Info",span:2,children:e.jsx(N,{style:{whiteSpace:"pre-wrap"},children:s.businessId?`${s.businessId.addressLine1||""}
${s.businessId.addressLine2||""}
${s.businessId.addressLine3||""}
${s.businessId.city||""} - ${s.businessId.pincode||""}
${s.businessId.state||""}, ${s.businessId.country||""}`.trim():s.customerAddress||"N/A"})})]}),((Se=s.items)==null?void 0:Se.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ye,{orientation:"left",children:["Items (",s.items.length,")"]}),e.jsx(D,{dataSource:s.items,columns:qe(),pagination:!1,size:"small",rowKey:(t,o)=>`${s._id}-item-${o}`,bordered:!0,expandable:{expandedRowRender:t=>{var o;return e.jsx("div",{style:{margin:0,padding:0},children:((o=t.specifications)==null?void 0:o.length)>0&&e.jsx(A,{column:1,size:"small",children:t.specifications.filter(l=>l.name!=="SPECIFICATION").map((l,$)=>e.jsx(A.Item,{label:l.name,children:l.value},$))})})},rowExpandable:t=>{var o;return((o=t.specifications)==null?void 0:o.length)>0}},summary:t=>{const o=t.reduce((ae,oe)=>ae+(oe.quantity||0)*(oe.rate||0),0),l=s.gstPercentage||0,$=s.gstType||"intrastate";let _=0,P=0,K=0,te=0;$==="interstate"?(te=o*(l/100),_=te):(P=o*(l/200),K=o*(l/200),_=P+K);const re=o+_;return e.jsxs(D.Summary,{fixed:!0,children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsx(N,{strong:!0,children:"Sub Total:"})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(N,{strong:!0,children:F(o)})})]}),$==="interstate"?e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsxs(N,{strong:!0,children:["IGST (",l,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(N,{strong:!0,children:F(te)})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsxs(N,{strong:!0,children:["CGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(N,{strong:!0,children:F(P)})})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsxs(N,{strong:!0,children:["SGST (",l/2,"%):"]})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(N,{strong:!0,children:F(K)})})]})]}),e.jsxs(D.Summary.Row,{children:[e.jsx(D.Summary.Cell,{index:0,colSpan:5,align:"right",children:e.jsx(N,{strong:!0,children:"Grand Total:"})}),e.jsx(D.Summary.Cell,{index:5,children:e.jsx(N,{strong:!0,style:{color:"#52c41a"},children:F(re)})})]}),e.jsx(D.Summary.Row,{children:e.jsx(D.Summary.Cell,{index:0,colSpan:6,children:e.jsxs(N,{italic:!0,children:["Amount in words:"," "]})})})]})}})]}),e.jsxs(A,{column:2,bordered:!0,size:"small",style:{marginTop:"20px"},children:[e.jsxs(A.Item,{label:"Sub Total",span:2,children:["₹",((Ne=s.subTotal)==null?void 0:Ne.toFixed(2))||"0.00"]}),s.gstType==="interstate"?e.jsxs(A.Item,{label:"IGST Amount",span:2,children:["₹",((Te=s.igstAmount)==null?void 0:Te.toFixed(2))||"0.00"]}):e.jsxs(e.Fragment,{children:[e.jsxs(A.Item,{label:"CGST Amount",span:1,children:["₹",((Ae=s.cgstAmount)==null?void 0:Ae.toFixed(2))||"0.00"]}),e.jsxs(A.Item,{label:"SGST Amount",span:1,children:["₹",((ke=s.sgstAmount)==null?void 0:ke.toFixed(2))||"0.00"]})]}),e.jsx(A.Item,{label:"Grand Total",span:2,children:e.jsxs(N,{strong:!0,style:{fontSize:"18px",color:"#52c41a"},children:["₹",((Ce=s.totalAmount)==null?void 0:Ce.toFixed(2))||"0.00"]})}),e.jsx(A.Item,{label:"Amount in Words",span:2,children:e.jsx(N,{italic:!0,children:"Rupees Only"})}),e.jsx(A.Item,{label:"Status",span:2,children:je(O[s._id])}),e.jsx(A.Item,{label:"Closed",span:2,children:s.isClosed?e.jsx(ie,{color:"red",children:"Yes"}):e.jsx(ie,{color:"green",children:"No"})})]}),((Fe=s.notes)==null?void 0:Fe.length)>0&&e.jsxs(e.Fragment,{children:[e.jsxs(ye,{orientation:"left",children:["Notes (",s.notes.length,")"]}),s.notes.map((t,o)=>e.jsxs("div",{style:{marginBottom:8},children:[e.jsx(N,{strong:!0,children:t.author})," on"," ",e.jsx(N,{type:"secondary",children:t.timestamp}),e.jsx("p",{children:t.text})]},o))]})]})}),e.jsx(ne,{title:"Item Specifications",open:d,onCancel:()=>v(!1),footer:e.jsx(H,{onClick:()=>v(!1),children:"Close"}),width:800,children:s&&s.items&&e.jsx(ee,{itemLayout:"vertical",dataSource:s.items,renderItem:(t,o)=>e.jsx(ee.Item,{children:e.jsx(ee.Item.Meta,{title:e.jsx(N,{strong:!0,children:t.description||"No Description"}),description:e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:["Quantity: ",t.quantity]}),e.jsx("br",{}),e.jsxs(N,{children:["Rate: ₹",F(t.rate)]}),e.jsx("br",{}),t.hsnSac&&e.jsxs(N,{children:["HSN/SAC: ",t.hsnSac]}),t.specifications&&t.specifications.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("br",{}),e.jsx(N,{strong:!0,children:"Specifications:"}),e.jsx("ul",{children:t.specifications.map((l,$)=>e.jsxs("li",{children:[l.name,": ",l.value]},$))})]})]})})},o)})}),s&&e.jsx(St,{visible:B,onClose:()=>E(!1),invoice:s,refreshInvoices:c}),s&&e.jsx(At,{visible:h,onClose:()=>C(!1),invoice:s,refreshInvoices:c}),e.jsx(Nt,{visible:j,onClose:()=>T(!1),invoice:s,refreshInvoices:c})]})},rs=Object.freeze(Object.defineProperty({__proto__:null,default:vt},Symbol.toStringTag,{value:"Module"}));export{vt as I,St as N,rs as a};
