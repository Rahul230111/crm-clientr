import{r as c,K as l,aw as E,$ as m,a0 as a}from"./index-FVmEbnB1.js";import{I as F,N as D}from"./InvoiceList-Dib9z3t_.js";import L from"./InvoiceForm-Cb-AofB0.js";import"./xlsx-CyWl6TWy.js";import"./SendOutlined-CHV3BmOM.js";import"./index-Dl_ShrvA.js";import"./index-BTVJIO-A.js";import"./moment-C5S46NFB.js";import"./html2canvas.esm-B6uPR1ag.js";import"./PrinterOutlined-Bp2pzz6Q.js";import"./MessageOutlined-2hKw1Wa4.js";import"./ScheduleOutlined-CsNBjA9R.js";import"./index-9MkPJsak.js";import"./MinusCircleOutlined-BotvY0WV.js";import"./SaveOutlined-DF6IXxnZ.js";const H=()=>{const[p,y]=c.useState([]),[N,d]=c.useState(!1),[o,i]=c.useState(null),[f,S]=c.useState([]),[C,h]=c.useState(!1),n=async()=>{try{const e=await m.get("/api/invoices");y(e.data)}catch{a.error("Failed to fetch invoices")}};c.useEffect(()=>{n()},[]);const x=async e=>{var r,u,s;try{console.log("Invoice data being sent:",e),o&&o._id?(await m.put(`/api/invoices/${o._id}`,e),a.success("Invoice updated successfully")):(await m.post("/api/invoices",e),a.success("Invoice created successfully")),n(),d(!1),i(null)}catch(t){console.error(t),console.error("Server error response:",(r=t==null?void 0:t.response)==null?void 0:r.data),a.error(((s=(u=t==null?void 0:t.response)==null?void 0:u.data)==null?void 0:s.message)||"Failed to save invoice")}},b=e=>{i(e),d(!0)},g=async e=>{try{await m.delete(`/api/invoices/${e}`),a.success("Invoice deleted"),n()}catch{a.error("Delete failed")}},j=e=>{const r=e.toLowerCase(),u=p.filter(s=>{var t,v,w;return((t=s==null?void 0:s.businessName)==null?void 0:t.toLowerCase().includes(r))||((v=s==null?void 0:s.invoiceNumber)==null?void 0:v.toLowerCase().includes(r))||((w=s==null?void 0:s.customerName)==null?void 0:w.toLowerCase().includes(r))});S(u)},I=()=>{d(!1),i(null)};return l.jsxs("div",{style:{},children:[l.jsx(F,{invoices:f.length>0?f:p,onAddNew:()=>{i(null),d(!0)},onEdit:b,onDelete:g,onSearch:j,refreshInvoices:n,onViewNotes:e=>{i(e),h(!0)}}),l.jsx(E,{title:o?"Edit Invoice":"Create Invoice",open:N,onClose:I,width:"80%",destroyOnClose:!0,children:l.jsx(L,{onCancel:I,onSave:x,initialValues:o||{invoiceType:"Invoice",items:[],taxRate:18,discountAmount:0,businessName:"",customerName:"",customerAddress:"",customerGSTIN:"",companyGSTIN:"",companyName:"",companyAddress:"",contactPerson:"",contactNumber:"",paymentTerms:""}})}),o&&l.jsx(D,{visible:C,onClose:()=>h(!1),invoice:o,refreshInvoices:n})]})};export{H as default};
