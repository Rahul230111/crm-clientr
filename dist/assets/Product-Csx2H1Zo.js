import{r as p,z as re,e as Q,w as se,f as U,x as _,k as ce,aC as W,g as oe,m as le,b as de,u as P,bm as he,aH as ue,a6 as me,bq as ge,br as pe,bs as xe,bt as ye,M as j,E as Se,K as e,aw as L,N as O,O as H,Y as k,ag as be,Q as N,aX as J,$ as M,aj as $,af as je,T as fe,aT as Y,aU as G,W as B,P as T,a4 as F,a5 as Ie,a3 as we,aW as Ce}from"./index-FVmEbnB1.js";import{R as $e}from"./MinusCircleOutlined-BotvY0WV.js";import{R as ve}from"./SendOutlined-CHV3BmOM.js";import{D as I}from"./index-Dl_ShrvA.js";import{C as Z}from"./Collapse-BGJArvLw.js";import{R as ke}from"./MessageOutlined-2hKw1Wa4.js";import{P as Ne}from"./index-BTVJIO-A.js";var Pe=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],V=p.forwardRef(function(t,n){var r,i=t.prefixCls,c=i===void 0?"rc-switch":i,u=t.className,o=t.checked,a=t.defaultChecked,s=t.disabled,h=t.loadingIcon,d=t.checkedChildren,S=t.unCheckedChildren,x=t.onClick,b=t.onChange,m=t.onKeyDown,f=re(t,Pe),C=Q(!1,{value:o,defaultValue:a}),y=se(C,2),l=y[0],g=y[1];function D(w,A){var E=l;return s||(E=w,g(E),b==null||b(E,A)),E}function q(w){w.which===W.LEFT?D(!1,w):w.which===W.RIGHT&&D(!0,w),m==null||m(w)}function v(w){var A=D(!l,w);x==null||x(A,w)}var z=U(c,u,(r={},_(r,"".concat(c,"-checked"),l),_(r,"".concat(c,"-disabled"),s),r));return p.createElement("button",ce({},f,{type:"button",role:"switch","aria-checked":l,disabled:s,className:z,ref:n,onKeyDown:q,onClick:v}),h,p.createElement("span",{className:"".concat(c,"-inner")},p.createElement("span",{className:"".concat(c,"-inner-checked")},d),p.createElement("span",{className:"".concat(c,"-inner-unchecked")},S)))});V.displayName="Switch";const De=t=>{const{componentCls:n,trackHeightSM:r,trackPadding:i,trackMinWidthSM:c,innerMinMarginSM:u,innerMaxMarginSM:o,handleSizeSM:a,calc:s}=t,h=`${n}-inner`,d=P(s(a).add(s(i).mul(2)).equal()),S=P(s(o).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:c,height:r,lineHeight:P(r),[`${n}-inner`]:{paddingInlineStart:o,paddingInlineEnd:u,[`${h}-checked, ${h}-unchecked`]:{minHeight:r},[`${h}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${S})`,marginInlineEnd:`calc(100% - ${d} + ${S})`},[`${h}-unchecked`]:{marginTop:s(r).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:a,height:a},[`${n}-loading-icon`]:{top:s(s(a).sub(t.switchLoadingIconSize)).div(2).equal(),fontSize:t.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:u,paddingInlineEnd:o,[`${h}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${h}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${S})`,marginInlineEnd:`calc(-100% + ${d} - ${S})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${P(s(a).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${h}`]:{[`${h}-unchecked`]:{marginInlineStart:s(t.marginXXS).div(2).equal(),marginInlineEnd:s(t.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${h}`]:{[`${h}-checked`]:{marginInlineStart:s(t.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:s(t.marginXXS).div(2).equal()}}}}}}},Ee=t=>{const{componentCls:n,handleSize:r,calc:i}=t;return{[n]:{[`${n}-loading-icon${t.iconCls}`]:{position:"relative",top:i(i(r).sub(t.fontSize)).div(2).equal(),color:t.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:t.switchColor}}}},Me=t=>{const{componentCls:n,trackPadding:r,handleBg:i,handleShadow:c,handleSize:u,calc:o}=t,a=`${n}-handle`;return{[n]:{[a]:{position:"absolute",top:r,insetInlineStart:r,width:u,height:u,transition:`all ${t.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:o(u).div(2).equal(),boxShadow:c,transition:`all ${t.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${a}`]:{insetInlineStart:`calc(100% - ${P(o(u).add(r).equal())})`},[`&:not(${n}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:t.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:t.switchHandleActiveInset}}}}},Ae=t=>{const{componentCls:n,trackHeight:r,trackPadding:i,innerMinMargin:c,innerMaxMargin:u,handleSize:o,calc:a}=t,s=`${n}-inner`,h=P(a(o).add(a(i).mul(2)).equal()),d=P(a(u).mul(2).equal());return{[n]:{[s]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:u,paddingInlineEnd:c,transition:`padding-inline-start ${t.switchDuration} ease-in-out, padding-inline-end ${t.switchDuration} ease-in-out`,[`${s}-checked, ${s}-unchecked`]:{display:"block",color:t.colorTextLightSolid,fontSize:t.fontSizeSM,transition:`margin-inline-start ${t.switchDuration} ease-in-out, margin-inline-end ${t.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:r},[`${s}-checked`]:{marginInlineStart:`calc(-100% + ${h} - ${d})`,marginInlineEnd:`calc(100% - ${h} + ${d})`},[`${s}-unchecked`]:{marginTop:a(r).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${s}`]:{paddingInlineStart:c,paddingInlineEnd:u,[`${s}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${s}-unchecked`]:{marginInlineStart:`calc(100% - ${h} + ${d})`,marginInlineEnd:`calc(-100% + ${h} - ${d})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${s}`]:{[`${s}-unchecked`]:{marginInlineStart:a(i).mul(2).equal(),marginInlineEnd:a(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${s}`]:{[`${s}-checked`]:{marginInlineStart:a(i).mul(-1).mul(2).equal(),marginInlineEnd:a(i).mul(2).equal()}}}}}},He=t=>{const{componentCls:n,trackHeight:r,trackMinWidth:i}=t;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},de(t)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:r,lineHeight:P(r),verticalAlign:"middle",background:t.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${t.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:t.colorTextTertiary}}),he(t)),{[`&${n}-checked`]:{background:t.switchColor,[`&:hover:not(${n}-disabled)`]:{background:t.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:t.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},Te=t=>{const{fontSize:n,lineHeight:r,controlHeight:i,colorWhite:c}=t,u=n*r,o=i/2,a=2,s=u-a*2,h=o-a*2;return{trackHeight:u,trackHeightSM:o,trackMinWidth:s*2+a*4,trackMinWidthSM:h*2+a*2,trackPadding:a,handleBg:c,handleSize:s,handleSizeSM:h,handleShadow:`0 2px 4px 0 ${new ue("#00230b").setA(.2).toRgbString()}`,innerMinMargin:s/2,innerMaxMargin:s+a+a*2,innerMinMarginSM:h/2,innerMaxMarginSM:h+a+a*2}},qe=oe("Switch",t=>{const n=le(t,{switchDuration:t.motionDurationMid,switchColor:t.colorPrimary,switchDisabledOpacity:t.opacityLoading,switchLoadingIconSize:t.calc(t.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${t.opacityLoading})`,switchHandleActiveInset:"-30%"});return[He(n),Ae(n),Me(n),Ee(n),De(n)]},Te);var ze=function(t,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var c=0,i=Object.getOwnPropertySymbols(t);c<i.length;c++)n.indexOf(i[c])<0&&Object.prototype.propertyIsEnumerable.call(t,i[c])&&(r[i[c]]=t[i[c]]);return r};const Oe=p.forwardRef((t,n)=>{const{prefixCls:r,size:i,disabled:c,loading:u,className:o,rootClassName:a,style:s,checked:h,value:d,defaultChecked:S,defaultValue:x,onChange:b}=t,m=ze(t,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[f,C]=Q(!1,{value:h??d,defaultValue:S??x}),{getPrefixCls:y,direction:l,switch:g}=p.useContext(me),D=p.useContext(ge),q=(c??D)||u,v=y("switch",r),z=p.createElement("div",{className:`${v}-handle`},u&&p.createElement(ye,{className:`${v}-loading-icon`})),[w,A,E]=qe(v),te=pe(i),ne=U(g==null?void 0:g.className,{[`${v}-small`]:te==="small",[`${v}-loading`]:u,[`${v}-rtl`]:l==="rtl"},o,a,A,E),ie=Object.assign(Object.assign({},g==null?void 0:g.style),s),ae=(...R)=>{C(R[0]),b==null||b.apply(void 0,R)};return w(p.createElement(xe,{component:"Switch"},p.createElement(V,Object.assign({},m,{checked:f,onChange:ae,prefixCls:v,className:ne,style:ie,disabled:q,ref:n,loadingIcon:z}))))}),ee=Oe;ee.__ANT_SWITCH=!0;const Fe=({visible:t,onClose:n,onSave:r,initialValues:i})=>{const[c]=j.useForm(),u=localStorage.getItem("user");let o;u&&(o=JSON.parse(u).name),p.useEffect(()=>{t&&i?c.setFieldsValue({...i,stockLoadDate:i.stockLoadDate?Se(i.stockLoadDate):null,options:i.options||[]}):c.resetFields()},[t,i]);const a=async d=>{var C;const{product_id:S,productId:x,_id:b,...m}=d,f={...m,price:Number(m.price)||0,quantity:Number(m.quantity)||0,inStock:Number(m.inStock)||0,outStock:Number(m.outStock)||0,stockLoadDate:m.stockLoadDate?m.stockLoadDate.toISOString():null,isActive:m.isActive||!0,updatedBy:o||"Admin",options:(m.options||[]).filter(y=>{var l,g;return((l=y==null?void 0:y.type)==null?void 0:l.trim())&&((g=y==null?void 0:y.description)==null?void 0:g.trim())})};try{i!=null&&i._id?(await M.put(`/api/product/${i._id}`,f),$.success("Product updated")):(await M.post("/api/product",f),$.success("Product added")),r(),n()}catch(y){$.error("Failed to save product"),console.error(((C=y==null?void 0:y.response)==null?void 0:C.data)||y.message)}};console.log(i==null?void 0:i.priceHistory);const s=d=>{const S={year:"numeric",month:"short",day:"numeric"};return new Date(d).toLocaleDateString(void 0,S)},h=d=>`Rs. ${d.toFixed(2)}`;return e.jsxs(L,{title:i?"Edit Product":"Add Product",open:t,onClose:n,width:640,destroyOnClose:!0,children:[e.jsxs(j,{layout:"vertical",form:c,onFinish:a,children:[e.jsxs(O,{gutter:16,children:[e.jsx(H,{span:12,children:e.jsx(j.Item,{name:"productName",label:"Product Name",rules:[{required:!0,message:"Enter product name"}],children:e.jsx(k,{placeholder:"Product name"})})}),e.jsx(H,{span:12,children:e.jsx(j.Item,{name:"price",label:"Price (INR)",rules:[{required:!0,message:"Enter price"}],children:e.jsx(k,{type:"number",placeholder:"Price"})})})]}),e.jsxs(O,{gutter:16,children:[e.jsx(H,{span:12,children:e.jsx(j.Item,{name:"hsnSac",label:"HSN/SAC",children:e.jsx(k,{placeholder:"HSN/SAC Code"})})}),e.jsx(H,{span:12,children:e.jsx(j.Item,{name:"quantity",label:"Quantity",children:e.jsx(k,{type:"number",placeholder:"Quantity"})})})]}),e.jsx(O,{gutter:16,children:e.jsx(H,{span:12})}),e.jsx(j.Item,{name:"description",label:"Description",children:e.jsx(k.TextArea,{rows:2,placeholder:"Description"})}),e.jsx(j.List,{name:"options",children:(d,{add:S,remove:x})=>e.jsxs(e.Fragment,{children:[e.jsx("label",{style:{fontWeight:600},children:"Product Options"}),d.map(({key:b,name:m})=>e.jsxs(be,{style:{display:"flex",marginBottom:8},align:"start",children:[e.jsx(j.Item,{name:[m,"type"],rules:[{required:!0,message:"Enter type"}],children:e.jsx(k,{placeholder:"Type"})}),e.jsx(j.Item,{name:[m,"description"],rules:[{required:!0,message:"Enter description"}],children:e.jsx(k,{placeholder:"Description"})}),e.jsx($e,{onClick:()=>x(m)})]},b)),e.jsx(j.Item,{children:e.jsx(N,{onClick:()=>S(),icon:e.jsx(J,{}),children:"Add Option"})})]})}),e.jsx(j.Item,{name:"isActive",label:"Active",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(j.Item,{children:e.jsx(N,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},htmlType:"submit",block:!0,children:i?"Update":"Create"})})]}),i&&i.priceHistory.length>1&&e.jsxs("div",{className:"data-table-container",children:[e.jsx("h2",{children:"Product Price History"}),e.jsxs("table",{className:"data-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Updated By"})]})}),e.jsx("tbody",{children:i.priceHistory.length>0&&i.priceHistory.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:s(d.updatedAt)}),e.jsx("td",{className:"price-cell",children:h(d.price)}),e.jsx("td",{children:d.updatedBy})]},d.id))})]}),i.priceHistory.length===0&&e.jsx("div",{className:"no-results",children:"No matching records found"})]})]})},{TextArea:Le}=k,{Title:Re,Text:_e}=fe,We=({visible:t,onClose:n,product:r,refreshProducts:i})=>{const[c]=j.useForm(),[u,o]=p.useState(!1),[a,s]=p.useState([]);p.useEffect(()=>{s((r==null?void 0:r.notes)||[])},[r]);const h=()=>{try{const x=JSON.parse(localStorage.getItem("user"));return(x==null?void 0:x.email)||"Unknown"}catch{return"Unknown"}},d=async x=>{try{o(!0);const b=$.loading("Adding note..."),m={text:x.note,timestamp:new Date().toLocaleString(),author:h()},f=[...a,m];await M.put(`/api/product/${r._id}/notes`,{notes:f}),s(f),$.success("Note added",{id:b}),c.resetFields(),i()}catch{$.error("Failed to add note")}finally{o(!1)}},S=()=>a.length?a.map((x,b)=>{const m=b>0?a[b-1]:null,f=new Date(x.timestamp).toDateString(),C=m?new Date(m.timestamp).toDateString():null,y=f!==C;return e.jsxs("div",{children:[y&&e.jsx("div",{className:"note-date-header",children:f}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[x.author,"    ",x.timestamp]}),e.jsx("div",{className:"note-text",children:x.text})]})]},b)}):e.jsx(_e,{type:"secondary",children:"No notes added yet"});return e.jsx(L,{title:e.jsxs(Re,{level:4,style:{margin:0},children:["Notes for Product: ",r==null?void 0:r.productName]}),open:t,onClose:n,width:440,destroyOnClose:!0,children:e.jsxs(je,{spinning:u,children:[e.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:S()}),e.jsxs(j,{form:c,layout:"vertical",onFinish:d,children:[e.jsx(j.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(Le,{rows:3,placeholder:"Type your note here"})}),e.jsx(N,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},htmlType:"submit",loading:u,block:!0,icon:e.jsx(ve,{}),children:"Add Note"})]})]})})},{Content:Be,Header:Ke}=Y,{TabPane:K}=G,{Panel:X}=Z,Ve=()=>{var y;const[t,n]=p.useState([]),[r,i]=p.useState(!1),[c,u]=p.useState(null),[o,a]=p.useState(null),[s,h]=p.useState(!1),d=async()=>{try{const{data:l}=await M.get("/api/product");n(l)}catch{$.error("Failed to load products")}};p.useEffect(()=>{t.length===0&&d()},[]);const S=()=>{d()},x=async l=>{try{await M.delete(`/api/product/${l}`),$.success("Product deleted"),d()}catch{$.error("Failed to delete product")}},b=async l=>{try{const{data:g}=await M.get(`/api/product/${l}`);a(g)}catch{$.error("Failed to fetch product details")}},m=t.filter(l=>l.isActive),f=t.filter(l=>!l.isActive),C=()=>[{title:"S.No",render:(l,g,D)=>D+1,width:60},{title:"Name",dataIndex:"productName",width:160},{title:"Qty",dataIndex:"quantity",width:80},{title:"Price (₹)",dataIndex:"price",render:l=>`₹${l==null?void 0:l.toFixed(2)}`,width:100},{title:"Status",dataIndex:"isActive",render:l=>l?e.jsx(T,{color:"green",children:"Active"}):e.jsx(T,{color:"red",children:"Inactive"}),width:100},{title:"Actions",width:180,render:(l,g)=>e.jsxs(e.Fragment,{children:[e.jsx(F,{title:"View",children:e.jsx(N,{type:"text",icon:e.jsx(Ie,{}),onClick:()=>b(g._id)})}),e.jsx(F,{title:"Edit",children:e.jsx(N,{type:"text",icon:e.jsx(we,{}),onClick:()=>{u(g),i(!0)}})}),e.jsx(F,{title:"Notes",children:e.jsx(N,{type:"text",icon:e.jsx(ke,{}),onClick:()=>{u(g),h(!0)}})}),e.jsx(Ne,{title:"Confirm delete?",onConfirm:()=>x(g._id),children:e.jsx(N,{type:"text",icon:e.jsx(Ce,{}),danger:!0})})]})}];return e.jsxs(Y,{style:{minHeight:"100vh",background:"#ffffffff"},children:[e.jsx(Ke,{style:{background:"white",padding:0,marginBottom:20},children:e.jsx("h2",{style:{margin:0,padding:20},children:"Product Management"})}),e.jsxs(Be,{style:{padding:20},children:[e.jsxs(G,{defaultActiveKey:"1",children:[e.jsxs(K,{tab:" Products",children:[e.jsx(N,{type:"primary",icon:e.jsx(J,{}),onClick:()=>{u(null),i(!0)},style:{marginBottom:16,backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},children:"Add Product"}),e.jsx(B,{columns:C(),dataSource:m,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})]},"1"),e.jsx(K,{tab:"Inactive Products",children:e.jsx(B,{columns:C(),dataSource:f,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})},"2")]}),e.jsx(Fe,{visible:r,onClose:()=>{u(null),i(!1)},onSave:S,initialValues:c}),e.jsx(L,{open:!!o,title:"Product Details",width:820,onClose:()=>a(null),children:o&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{bordered:!0,column:1,size:"small",children:[e.jsx(I.Item,{label:"Product ID",children:o.product_id}),e.jsx(I.Item,{label:"Name",children:o.productName}),e.jsxs(I.Item,{label:"Price",children:["₹",(y=o.price)==null?void 0:y.toFixed(2)]}),e.jsx(I.Item,{label:"Qty",children:o.quantity}),e.jsx(I.Item,{label:"Description",children:o.description||"N/A"}),e.jsx(I.Item,{label:"Status",children:o.isActive?e.jsx(T,{color:"green",children:"Active"}):e.jsx(T,{color:"red",children:"Inactive"})})]}),e.jsxs(Z,{style:{marginTop:20},children:[e.jsx(X,{header:"Product Options",children:Array.isArray(o.options)&&o.options.length>0?o.options.map((l,g)=>e.jsxs(I,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(I.Item,{label:"Type",children:l.type}),e.jsx(I.Item,{label:"Description",children:l.description})]},g)):e.jsx("p",{children:"No product options available."})},"1"),e.jsx(X,{header:"Product Notes",children:Array.isArray(o.notes)&&o.notes.length>0?o.notes.map((l,g)=>e.jsxs(I,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(I.Item,{label:"Note",span:2,children:l.text}),e.jsx(I.Item,{label:"Author",children:l.author}),e.jsx(I.Item,{label:"Time",children:new Date(l.timestamp).toLocaleString()})]},g)):e.jsx("p",{children:"No notes available."})},"2")]})]})}),c&&e.jsx(We,{visible:s,onClose:()=>h(!1),product:c,refreshProducts:d})]})]})};export{Ve as default};
