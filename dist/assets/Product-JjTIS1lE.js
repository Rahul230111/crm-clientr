import{r as p,l as re,Q,i as se,p as U,j as _,a as ce,L as W,q as oe,s as le,y as de,z as N,b1 as he,T as ue,C as me,ag as pe,aQ as ge,b9 as xe,af as Se,o as e,w as je,B as D,V as $,S as Ie,aj as V,a3 as H}from"./index-4iHAsGxc.js";import{i as A}from"./axios-YBtE4rUB.js";import{d as ye,D as be}from"./index-BDhW8TMK.js";import{F as S}from"./index-HlhkAPyo.js";import{D as F}from"./index-NaxT21FC.js";import{R as q,C as P}from"./TextArea-D-vfbJwO.js";import{I as w,b as fe}from"./index-BAGcRLi3.js";import{R as we}from"./MinusCircleOutlined-CJ3_nV4M.js";import{R as G,T as J}from"./index-794if0iU.js";import{R as $e}from"./SendOutlined-XyGa9d15.js";import{T as Ce}from"./index-DSBwwp4G.js";import{F as B}from"./Table-CXeK32Wz.js";import{D as I}from"./index-CQ2f9Lcv.js";import{T as z}from"./index-BaF67V7T.js";import{C as Y}from"./Collapse-BIA2Oren.js";import{R as ke}from"./EditOutlined-C0X5LsdL.js";import{R as ve}from"./MessageOutlined-BmCvk-Er.js";import{P as Pe}from"./index-X2lugO_E.js";import{R as De}from"./DeleteOutlined-BDCQsiEK.js";import"./index-C53-Wrhb.js";import"./context-DwP9ebBm.js";import"./useClosable-DcUAKcIy.js";import"./addEventListener-DLQTKdN8.js";import"./index-CyYGo6-G.js";import"./ActionButton-DFyc4Efx.js";var Ne=["prefixCls","className","checked","defaultChecked","disabled","loadingIcon","checkedChildren","unCheckedChildren","onClick","onChange","onKeyDown"],Z=p.forwardRef(function(t,n){var s,i=t.prefixCls,o=i===void 0?"rc-switch":i,u=t.className,c=t.checked,a=t.defaultChecked,r=t.disabled,l=t.loadingIcon,d=t.checkedChildren,j=t.unCheckedChildren,g=t.onClick,m=t.onChange,y=t.onKeyDown,b=re(t,Ne),v=Q(!1,{value:c,defaultValue:a}),C=se(v,2),h=C[0],x=C[1];function E(f,T){var M=h;return r||(M=f,x(M),m==null||m(M,T)),M}function O(f){f.which===W.LEFT?E(!1,f):f.which===W.RIGHT&&E(!0,f),y==null||y(f)}function k(f){var T=E(!h,f);g==null||g(T,f)}var L=U(o,u,(s={},_(s,"".concat(o,"-checked"),h),_(s,"".concat(o,"-disabled"),r),s));return p.createElement("button",ce({},b,{type:"button",role:"switch","aria-checked":h,disabled:r,className:L,ref:n,onKeyDown:O,onClick:k}),l,p.createElement("span",{className:"".concat(o,"-inner")},p.createElement("span",{className:"".concat(o,"-inner-checked")},d),p.createElement("span",{className:"".concat(o,"-inner-unchecked")},j)))});Z.displayName="Switch";const Ee=t=>{const{componentCls:n,trackHeightSM:s,trackPadding:i,trackMinWidthSM:o,innerMinMarginSM:u,innerMaxMarginSM:c,handleSizeSM:a,calc:r}=t,l=`${n}-inner`,d=N(r(a).add(r(i).mul(2)).equal()),j=N(r(c).mul(2).equal());return{[n]:{[`&${n}-small`]:{minWidth:o,height:s,lineHeight:N(s),[`${n}-inner`]:{paddingInlineStart:c,paddingInlineEnd:u,[`${l}-checked, ${l}-unchecked`]:{minHeight:s},[`${l}-checked`]:{marginInlineStart:`calc(-100% + ${d} - ${j})`,marginInlineEnd:`calc(100% - ${d} + ${j})`},[`${l}-unchecked`]:{marginTop:r(s).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`${n}-handle`]:{width:a,height:a},[`${n}-loading-icon`]:{top:r(r(a).sub(t.switchLoadingIconSize)).div(2).equal(),fontSize:t.switchLoadingIconSize},[`&${n}-checked`]:{[`${n}-inner`]:{paddingInlineStart:u,paddingInlineEnd:c,[`${l}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${l}-unchecked`]:{marginInlineStart:`calc(100% - ${d} + ${j})`,marginInlineEnd:`calc(-100% + ${d} - ${j})`}},[`${n}-handle`]:{insetInlineStart:`calc(100% - ${N(r(a).add(i).equal())})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${l}`]:{[`${l}-unchecked`]:{marginInlineStart:r(t.marginXXS).div(2).equal(),marginInlineEnd:r(t.marginXXS).mul(-1).div(2).equal()}},[`&${n}-checked ${l}`]:{[`${l}-checked`]:{marginInlineStart:r(t.marginXXS).mul(-1).div(2).equal(),marginInlineEnd:r(t.marginXXS).div(2).equal()}}}}}}},Me=t=>{const{componentCls:n,handleSize:s,calc:i}=t;return{[n]:{[`${n}-loading-icon${t.iconCls}`]:{position:"relative",top:i(i(s).sub(t.fontSize)).div(2).equal(),color:t.switchLoadingIconColor,verticalAlign:"top"},[`&${n}-checked ${n}-loading-icon`]:{color:t.switchColor}}}},Ae=t=>{const{componentCls:n,trackPadding:s,handleBg:i,handleShadow:o,handleSize:u,calc:c}=t,a=`${n}-handle`;return{[n]:{[a]:{position:"absolute",top:s,insetInlineStart:s,width:u,height:u,transition:`all ${t.switchDuration} ease-in-out`,"&::before":{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,backgroundColor:i,borderRadius:c(u).div(2).equal(),boxShadow:o,transition:`all ${t.switchDuration} ease-in-out`,content:'""'}},[`&${n}-checked ${a}`]:{insetInlineStart:`calc(100% - ${N(c(u).add(s).equal())})`},[`&:not(${n}-disabled):active`]:{[`${a}::before`]:{insetInlineEnd:t.switchHandleActiveInset,insetInlineStart:0},[`&${n}-checked ${a}::before`]:{insetInlineEnd:0,insetInlineStart:t.switchHandleActiveInset}}}}},Te=t=>{const{componentCls:n,trackHeight:s,trackPadding:i,innerMinMargin:o,innerMaxMargin:u,handleSize:c,calc:a}=t,r=`${n}-inner`,l=N(a(c).add(a(i).mul(2)).equal()),d=N(a(u).mul(2).equal());return{[n]:{[r]:{display:"block",overflow:"hidden",borderRadius:100,height:"100%",paddingInlineStart:u,paddingInlineEnd:o,transition:`padding-inline-start ${t.switchDuration} ease-in-out, padding-inline-end ${t.switchDuration} ease-in-out`,[`${r}-checked, ${r}-unchecked`]:{display:"block",color:t.colorTextLightSolid,fontSize:t.fontSizeSM,transition:`margin-inline-start ${t.switchDuration} ease-in-out, margin-inline-end ${t.switchDuration} ease-in-out`,pointerEvents:"none",minHeight:s},[`${r}-checked`]:{marginInlineStart:`calc(-100% + ${l} - ${d})`,marginInlineEnd:`calc(100% - ${l} + ${d})`},[`${r}-unchecked`]:{marginTop:a(s).mul(-1).equal(),marginInlineStart:0,marginInlineEnd:0}},[`&${n}-checked ${r}`]:{paddingInlineStart:o,paddingInlineEnd:u,[`${r}-checked`]:{marginInlineStart:0,marginInlineEnd:0},[`${r}-unchecked`]:{marginInlineStart:`calc(100% - ${l} + ${d})`,marginInlineEnd:`calc(-100% + ${l} - ${d})`}},[`&:not(${n}-disabled):active`]:{[`&:not(${n}-checked) ${r}`]:{[`${r}-unchecked`]:{marginInlineStart:a(i).mul(2).equal(),marginInlineEnd:a(i).mul(-1).mul(2).equal()}},[`&${n}-checked ${r}`]:{[`${r}-checked`]:{marginInlineStart:a(i).mul(-1).mul(2).equal(),marginInlineEnd:a(i).mul(2).equal()}}}}}},qe=t=>{const{componentCls:n,trackHeight:s,trackMinWidth:i}=t;return{[n]:Object.assign(Object.assign(Object.assign(Object.assign({},de(t)),{position:"relative",display:"inline-block",boxSizing:"border-box",minWidth:i,height:s,lineHeight:N(s),verticalAlign:"middle",background:t.colorTextQuaternary,border:"0",borderRadius:100,cursor:"pointer",transition:`all ${t.motionDurationMid}`,userSelect:"none",[`&:hover:not(${n}-disabled)`]:{background:t.colorTextTertiary}}),he(t)),{[`&${n}-checked`]:{background:t.switchColor,[`&:hover:not(${n}-disabled)`]:{background:t.colorPrimaryHover}},[`&${n}-loading, &${n}-disabled`]:{cursor:"not-allowed",opacity:t.switchDisabledOpacity,"*":{boxShadow:"none",cursor:"not-allowed"}},[`&${n}-rtl`]:{direction:"rtl"}})}},ze=t=>{const{fontSize:n,lineHeight:s,controlHeight:i,colorWhite:o}=t,u=n*s,c=i/2,a=2,r=u-a*2,l=c-a*2;return{trackHeight:u,trackHeightSM:c,trackMinWidth:r*2+a*4,trackMinWidthSM:l*2+a*2,trackPadding:a,handleBg:o,handleSize:r,handleSizeSM:l,handleShadow:`0 2px 4px 0 ${new ue("#00230b").setA(.2).toRgbString()}`,innerMinMargin:r/2,innerMaxMargin:r+a+a*2,innerMinMarginSM:l/2,innerMaxMarginSM:l+a+a*2}},Oe=oe("Switch",t=>{const n=le(t,{switchDuration:t.motionDurationMid,switchColor:t.colorPrimary,switchDisabledOpacity:t.opacityLoading,switchLoadingIconSize:t.calc(t.fontSizeIcon).mul(.75).equal(),switchLoadingIconColor:`rgba(0, 0, 0, ${t.opacityLoading})`,switchHandleActiveInset:"-30%"});return[qe(n),Te(n),Ae(n),Me(n),Ee(n)]},ze);var Le=function(t,n){var s={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&n.indexOf(i)<0&&(s[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,i=Object.getOwnPropertySymbols(t);o<i.length;o++)n.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(t,i[o])&&(s[i[o]]=t[i[o]]);return s};const He=p.forwardRef((t,n)=>{const{prefixCls:s,size:i,disabled:o,loading:u,className:c,rootClassName:a,style:r,checked:l,value:d,defaultChecked:j,defaultValue:g,onChange:m}=t,y=Le(t,["prefixCls","size","disabled","loading","className","rootClassName","style","checked","value","defaultChecked","defaultValue","onChange"]),[b,v]=Q(!1,{value:l??d,defaultValue:j??g}),{getPrefixCls:C,direction:h,switch:x}=p.useContext(me),E=p.useContext(pe),O=(o??E)||u,k=C("switch",s),L=p.createElement("div",{className:`${k}-handle`},u&&p.createElement(Se,{className:`${k}-loading-icon`})),[f,T,M]=Oe(k),te=ge(i),ne=U(x==null?void 0:x.className,{[`${k}-small`]:te==="small",[`${k}-loading`]:u,[`${k}-rtl`]:h==="rtl"},c,a,T,M),ie=Object.assign(Object.assign({},x==null?void 0:x.style),r),ae=(...R)=>{v(R[0]),m==null||m.apply(void 0,R)};return f(p.createElement(xe,{component:"Switch"},p.createElement(Z,Object.assign({},y,{checked:b,onChange:ae,prefixCls:k,className:ne,style:ie,disabled:O,ref:n,loadingIcon:L}))))}),ee=He;ee.__ANT_SWITCH=!0;const Fe=({visible:t,onClose:n,onSave:s,initialValues:i})=>{const[o]=S.useForm();p.useEffect(()=>{t&&i?o.setFieldsValue({...i,stockLoadDate:i.stockLoadDate?ye(i.stockLoadDate):null,options:i.options||[]}):o.resetFields()},[t,i]);const u=async c=>{var g;const{product_id:a,productId:r,_id:l,...d}=c,j={...d,price:Number(d.price)||0,quantity:Number(d.quantity)||0,inStock:Number(d.inStock)||0,outStock:Number(d.outStock)||0,stockLoadDate:d.stockLoadDate?d.stockLoadDate.toISOString():null,isActive:d.isActive||!1,options:(d.options||[]).filter(m=>{var y,b;return((y=m==null?void 0:m.type)==null?void 0:y.trim())&&((b=m==null?void 0:m.description)==null?void 0:b.trim())})};try{i!=null&&i._id?(await A.put(`/api/product/${i._id}`,j),$.success("Product updated")):(await A.post("/api/product",j),$.success("Product added")),s(),n()}catch(m){$.error("Failed to save product"),console.error(((g=m==null?void 0:m.response)==null?void 0:g.data)||m.message)}};return e.jsx(F,{title:i?"Edit Product":"Add Product",open:t,onClose:n,width:640,destroyOnClose:!0,children:e.jsxs(S,{layout:"vertical",form:o,onFinish:u,children:[e.jsxs(q,{gutter:16,children:[e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"productName",label:"Product Name",rules:[{required:!0,message:"Enter product name"}],children:e.jsx(w,{placeholder:"Product name"})})}),e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"price",label:"Price (INR)",rules:[{required:!0,message:"Enter price"}],children:e.jsx(w,{type:"number",placeholder:"Price"})})})]}),e.jsxs(q,{gutter:16,children:[e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"hsnSac",label:"HSN/SAC",children:e.jsx(w,{placeholder:"HSN/SAC Code"})})}),e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"quantity",label:"Quantity",children:e.jsx(w,{type:"number",placeholder:"Quantity"})})})]}),e.jsxs(q,{gutter:16,children:[e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"inStock",label:"In Stock",children:e.jsx(w,{type:"number",placeholder:"In Stock"})})}),e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"outStock",label:"Out Stock",children:e.jsx(w,{type:"number",placeholder:"Out Stock"})})})]}),e.jsxs(q,{gutter:16,children:[e.jsx(P,{span:12,children:e.jsx(S.Item,{name:"stockLoadDate",label:"Stock Load Date",children:e.jsx(be,{style:{width:"100%"}})})}),e.jsx(P,{span:12})]}),e.jsx(S.Item,{name:"description",label:"Description",children:e.jsx(w.TextArea,{rows:2,placeholder:"Description"})}),e.jsx(S.List,{name:"options",children:(c,{add:a,remove:r})=>e.jsxs(e.Fragment,{children:[e.jsx("label",{style:{fontWeight:600},children:"Product Options"}),c.map(({key:l,name:d})=>e.jsxs(je,{style:{display:"flex",marginBottom:8},align:"start",children:[e.jsx(S.Item,{name:[d,"type"],rules:[{required:!0,message:"Enter type"}],children:e.jsx(w,{placeholder:"Type"})}),e.jsx(S.Item,{name:[d,"description"],rules:[{required:!0,message:"Enter description"}],children:e.jsx(w,{placeholder:"Description"})}),e.jsx(we,{onClick:()=>r(d)})]},l)),e.jsx(S.Item,{children:e.jsx(D,{onClick:()=>a(),icon:e.jsx(G,{}),children:"Add Option"})})]})}),e.jsx(S.Item,{name:"isActive",label:"Active",valuePropName:"checked",children:e.jsx(ee,{})}),e.jsx(S.Item,{children:e.jsx(D,{type:"primary",htmlType:"submit",block:!0,children:i?"Update":"Create"})})]})})},{TextArea:Re}=w,{Title:_e,Text:We}=Ce,Be=({visible:t,onClose:n,product:s,refreshProducts:i})=>{const[o]=S.useForm(),[u,c]=p.useState(!1),[a,r]=p.useState([]);p.useEffect(()=>{r((s==null?void 0:s.notes)||[])},[s]);const l=()=>{try{const g=JSON.parse(localStorage.getItem("user"));return(g==null?void 0:g.email)||"Unknown"}catch{return"Unknown"}},d=async g=>{try{c(!0);const m=$.loading("Adding note..."),y={text:g.note,timestamp:new Date().toLocaleString(),author:l()},b=[...a,y];await A.put(`/api/product/${s._id}/notes`,{notes:b}),r(b),$.success("Note added",{id:m}),o.resetFields(),i()}catch{$.error("Failed to add note")}finally{c(!1)}},j=()=>a.length?a.map((g,m)=>{const y=m>0?a[m-1]:null,b=new Date(g.timestamp).toDateString(),v=y?new Date(y.timestamp).toDateString():null,C=b!==v;return e.jsxs("div",{children:[C&&e.jsx("div",{className:"note-date-header",children:b}),e.jsxs("div",{className:"note-bubble",children:[e.jsxs("div",{className:"note-meta",children:[g.author,"    ",g.timestamp]}),e.jsx("div",{className:"note-text",children:g.text})]})]},m)}):e.jsx(We,{type:"secondary",children:"No notes added yet"});return e.jsx(F,{title:e.jsxs(_e,{level:4,style:{margin:0},children:["Notes for Product: ",s==null?void 0:s.productName]}),open:t,onClose:n,width:440,destroyOnClose:!0,children:e.jsxs(Ie,{spinning:u,children:[e.jsx("div",{style:{maxHeight:460,overflowY:"auto",marginBottom:16},children:j()}),e.jsxs(S,{form:o,layout:"vertical",onFinish:d,children:[e.jsx(S.Item,{name:"note",rules:[{required:!0,message:"Please enter a note"}],children:e.jsx(Re,{rows:3,placeholder:"Type your note here"})}),e.jsx(D,{type:"primary",htmlType:"submit",loading:u,block:!0,icon:e.jsx($e,{}),children:"Add Note"})]})]})})},{Content:Ke,Header:Xe}=V,{TabPane:K}=J,{Panel:X}=Y,jt=()=>{var C;const[t,n]=p.useState([]),[s,i]=p.useState(!1),[o,u]=p.useState(null),[c,a]=p.useState(null),[r,l]=p.useState(!1),d=async()=>{try{const{data:h}=await A.get("/api/product");n(h)}catch{$.error("Failed to load products")}};p.useEffect(()=>{d()},[]);const j=()=>{d()},g=async h=>{try{await A.delete(`/api/product/${h}`),$.success("Product deleted"),d()}catch{$.error("Failed to delete product")}},m=async h=>{try{const{data:x}=await A.get(`/api/product/${h}`);a(x)}catch{$.error("Failed to fetch product details")}},y=t.filter(h=>h.isActive),b=t.filter(h=>!h.isActive),v=()=>[{title:"S.No",render:(h,x,E)=>E+1,width:60},{title:"Product ID",dataIndex:"product_id",width:120},{title:"Name",dataIndex:"productName",width:160},{title:"Qty",dataIndex:"quantity",width:80},{title:"Price (₹)",dataIndex:"price",render:h=>`₹${h==null?void 0:h.toFixed(2)}`,width:100},{title:"In Stock",dataIndex:"inStock",width:100},{title:"Out Stock",dataIndex:"outStock",width:100},{title:"Status",dataIndex:"isActive",render:h=>h?e.jsx(z,{color:"green",children:"Active"}):e.jsx(z,{color:"red",children:"Inactive"}),width:100},{title:"Actions",fixed:"right",width:180,render:(h,x)=>e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"View",children:e.jsx(D,{type:"text",icon:e.jsx(fe,{}),onClick:()=>m(x._id)})}),e.jsx(H,{title:"Edit",children:e.jsx(D,{type:"text",icon:e.jsx(ke,{}),onClick:()=>{u(x),i(!0)}})}),e.jsx(H,{title:"Notes",children:e.jsx(D,{type:"text",icon:e.jsx(ve,{}),onClick:()=>{u(x),l(!0)}})}),e.jsx(Pe,{title:"Confirm delete?",onConfirm:()=>g(x._id),children:e.jsx(D,{type:"text",icon:e.jsx(De,{}),danger:!0})})]})}];return e.jsxs(V,{style:{minHeight:"100vh"},children:[e.jsx(Xe,{style:{background:"#fff",padding:0,marginBottom:20},children:e.jsx("h2",{style:{margin:0,padding:20},children:"Product Management"})}),e.jsxs(Ke,{style:{padding:20},children:[e.jsxs(J,{defaultActiveKey:"1",children:[e.jsxs(K,{tab:"Active Products",children:[e.jsx(D,{type:"primary",icon:e.jsx(G,{}),onClick:()=>{u(null),i(!0)},style:{marginBottom:16},children:"Add Product"}),e.jsx(B,{columns:v(),dataSource:y,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})]},"1"),e.jsx(K,{tab:"Inactive Products",children:e.jsx(B,{columns:v(),dataSource:b,rowKey:"_id",scroll:{x:1e3},pagination:{pageSize:10}})},"2")]}),e.jsx(Fe,{visible:s,onClose:()=>{u(null),i(!1)},onSave:j,initialValues:o}),e.jsx(F,{open:!!c,title:"Product Details",width:820,onClose:()=>a(null),children:c&&e.jsxs(e.Fragment,{children:[e.jsxs(I,{bordered:!0,column:1,size:"small",children:[e.jsx(I.Item,{label:"Product ID",children:c.product_id}),e.jsx(I.Item,{label:"Name",children:c.productName}),e.jsxs(I.Item,{label:"Price",children:["₹",(C=c.price)==null?void 0:C.toFixed(2)]}),e.jsx(I.Item,{label:"Qty",children:c.quantity}),e.jsx(I.Item,{label:"In Stock",children:c.inStock}),e.jsx(I.Item,{label:"Out Stock",children:c.outStock}),e.jsx(I.Item,{label:"Stock Load Date",children:c.stockLoadDate&&new Date(c.stockLoadDate).toLocaleDateString()}),e.jsx(I.Item,{label:"Description",children:c.description||"N/A"}),e.jsx(I.Item,{label:"Status",children:c.isActive?e.jsx(z,{color:"green",children:"Active"}):e.jsx(z,{color:"red",children:"Inactive"})})]}),e.jsxs(Y,{style:{marginTop:20},children:[e.jsx(X,{header:"Product Options",children:Array.isArray(c.options)&&c.options.length>0?c.options.map((h,x)=>e.jsxs(I,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(I.Item,{label:"Type",children:h.type}),e.jsx(I.Item,{label:"Description",children:h.description})]},x)):e.jsx("p",{children:"No product options available."})},"1"),e.jsx(X,{header:"Product Notes",children:Array.isArray(c.notes)&&c.notes.length>0?c.notes.map((h,x)=>e.jsxs(I,{column:2,size:"small",bordered:!0,style:{marginBottom:16},children:[e.jsx(I.Item,{label:"Note",span:2,children:h.text}),e.jsx(I.Item,{label:"Author",children:h.author}),e.jsx(I.Item,{label:"Time",children:new Date(h.timestamp).toLocaleString()})]},x)):e.jsx("p",{children:"No notes available."})},"2")]})]})}),o&&e.jsx(Be,{visible:r,onClose:()=>l(!1),product:o,refreshProducts:d})]})]})};export{jt as default};
