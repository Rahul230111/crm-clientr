import{r as W,an as X,x as i,B as J,V as G,H as Fe,T as Pe,ao as je,ap as U}from"./index-3j2E7pUL.js";import{i as ge}from"./axios-CSlAuMiO.js";import{h as K}from"./moment-C5S46NFB.js";import{D as Ae}from"./index-DVSodFTC.js";import{D as De}from"./index-NsnFnMr_.js";import{I as Se,R as He}from"./index-CsUGJ7YV.js";import{D as me}from"./index-MHS1ptoq.js";import{T as Ne}from"./index-BRTO4pFo.js";import{L as ie}from"./index-BoISyFuH.js";import{T as Te}from"./index-C-eCguuc.js";import{E as Ee,R as Re}from"./html2canvas.esm-D5fRu8Us.js";import{b as ve}from"./TextArea-DELUlYzR.js";import{F as V}from"./Table-HKvwWm1_.js";import{M as Oe}from"./index-B80iahJ-.js";import{D as j}from"./index-DlPAxIq8.js";import{T as Q}from"./index-BrSJe371.js";import{R as xe}from"./PrinterOutlined-DfPKk8FV.js";import{R as ze}from"./MessageOutlined-DZkEco9W.js";import{R as Me}from"./ScheduleOutlined-CSbu8mU1.js";import{R as Le}from"./EditOutlined-0_cnfjzU.js";import{P as $e}from"./index-CFb1Uy8W.js";import{R as We}from"./DeleteOutlined-BAvkxAoL.js";import"./context-DJnMqWkY.js";import"./useClosable-CC1Ls4ip.js";import"./extendsObject-78o_rR5W.js";import"./dayjs.min-BAOJIqCz.js";import"./index-DiojptZP.js";import"./PlusOutlined-BdSH2k4o.js";import"./row-BatVd8KW.js";import"./Pagination-Buu9EMH_.js";import"./styleChecker-D89VOBbV.js";import"./addEventListener-BJarX3AI.js";import"./index-CfNZZRpy.js";import"./InfoCircleFilled-DSywJBHM.js";import"./ActionButton-RId_fRI3.js";import"./index-Dgbp67W9.js";const{TextArea:Ye}=Se,{TabPane:pe}=Ne,{Text:be}=Te,qe=({visible:c,onClose:E,quotation:y,refreshQuotations:L})=>{const[O,z]=W.useState(""),[R,A]=W.useState(null),[t,p]=W.useState(!1),[s,n]=W.useState([]),[x,w]=W.useState(null);W.useEffect(()=>{c&&(y!=null&&y._id)&&P()},[c,y]);const P=async()=>{try{const r=await ge.get(`/api/quotations/${y._id}/followups`);n(r.data||[])}catch(r){console.error("Failed to fetch follow-ups for quotation:",r),X.error("Failed to fetch follow-ups for this quotation.")}},ee=()=>{if(!O||!R){X.error("Please fill in both date and note fields.");return}const r=JSON.parse(localStorage.getItem("user")),f=r==null?void 0:r._id;if(!f){X.error("User information not found. Please log in.");return}p(!0);const h={date:R.format("YYYY-MM-DD"),note:O,addedBy:f};(x===null?ge.post(`/api/quotations/${y._id}/followups`,h):ge.put(`/api/quotations/${y._id}/followups/${x}`,h)).then(()=>{X.success(x===null?"Follow-up added successfully!":"Follow-up updated successfully!"),z(""),A(null),w(null),P(),L()}).catch(o=>{var a,d;console.error("Error saving follow-up:",o),X.error((d=(a=o==null?void 0:o.response)==null?void 0:a.data)==null?void 0:d.message)}).finally(()=>p(!1))},D=K().format("YYYY-MM-DD"),Y=[...s].sort((r,f)=>new Date(f.date)-new Date(r.date)),b=Y.filter(r=>K(r.date).format("YYYY-MM-DD")===D),I=Y.filter(r=>K(r.date).isAfter(D,"day")),g=Y.filter(r=>K(r.date).isBefore(D,"day")),l=(r,f)=>{var h,T;return i.jsx(ie.Item,{actions:[],children:i.jsxs("div",{children:[i.jsx(be,{strong:!0,children:K(r.date).format("DD-MM-YYYY")}),i.jsx("br",{}),r.note,i.jsx("br",{}),i.jsxs(be,{type:"secondary",children:["By ",((h=r.addedBy)==null?void 0:h.name)||((T=r.addedBy)==null?void 0:T.email)||"Unknown User"]})]})})};return i.jsxs(Ae,{title:`Follow-ups for Quotation: ${(y==null?void 0:y.quotationNumber)||"N/A"}`,open:c,onClose:()=>{w(null),z(""),A(null),E()},width:720,children:[i.jsxs("div",{style:{marginBottom:20},children:[i.jsx(De,{style:{width:"100%",marginBottom:8},format:"DD-MM-YYYY",value:R,onChange:r=>A(r),placeholder:"Select follow-up date"}),i.jsx(Ye,{rows:4,placeholder:"Enter follow-up note",value:O,onChange:r=>z(r.target.value)}),i.jsx(J,{type:"primary",block:!0,onClick:ee,loading:t,style:{marginTop:10},children:x===null?"Add Follow-up":"Update Follow-up"})]}),i.jsx(me,{children:"Existing Follow-ups"}),i.jsxs(Ne,{defaultActiveKey:"today",children:[i.jsx(pe,{tab:`Today's (${b.length})`,children:i.jsx(ie,{dataSource:b,renderItem:r=>l(r,s.indexOf(r)),locale:{emptyText:"No follow-ups scheduled for today."}})},"today"),i.jsx(pe,{tab:`Upcoming (${I.length})`,children:i.jsx(ie,{dataSource:I,renderItem:r=>l(r,s.indexOf(r)),locale:{emptyText:"No upcoming follow-ups."}})},"upcoming"),i.jsx(pe,{tab:`Past (${g.length})`,children:i.jsx(ie,{dataSource:g,renderItem:r=>l(r,s.indexOf(r)),locale:{emptyText:"No past follow-ups."}})},"past")]})]})},Be="/assets/megacraneq-CnNkYVbt.png",Z=c=>`₹${(parseFloat(c)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,ke=c=>{if(typeof c!="number"||isNaN(c))return"N/A";let E=Math.floor(c),y=Math.round((c-E)*100);const L=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],O=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],z=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"],R=s=>{if(s===0)return"";let n="";return s>=100&&(n+=L[Math.floor(s/100)]+" Hundred",s%=100,s>0&&(n+=" ")),s>=20&&(n+=z[Math.floor(s/10)],s%=10,s>0&&(n+=" ")),s>=10?n+=O[s-10]:s>0&&(n+=L[s]),n.trim()};let A=[];if(E===0)A.push("Zero");else{let s=E;const n=[{limit:1e3,name:""},{limit:100,name:"Thousand"},{limit:100,name:"Lakh"},{limit:100,name:"Crore"}];let x=[];for(let w=0;w<n.length&&s>0;w++){let P;w===0?(P=s%n[w].limit,s=Math.floor(s/n[w].limit)):(P=s%100,s=Math.floor(s/100)),P>0&&x.push(R(P)+(n[w].name?" "+n[w].name:""))}A=x.reverse().filter(Boolean)}const t=A.join(" ").trim();let p=t?t+" Rupees":"Zero Rupees";return y>0&&(p+=` and ${R(y)} Paisa`),p+=" Only",p.replace(/\s+/g," ")},e={font:{family:"helvetica",normal:"normal",bold:"bold"},colors:{primary:"#D35400",text:"#333",footer:"#999",headerBg:"#f2f2f2",tableBorder:"#000000"},fontSize:{companyName:14,isoText:8,addressText:8,mainContent:10,sectionTitle:12,tableHeader:9,tableContent:8,summaryText:9,footer:8},spacing:{padding:15,lineHeight:5,smallLineHeight:3.5,headerHeight:45,footerHeight:15,cellPadding:2,sectionGap:10},lines:{header:.5,table:.2,box:.1}},ye=async c=>{var y,L,O,z,R,A;const E=G.loading("Generating PDF...",{position:"top-center"});try{const t=new Ee({orientation:"portrait",unit:"mm",format:"a4"}),p=t.internal.pageSize.getWidth(),s=t.internal.pageSize.getHeight();let n=e.spacing.padding;const x=async()=>{const m=new Image;m.src=Be,await new Promise(k=>m.onload=k);const N=20,C=m.height*N/m.width,v=e.spacing.padding,_=e.spacing.padding;t.addImage(m,"PNG",v,_,N,C),t.setFontSize(e.fontSize.companyName),t.setTextColor(e.colors.primary),t.setFont(e.font.family,e.font.bold),t.text("MEGA CRANES INDIA PRIVATE LIMITED",p/2,e.spacing.padding+5,{align:"center"}),t.setFontSize(e.fontSize.isoText),t.setTextColor(e.colors.primary),t.setFont(e.font.family,e.font.normal),t.text("(An ISO 9001 : 2015 Certified company)",p/2,e.spacing.padding+9,{align:"center"}),t.setFontSize(e.fontSize.addressText),t.setTextColor(e.colors.text),t.text("S.F. No. 2/8, 2/9, 2/11, Thelungupalayam Road, Ellapalayam (P.O), Annur, Coimbatore - 641 697.",p/2,e.spacing.padding+15,{align:"center"}),t.text("Mob : 99949 63033, 99949 93032.",p/2,e.spacing.padding+18,{align:"center"}),t.text("E-mail : info@megacranesindia.com, marketing@megacranesindia.com",p/2,e.spacing.padding+21,{align:"center"}),t.text("Website : www.megacranesindia.com",p/2,e.spacing.padding+24,{align:"center"}),t.text("GST No : 33AACCM6869G1Z8      PAN No : AACCM6869G      Incorporation No : U29150TZ2009PTC015678",p/2,e.spacing.padding+27,{align:"center"}),t.setDrawColor(e.colors.primary),t.setLineWidth(e.lines.header),t.line(e.spacing.padding,e.spacing.padding+32,p-e.spacing.padding,e.spacing.padding+32),n=e.spacing.padding+40},w=(m,N)=>{t.setFontSize(e.fontSize.footer),t.setTextColor(e.colors.footer),t.text(`Page ${m}/${N}`,p/2,s-e.spacing.footerHeight+5,{align:"center"})},P=((y=c.items)==null?void 0:y.reduce((m,N)=>m+parseFloat(N.quantity||0)*parseFloat(N.rate||0),0))||0,D=P*.18,Y=P+D,b={toCompany:c.businessName||"M/s. LMW Limited, Foundry Division UNIT - 31 (Unit 2), Arasur, Coimbatore – 641 407",attnContact:((L=c.businessId)==null?void 0:L.contactName)||c.contactName||"N/A",attnMobile:c.mobileNumber||((O=c.businessId)==null?void 0:O.mobileNumber)||((z=c.businessId)==null?void 0:z.phone)||"N/A",attnEmail:((R=c.businessId)==null?void 0:R.email)||c.email||"N/A",subject:c.subject||(()=>{var N;const m=(N=c.items)==null?void 0:N.map(C=>C.productName).filter(Boolean);if(m&&m.length>0){let C=`Offer for ${m.slice(0,2).join(" & ")}`;return m.length>2&&(C+="..."),C}return"Offer for your requirement"})(),reference:c.reference||`Your telecom enquiry dated ${new Date().toLocaleDateString("en-IN")}`,quotationDate:c.date?new Date(c.date).toLocaleDateString("en-IN"):new Date().toLocaleDateString("en-IN"),quotationNumber:c.quotationNumber||"MCIPL/OFR/0/NXL",quotationNotes:c.quotationNotes||"If Installation or any other Service is required, additional charges of Rs.4,500/- will be Applicable extra on PER MAN DAY (i.e, Per Engineer Per Day) basis + GST 18% Extra. If required, you have to release a separate Work Order",customerScope:c.customerScope||`Transportation from our works to your site
Unloading the materials @Site, Storage, Security, Inhouse Transportation
Required Cables, SFU, Ladders, Scaffoldings, Platforms, Cranes, Chain Block other requirements for Installation.
Installation with Required Base & Cables, Materials & Modifications
Additional Materials, Spares, Modifications & Services (if required)`,hsnCodes:c.hsnCodes||Array.from(new Set((A=c.items)==null?void 0:A.map(m=>m.hsnSac).filter(m=>m&&m.trim()!==""))).join(", ")||"Spares - 84311090, Service - 998719",termsData:[{label:"PRICES",value:c.pricesTerms||"EX WORKS COIMBATORE with open packing basis."},{label:"TAXES",value:c.warranty||"12 months from the date of dispatch or 1000 running hours whichever is earlier."},{label:"PAYMENT TERMS",value:c.ourPaymentTerms||"100% payment + 100% GST before dispatch from our works"},{label:"DELIVERY",value:c.delivery||"4 - 6 weeks against receipt of your firm PO"},{label:"PACKING & FORWARDING CHARGES",value:c.packingForwardingCharges||"NA"},{label:"TRANSPORTATION CHARGES",value:c.transportationCharges||"Customer’s scope"},{label:"TRANSPORTER NAME",value:c.transporterName||"Customer’s Vehicle"},{label:"MODE & PLACE OF DELIVERY",value:c.modePlaceDelivery||"EX WORKS"},{label:"VALIDITY",value:c.offerValidity||"30 days from the date of this offer."}]};b.termsData.push({label:"HSN CODES",value:b.hsnCodes}),await x(),t.setFontSize(e.fontSize.mainContent),t.setTextColor(e.colors.text),t.setFont(e.font.family,e.font.normal),t.text(b.quotationNumber,e.spacing.padding,n),n+=e.spacing.lineHeight*2,t.text("To,",e.spacing.padding,n),n+=e.spacing.lineHeight,t.setFont(e.font.family,e.font.bold),t.text(`M/s ${b.toCompany}`,e.spacing.padding,n),t.setFont(e.font.family,e.font.normal),n+=e.spacing.lineHeight,t.text(`KIND ATTN: ${b.attnContact}`,e.spacing.padding,n),n+=e.spacing.lineHeight,t.text(`Mobile: ${b.attnMobile}`,e.spacing.padding,n),n+=e.spacing.lineHeight,t.text(`E-mail: ${b.attnEmail}`,e.spacing.padding,n),n+=e.spacing.lineHeight*2,t.setFont(e.font.family,e.font.bold),t.text(`SUB: ${b.subject}`,e.spacing.padding,n),t.setFont(e.font.family,e.font.normal),n+=e.spacing.lineHeight,t.text(`REF: ${b.reference}`,e.spacing.padding,n),t.text(`DATE: ${b.quotationDate}`,p-e.spacing.padding,e.spacing.padding+40,{align:"right"}),n+=e.spacing.lineHeight*2,t.setFont(e.font.family,e.font.bold),t.text("Dear Customer,",e.spacing.padding,n),n+=e.spacing.lineHeight*2,t.setFont(e.font.family,e.font.normal),t.text("We thank you for enquiry, we are pleased to submit our Techno Commercial Offer, as under.",e.spacing.padding,n,{maxWidth:p-2*e.spacing.padding}),n+=e.spacing.lineHeight*2,t.text("We, “Mega Cranes” is a Promising & Reliable Original Equipment Manufacturer of Overhead Cranes and Electric Wire Rope Hoist in South India, situated at Coimbatore more than a decade.",e.spacing.padding,n,{maxWidth:p-2*e.spacing.padding}),n+=e.spacing.lineHeight*2,t.text("We are also an Authorized Crane Partner of “KITO” Japan for Electric Chain Hoist, Manual Hoist, Rope Hoist. KITO is the Worlds No.1 Chain Hoist manufacturer.",e.spacing.padding,n,{maxWidth:p-2*e.spacing.padding}),n+=e.spacing.lineHeight*4,t.setFontSize(e.fontSize.sectionTitle),t.setFont(e.font.family,e.font.bold),t.text("Annexure I - Price & Scope Details",p/2,n,{align:"center"}),n+=e.spacing.lineHeight*2,t.text("Annexure II - Terms & Conditions",p/2,n,{align:"center"}),t.setFontSize(e.fontSize.mainContent),n+=e.spacing.lineHeight*4,t.setFont(e.font.family,e.font.normal),t.text("We hope you will find our offer most competitive, if you have clarifications, please feel free to contact us.",e.spacing.padding,n,{maxWidth:p-2*e.spacing.padding}),n+=e.spacing.lineHeight*2,t.text("Looking forward for your valued order at the earliest.",e.spacing.padding,n),n+=e.spacing.lineHeight*2,t.text("Yours Faithfully",e.spacing.padding,n),n+=e.spacing.lineHeight,t.setFont(e.font.family,e.font.bold),t.text("For MEGA CRANES INDIA PVT LTD.,",e.spacing.padding,n),n+=e.spacing.lineHeight*3,t.text("Sivaraman.P.S",e.spacing.padding,n),n+=e.spacing.lineHeight,t.setFont(e.font.family,e.font.normal),t.text("Head – Business Development",e.spacing.padding,n),n+=e.spacing.lineHeight,t.text("+91 9944039125",e.spacing.padding,n);let I=t.internal.getNumberOfPages();t.addPage(),n=e.spacing.padding,await x(),t.setFontSize(e.fontSize.sectionTitle),t.setFont(e.font.family,e.font.bold),n+=e.spacing.lineHeight,t.text("ANNEXURE - I (PRICE & SCOPE)",p/2,n,{align:"center"}),n+=e.spacing.lineHeight*2,t.setFontSize(e.fontSize.tableHeader),t.setFont(e.font.family,e.font.bold);const g=e.spacing.padding;let l=n;const r=p-2*e.spacing.padding,f=r*.45,h=r*.2,T=r*.17,o=r*.18,a=7;t.setFillColor(e.colors.headerBg),t.rect(g,l,r,a,"F"),t.setDrawColor(e.colors.tableBorder),t.setLineWidth(e.lines.table),t.text("DESCRIPTION",g+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("UNIT PRICE",g+f+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("QTY",g+f+h+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("TOTAL PRICE",g+f+h+T+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.rect(g,l,f,a),t.rect(g+f,l,h,a),t.rect(g+f+h,l,T,a),t.rect(g+f+h+T,l,o,a),l+=a,t.setFontSize(e.fontSize.tableContent),t.setFont(e.font.family,e.font.normal);for(const m of c.items||[]){const N=m.description||m.productName||"N/A",C=parseFloat(m.rate||0),v=parseFloat(m.quantity||0),_=C*v,k=t.splitTextToSize(N,f-2*e.spacing.cellPadding),Ie=k.length*e.spacing.lineHeight,B=Math.max(a,Ie+2*e.spacing.cellPadding);l+B+e.spacing.footerHeight+e.spacing.padding>s-e.spacing.footerHeight&&(I=t.internal.getNumberOfPages(),w(I,"N/A"),t.addPage(),n=e.spacing.padding,await x(),t.setFontSize(e.fontSize.sectionTitle),t.setFont(e.font.family,e.font.bold),n+=e.spacing.lineHeight,t.text("ANNEXURE - I (PRICE & SCOPE) - Continued",p/2,n,{align:"center"}),n+=e.spacing.lineHeight*2,l=n,t.setFontSize(e.fontSize.tableHeader),t.setFont(e.font.family,e.font.bold),t.setFillColor(e.colors.headerBg),t.rect(g,l,r,a,"F"),t.setDrawColor(e.colors.tableBorder),t.setLineWidth(e.lines.table),t.text("DESCRIPTION",g+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("UNIT PRICE",g+f+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("QTY",g+f+h+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.text("TOTAL PRICE",g+f+h+T+e.spacing.cellPadding,l+a/2,{align:"left",baseline:"middle"}),t.rect(g,l,f,a),t.rect(g+f,l,h,a),t.rect(g+f+h,l,T,a),t.rect(g+f+h+T,l,o,a),l+=a,t.setFontSize(e.fontSize.tableContent),t.setFont(e.font.family,e.font.normal)),t.rect(g,l,f,B),t.rect(g+f,l,h,B),t.rect(g+f+h,l,T,B),t.rect(g+f+h+T,l,o,B);const Ce=(B-k.length*e.spacing.lineHeight)/2+e.spacing.cellPadding,ce=B/2;t.text(k,g+e.spacing.cellPadding,l+Ce),t.text(Z(C),g+f+e.spacing.cellPadding,l+ce,{align:"left",baseline:"middle"}),t.text(String(v),g+f+h+e.spacing.cellPadding,l+ce,{align:"left",baseline:"middle"}),t.text(Z(_),g+f+h+T+e.spacing.cellPadding,l+ce,{align:"left",baseline:"middle"}),l+=B}const d=7;t.setFontSize(e.fontSize.summaryText),t.setFont(e.font.family,e.font.bold);const u=g+f+h+T,M=g+r;l+d>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2,l=n),t.rect(g,l,r,d),t.text("SUB TOTAL",u-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),t.text(Z(P),M-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),l+=d,l+d>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2,l=n),t.setFont(e.font.family,e.font.normal),t.rect(g,l,r,d),t.text("TAXES - GST 18%",u-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),t.text(Z(D),M-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),l+=d,l+d>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2,l=n),t.setFont(e.font.family,e.font.bold),t.rect(g,l,r,d),t.text("GRAND TOTAL",u-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),t.text(Z(Y),M-e.spacing.cellPadding,l+d/2,{align:"right",baseline:"middle"}),n=l+d+e.spacing.sectionGap,t.setFontSize(e.fontSize.summaryText),t.setFont(e.font.family,e.font.normal);const te=ke(Y),ae=t.splitTextToSize(`Amount in words: ${te}`,p-2*e.spacing.padding-20);n+=e.spacing.lineHeight,n+ae.length*e.spacing.lineHeight>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2),t.text("Amount in words:",e.spacing.padding,n),n+=e.spacing.lineHeight,t.text(ae,e.spacing.padding+10,n),n+=ae.length*e.spacing.lineHeight+5;const S=5,$=e.spacing.padding,q=p-2*e.spacing.padding,oe=t.splitTextToSize("Note:",q-2*S),se=t.splitTextToSize(b.quotationNotes,q-2*S),le=t.splitTextToSize("CUSTOMER'S SCOPE:",q-2*S),fe=b.customerScope.split(`
`).filter(m=>m.trim()!=="");let re=oe.length*e.spacing.lineHeight+se.length*e.spacing.lineHeight+le.length*e.spacing.lineHeight+fe.length*e.spacing.lineHeight*1.2+S*4+20;n+re>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2);const de=n;t.rect($,de,q,re);let F=de+S;t.setFont(e.font.family,e.font.bold),t.text(oe,$+S,F),F+=oe.length*e.spacing.lineHeight,t.setDrawColor("#000"),t.setLineWidth(e.lines.box),t.line($+S,F,$+q-S,F),F+=S,t.setFont(e.font.family,e.font.normal),t.text(se,$+S,F,{maxWidth:q-2*S}),F+=se.length*e.spacing.lineHeight+S*2,t.setFont(e.font.family,e.font.bold),t.text(le,$+S,F),F+=le.length*e.spacing.lineHeight,t.setDrawColor("#000"),t.setLineWidth(e.lines.box),t.line($+S,F,$+q-S,F),F+=S,t.setFont(e.font.family,e.font.normal);for(const m of fe){const N=t.splitTextToSize(`• ${m.trim()}`,q-2*S-5);for(const C of N)t.text(C,$+S,F),F+=e.spacing.lineHeight*1.2}n=de+re+e.spacing.sectionGap,t.setFontSize(e.fontSize.sectionTitle),t.setFont(e.font.family,e.font.bold),n+e.spacing.lineHeight*4+b.termsData.length*a>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2),t.text("ANNEXURE - II - TERMS & CONDITIONS",p/2,n,{align:"center"}),n+=e.spacing.lineHeight*2,t.setFontSize(e.fontSize.summaryText),t.setFont(e.font.family,e.font.normal);const ne=(p-2*e.spacing.padding)*.35,ue=(p-2*e.spacing.padding)*.65,we=7;for(const m of b.termsData){const N=t.splitTextToSize(`${m.label}:`,ne-2*e.spacing.cellPadding),C=t.splitTextToSize(m.value||"N/A",ue-2*e.spacing.cellPadding),v=Math.max(we,N.length*e.spacing.lineHeight+2*e.spacing.cellPadding,C.length*e.spacing.lineHeight+2*e.spacing.cellPadding);n+v>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2,t.setFontSize(e.fontSize.sectionTitle),t.setFont(e.font.family,e.font.bold),t.text("ANNEXURE - II - TERMS & CONDITIONS - Continued",p/2,n,{align:"center"}),n+=e.spacing.lineHeight*2,t.setFontSize(e.fontSize.summaryText),t.setFont(e.font.family,e.font.normal)),t.setDrawColor(e.colors.tableBorder),t.setLineWidth(e.lines.table),t.rect(e.spacing.padding,n,ne,v),t.rect(e.spacing.padding+ne,n,ue,v);const _=(v-N.length*e.spacing.lineHeight)/2+e.spacing.cellPadding,k=(v-C.length*e.spacing.lineHeight)/2+e.spacing.cellPadding;t.setFont(e.font.family,e.font.bold),t.text(N,e.spacing.padding+e.spacing.cellPadding,n+_),t.setFont(e.font.family,e.font.normal),t.text(C,e.spacing.padding+ne+e.spacing.cellPadding,n+k),n+=v}n+=e.spacing.lineHeight*2,t.setFont(e.font.family,e.font.bold),n+e.spacing.lineHeight*5>s-e.spacing.footerHeight-e.spacing.padding&&(I=t.internal.getNumberOfPages(),t.addPage(),n=e.spacing.padding,await x(),n+=e.spacing.lineHeight*2),t.text("For MEGA CRANES INDIA PVT LTD.,",e.spacing.padding,n),n+=e.spacing.lineHeight*3,t.text("Sivaraman.P.S",e.spacing.padding,n),n+=e.spacing.lineHeight,t.setFont(e.font.family,e.font.normal),t.text("Head – Business Development",e.spacing.padding,n),n+=e.spacing.lineHeight,t.text("+91 9944039125",e.spacing.padding,n);const he=t.internal.getNumberOfPages();for(let m=1;m<=he;m++)t.setPage(m),w(m,he);t.save(`${b.quotationNumber||"quotation"}_${new Date().toISOString().slice(0,10)}.pdf`),G.success("PDF downloaded successfully!",{id:E})}catch(t){console.error("Failed to generate PDF:",t),G.error("Failed to generate PDF. Please try again.",{id:E})}},{Text:H}=Te,Pt=({quotations:c,onAddNew:E,onEdit:y,onDelete:L,onSearch:O,onViewNotes:z,loading:R,refreshQuotations:A})=>{var I,g,l,r,f,h,T;const[t,p]=W.useState(!1),[s,n]=W.useState(null),[x,w]=W.useState(!1),P=o=>{n(o),p(!0),G.success("Quotation details loaded.",{duration:1500,position:"top-right"})},ee=o=>{n(o),w(!0)},D=o=>`₹${(parseFloat(o)||0).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}`,Y=()=>[{title:"S.No",width:60,align:"center",render:(o,a,d)=>d+1},{title:"Product Name",dataIndex:"productName",ellipsis:!0,render:(o,a)=>(console.log("Item in QuotationList:",a),o||a.name||"N/A")},{title:"Description",dataIndex:"description",ellipsis:!0,render:(o,a)=>{var d;if(!o&&((d=a.specifications)==null?void 0:d.length)>0){const u=a.specifications.find(M=>M.name==="SPECIFICATION");return u?u.value:"N/A"}return o||"N/A"}},{title:"HSN/SAC",dataIndex:"hsnSac",width:100,align:"center",render:o=>o||"N/A"},{title:"Qty",dataIndex:"quantity",width:80,align:"center",render:o=>parseFloat(o)||0},{title:"Unit Price (₹)",width:140,align:"right",render:(o,a)=>D(a.rate||0)},{title:"Total (₹)",width:140,align:"right",render:(o,a)=>i.jsx(H,{strong:!0,style:{color:"#52c41a"},children:D((a.quantity||0)*(a.rate||0))})}],b=[{title:"Quotation #",dataIndex:"quotationNumber",render:o=>i.jsx(Q,{color:"blue",children:o||"N/A"}),sorter:(o,a)=>(o.quotationNumber||"").localeCompare(a.quotationNumber||"")},{title:"Business",dataIndex:"businessName",sorter:(o,a)=>(o.businessName||"").localeCompare(a.businessName||"")},{title:"Customer",dataIndex:"customerName",render:(o,a)=>{var d,u,M;return i.jsxs("div",{children:[i.jsx("div",{children:((d=a.businessId)==null?void 0:d.contactName)||o||"N/A"}),(((u=a.businessId)==null?void 0:u.email)||a.customerEmail)&&i.jsx("div",{style:{fontSize:12,color:"#666"},children:((M=a.businessId)==null?void 0:M.email)||a.customerEmail})]})},sorter:(o,a)=>{var d,u;return(((d=o.businessId)==null?void 0:d.contactName)||o.customerName||"").localeCompare(((u=a.businessId)==null?void 0:u.contactName)||a.customerName||"")}},{title:"Status",dataIndex:"status",render:o=>{let a="default";return o==="Approved"?a="green":o==="Pending"?a="orange":o==="Rejected"?a="red":o==="Draft"&&(a="blue"),i.jsx(Q,{color:a,children:o||"N/A"})},sorter:(o,a)=>(o.status||"").localeCompare(a.status||"")},{title:"Items Count",render:(o,a)=>{var d,u;return i.jsxs(Q,{color:"geekblue",children:[((d=a.items)==null?void 0:d.length)||0," item",(((u=a.items)==null?void 0:u.length)||0)!==1?"s":""]})}},{title:"Latest Note",dataIndex:"notes",render:o=>{if(o&&o.length>0){const a=o[o.length-1],d=a.text.length>30?`${a.text.substring(0,30)}...`:a.text;return i.jsx(Pe,{title:a.text,children:i.jsx(H,{type:"secondary",children:d})})}return i.jsx(H,{type:"secondary",italic:!0,children:"No notes"})}},{title:"Total (₹)",dataIndex:"total",render:(o,a)=>{var u;const d=parseFloat(o)||((u=a.items)==null?void 0:u.reduce((M,te)=>M+(te.quantity||0)*(te.rate||0),0))||0;return i.jsx(H,{strong:!0,style:{color:"#52c41a"},children:D(d)})},sorter:(o,a)=>{const d=parseFloat(o.total)||0,u=parseFloat(a.total)||0;return d-u}},{title:"Date",dataIndex:"date",render:o=>{if(!o)return"N/A";try{return new Date(o).toLocaleDateString("en-IN")}catch{return o}},sorter:(o,a)=>{const d=new Date(o.date).getTime()||0,u=new Date(a.date).getTime()||0;return d-u}},{title:"Actions",width:80,render:(o,a)=>i.jsx(je,{overlay:i.jsxs(U,{children:[i.jsx(U.Item,{icon:i.jsx(He,{}),onClick:()=>P(a),children:"View Details"},"view"),i.jsx(U.Item,{icon:i.jsx(xe,{}),onClick:()=>ye(a),children:"Download PDF"},"download"),i.jsx(U.Item,{icon:i.jsx(ze,{}),onClick:()=>{z(a),G.success("Opening notes dialog...",{duration:1500})},children:"View/Add Notes"},"notes"),i.jsx(U.Item,{icon:i.jsx(Me,{}),onClick:()=>ee(a),children:"Add/View Follow-ups"},"followups"),i.jsx(U.Item,{icon:i.jsx(Le,{}),onClick:()=>{y(a),G.success("Initiating quotation edit...",{duration:1500})},children:"Edit Quotation"},"edit"),i.jsx(U.Item,{children:i.jsxs($e,{title:"Are you sure you want to delete this account?",onConfirm:()=>L(a._id),okText:"Yes",cancelText:"No",children:[i.jsx(We,{}),"Delete Quotation"]})})]}),trigger:["click"],children:i.jsx(J,{icon:i.jsx(Re,{})})})}];return i.jsxs(i.Fragment,{children:[i.jsxs(Fe,{style:{marginBottom:16,justifyContent:"space-between",width:"100%"},children:[i.jsx(Se.Search,{placeholder:"Search by quotation number, business, customer, or notes...",onChange:o=>{O(o.target.value)},style:{width:400},prefix:i.jsx(ve,{}),allowClear:!0}),i.jsx(J,{type:"primary",onClick:()=>{E(),G.success("Prepare to create a new quotation.",{duration:1500})},children:"+ New Quotation"})]}),i.jsx(V,{columns:b,dataSource:c,rowKey:"_id",loading:R,pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:(o,a)=>`${a[0]}-${a[1]} of ${o} quotations`},scroll:{x:1200}}),i.jsx(Oe,{title:i.jsxs("div",{children:[i.jsx(H,{strong:!0,children:"Quotation Details"}),s&&i.jsx(Q,{color:"blue",style:{marginLeft:8},children:s.quotationNumber})]}),open:t,onCancel:()=>p(!1),footer:[i.jsx(J,{icon:i.jsx(xe,{}),onClick:()=>ye(s),children:"Download PDF"},"download"),i.jsx(J,{onClick:()=>p(!1),children:"Close"},"close")],width:1e3,children:s&&i.jsxs("div",{id:`quotation-modal-preview-${s._id}`,children:[i.jsxs(j,{column:2,bordered:!0,size:"small",children:[i.jsx(j.Item,{label:"Quotation Number",children:i.jsx(Q,{color:"blue",children:s.quotationNumber||"N/A"})}),i.jsx(j.Item,{label:"Date",children:s.date?new Date(s.date).toLocaleDateString("en-IN"):"N/A"}),i.jsxs(j.Item,{label:"Status",children:[" ",i.jsx(Q,{color:s.status==="Approved"?"green":s.status==="Pending"?"orange":s.status==="Rejected"?"red":"blue",className:"rounded-full px-3 py-1 text-sm font-medium",children:s.status||"N/A"})]}),i.jsx(j.Item,{label:"Business Name",children:s.businessName||"N/A"}),i.jsx(j.Item,{label:"Contact Person",children:((I=s.businessId)==null?void 0:I.contactName)||s.customerName||"N/A"}),i.jsx(j.Item,{label:"Customer Email",children:((g=s.businessId)==null?void 0:g.email)||s.customerEmail||"N/A"}),i.jsx(j.Item,{label:"Mobile Number",children:s.mobileNumber||((l=s.businessId)==null?void 0:l.mobileNumber)||((r=s.businessId)==null?void 0:r.phone)||"N/A"}),i.jsx(j.Item,{label:"GSTIN",children:i.jsx(H,{code:!0,children:s.gstin||"N/A"})}),i.jsx(j.Item,{label:"Business Info",span:2,children:i.jsx(H,{style:{whiteSpace:"pre-wrap"},children:s.businessInfo||"N/A"})}),i.jsx(j.Item,{label:"Total Amount",span:2,children:i.jsx(H,{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:D(s.total||((f=s.items)==null?void 0:f.reduce((o,a)=>o+(a.quantity||0)*(a.rate||0),0))||0)})})]}),((h=s.items)==null?void 0:h.length)>0&&i.jsxs(i.Fragment,{children:[i.jsxs(me,{orientation:"left",children:["Items (",s.items.length,")"]}),i.jsx(V,{dataSource:s.items,columns:Y(),pagination:!1,size:"small",rowKey:(o,a)=>`${s._id}-item-${a}`,bordered:!0,expandable:{expandedRowRender:o=>{var a;return i.jsx("div",{style:{margin:0,padding:0},children:((a=o.specifications)==null?void 0:a.length)>0&&i.jsx(j,{column:1,size:"small",children:o.specifications.filter(d=>d.name!=="SPECIFICATION").map((d,u)=>i.jsx(j.Item,{label:d.name,children:d.value},u))})})},rowExpandable:o=>{var a;return((a=o.specifications)==null?void 0:a.length)>0}},summary:o=>{const a=o.reduce((d,u)=>d+(u.quantity||0)*(u.rate||0),0);return i.jsx(V.Summary,{fixed:!0,children:i.jsxs(V.Summary.Row,{children:[i.jsxs(V.Summary.Cell,{index:0,colSpan:6,children:[" ",i.jsx(H,{strong:!0,children:"Grand Total:"})]}),i.jsxs(V.Summary.Cell,{index:6,children:[" ",i.jsx(H,{strong:!0,style:{color:"#52c41a"},children:D(a)})]})]})})}})]}),((T=s.notes)==null?void 0:T.length)>0&&i.jsxs(i.Fragment,{children:[i.jsxs(me,{orientation:"left",children:["Notes (",s.notes.length,")"]}),s.notes.map((o,a)=>i.jsxs("div",{style:{marginBottom:12,padding:8,background:"#f5f5f5",borderRadius:4},children:[i.jsxs(H,{italic:!0,children:['"',o.text,'"']}),i.jsx("br",{}),i.jsxs(H,{type:"secondary",style:{fontSize:"0.8em"},children:["— ",o.author," on"," ",o.timestamp||new Date(s.createdAt).toLocaleDateString("en-IN")]})]},a))]})]})}),s&&i.jsx(qe,{visible:x,onClose:()=>w(!1),quotation:s,refreshQuotations:A})]})};export{Pt as default};
