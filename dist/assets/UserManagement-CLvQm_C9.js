import{r as j,I as W,e as X,x as a,B as x,H as ee,V as p}from"./index-3j2E7pUL.js";import{i as g}from"./axios-CSlAuMiO.js";import{F as s}from"./index-jd3XYpcD.js";import{S as h}from"./index-DiojptZP.js";import{F as ae}from"./Table-HKvwWm1_.js";import{D as q}from"./index-DVSodFTC.js";import{I as w}from"./index-CsUGJ7YV.js";import{R as te}from"./EditOutlined-0_cnfjzU.js";import{R as re}from"./SwapOutlined-CsU7PVtz.js";import{P as le}from"./index-CFb1Uy8W.js";import{R as se}from"./DeleteOutlined-BAvkxAoL.js";import"./row-BatVd8KW.js";import"./TextArea-DELUlYzR.js";import"./styleChecker-D89VOBbV.js";import"./addEventListener-BJarX3AI.js";import"./index-CfNZZRpy.js";import"./Pagination-Buu9EMH_.js";import"./extendsObject-78o_rR5W.js";import"./context-DJnMqWkY.js";import"./useClosable-CC1Ls4ip.js";import"./ActionButton-RId_fRI3.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},ie=function(v,_){return j.createElement(W,X({},v,{ref:_,icon:ne}))},de=j.forwardRef(ie);const{Option:u}=h,De=({users:S,departments:v,teams:_,zones:A,fetchUsers:T,fetchDepartments:k,fetchTeams:D,loading:L})=>{var E,R,Z;const[M,b]=j.useState(!1),[r,O]=j.useState(null),[y]=s.useForm(),[P,I]=j.useState(!1),[o,B]=j.useState(null),[F]=s.useForm(),[N,V]=j.useState(null),n=JSON.parse(localStorage.getItem("user")),d=(n==null?void 0:n.role)==="Superadmin",c=(n==null?void 0:n.role)==="Admin",f=(n==null?void 0:n.role)==="Team Leader";j.useEffect(()=>{},[]);const U=N?S.filter(e=>{var t;return((t=e.zone)==null?void 0:t._id)===N}):S,z=()=>{O(null),y.resetFields(),y.setFieldsValue({role:"Employee",status:"Active"}),b(!0)},H=e=>{var t,l,m;O(e),y.setFieldsValue({name:e.name,email:e.email,mobile:e.mobile,role:e.role,status:e.status,department:(t=e.department)==null?void 0:t._id,team:(l=e.team)==null?void 0:l._id,zone:(m=e.zone)==null?void 0:m._id}),b(!0)},J=async()=>{var e,t,l,m;try{const i=await y.validateFields();if(r&&!i.password&&delete i.password,f&&r){if(i.role!==r.role){p.error("Team Leaders cannot change user roles.");return}if(i.department!==((e=r.department)==null?void 0:e._id)){p.error("Team Leaders cannot change user departments.");return}if(i.team!==((t=r.team)==null?void 0:t._id)){p.error("Team Leaders cannot change user teams.");return}}r?(await g.put(`/api/users/${r._id}`,i),p.success("User updated successfully")):(await g.post("/api/users",i),p.success("User created successfully")),b(!1),T(),(d||c)&&(D(),k())}catch(i){console.error(i),p.error(((m=(l=i==null?void 0:i.response)==null?void 0:l.data)==null?void 0:m.message)||"Failed to submit user")}},K=async e=>{var t,l;try{if((d||c)&&n._id===e){p.error("You cannot delete your own account.");return}await g.delete(`/api/users/${e}`),p.success("User deleted"),T(),(d||c)&&(D(),k())}catch(m){p.error(((l=(t=m==null?void 0:m.response)==null?void 0:t.data)==null?void 0:l.message)||"Delete failed")}},Y=e=>{var t,l,m,i,C,$;B(e),F.setFieldsValue({currentDepartment:(t=e.department)==null?void 0:t.name,currentTeam:(l=e.team)==null?void 0:l.name,currentZone:((m=e.zone)==null?void 0:m.name)||"N/A",newDepartment:(i=e.department)==null?void 0:i._id,newTeam:(C=e.team)==null?void 0:C._id,newZone:($=e.zone)==null?void 0:$._id}),I(!0)},G=async()=>{var e,t;try{const l=await F.validateFields(),{newDepartment:m,newTeam:i,newZone:C}=l;await g.put(`/api/users/transfer/${o._id}`,{newDepartmentId:m,newTeamId:i,newZoneId:C}),p.success(`${o.name} transferred successfully`),I(!1),T(),D(),k()}catch(l){console.error("Transfer error:",l),p.error(((t=(e=l==null?void 0:l.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to transfer user")}},Q=[{title:"Name",dataIndex:"name",key:"name"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile",dataIndex:"mobile",key:"mobile"},{title:"Role",dataIndex:"role",key:"role"},{title:"Status",dataIndex:"status",key:"status"},{title:"Department",dataIndex:"department",key:"department",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Team",dataIndex:"team",key:"team",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Zone",dataIndex:"zone",key:"zone",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Actions",key:"actions",render:(e,t)=>{var l;return a.jsxs(ee,{children:[(d||c||f&&n.team===((l=t.team)==null?void 0:l._id))&&a.jsx(x,{icon:a.jsx(te,{}),onClick:()=>H(t)}),(d||c)&&a.jsx(x,{icon:a.jsx(re,{}),onClick:()=>Y(t),title:"Transfer User to another Team/Department/Zone"}),(d||c)&&a.jsx(le,{title:"Delete this user?",onConfirm:()=>K(t._id),disabled:n._id===t._id,children:a.jsx(x,{danger:!0,icon:a.jsx(se,{}),disabled:n._id===t._id})})]})}}];return a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[a.jsx("h2",{children:"User Management"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(d||c)&&a.jsx(h,{placeholder:"Filter by Zone",allowClear:!0,style:{width:200},onChange:e=>V(e),value:N,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))}),(d||c)&&a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:a.jsx(de,{}),onClick:z,children:"Create User"})]})]}),a.jsx(ae,{columns:Q,dataSource:U,loading:L,rowKey:"_id",bordered:!0}),a.jsx(q,{title:r?"Edit User":"Create User",open:M,onClose:()=>b(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx(x,{onClick:()=>b(!1),style:{marginRight:8},children:"Cancel"}),a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:J,children:r?"Update":"Create"})]}),children:a.jsxs(s,{form:y,layout:"vertical",children:[a.jsx(s.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:a.jsx(w,{disabled:f&&r&&n._id!==r._id})}),a.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Invalid email format"}],children:a.jsx(w,{disabled:f&&r&&n._id!==r._id})}),a.jsx(s.Item,{name:"mobile",label:"Mobile",children:a.jsx(w,{disabled:f&&r&&n._id!==r._id})}),(!r&&(d||c)||r&&(d||c))&&a.jsx(s.Item,{name:"password",label:"Password",rules:r?[]:[{required:!0,message:"Password is required"}],children:a.jsx(w.Password,{placeholder:r?"Leave blank to keep current password":""})}),a.jsx(s.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:a.jsxs(h,{placeholder:"Select role",disabled:f&&r&&n._id!==r._id,children:[a.jsx(u,{value:"Superadmin",disabled:!d,children:"Superadmin"}),a.jsx(u,{value:"Admin",disabled:!d,children:"Admin"}),a.jsx(u,{value:"Team Leader",children:"Team Leader"}),a.jsx(u,{value:"Employee",children:"Employee"})]})}),a.jsx(s.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:a.jsxs(h,{placeholder:"Select status",disabled:f&&r&&n._id!==r._id,children:[a.jsx(u,{value:"Active",children:"Active"}),a.jsx(u,{value:"Inactive",children:"Inactive"})]})}),(d||c)&&a.jsx(s.Item,{name:"department",label:"Department",children:a.jsx(h,{placeholder:"Select department",allowClear:!0,children:v.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})}),(d||c)&&a.jsx(s.Item,{name:"team",label:"Team",children:a.jsx(h,{placeholder:"Select team",allowClear:!0,children:_.map(e=>{var t;return a.jsxs(u,{value:e._id,children:[e.name," (",((t=e.department)==null?void 0:t.name)||"N/A",")"]},e._id)})})}),(d||c)&&a.jsx(s.Item,{name:"zone",label:"Zone",children:a.jsx(h,{placeholder:"Select zone",allowClear:!0,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})})]})}),a.jsx(q,{title:`Transfer User: ${o==null?void 0:o.name}`,open:P,onClose:()=>I(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx(x,{onClick:()=>I(!1),style:{marginRight:8},children:"Cancel"}),a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:G,children:"Transfer"})]}),children:a.jsxs(s,{form:F,layout:"vertical",children:[a.jsx(s.Item,{label:"Current Department",children:a.jsx(w,{value:((E=o==null?void 0:o.department)==null?void 0:E.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{label:"Current Team",children:a.jsx(w,{value:((R=o==null?void 0:o.team)==null?void 0:R.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{label:"Current Zone",children:a.jsx(w,{value:((Z=o==null?void 0:o.zone)==null?void 0:Z.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{name:"newDepartment",label:"New Department (Optional)",children:a.jsx(h,{placeholder:"Select new department",allowClear:!0,children:v.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})}),a.jsx(s.Item,{name:"newTeam",label:"New Team (Optional)",children:a.jsx(h,{placeholder:"Select new team",allowClear:!0,children:_.map(e=>{var t;return a.jsxs(u,{value:e._id,children:[e.name," (",((t=e.department)==null?void 0:t.name)||"N/A",")"]},e._id)})})}),a.jsx(s.Item,{name:"newZone",label:"New Zone (Optional)",children:a.jsx(h,{placeholder:"Select new zone",allowClear:!0,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})})]})})]})};export{De as default};
