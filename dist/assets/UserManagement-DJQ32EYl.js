import{r as j,I as Q,k as W,X as s,U as a,S as h,a0 as x,a2 as ee,aC as q,a4 as b,ao as ae,aa as le,ar as p,a6 as g}from"./index-CDYSMnhF.js";import{R as te}from"./SwapOutlined-BYJgKaZ8.js";import{P as re}from"./index-BaWZJApH.js";import{R as se}from"./DeleteOutlined-C8bxn61I.js";var ne={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M678.3 642.4c24.2-13 51.9-20.4 81.4-20.4h.1c3 0 4.4-3.6 2.2-5.6a371.67 371.67 0 00-103.7-65.8c-.4-.2-.8-.3-1.2-.5C719.2 505 759.6 431.7 759.6 349c0-137-110.8-248-247.5-248S264.7 212 264.7 349c0 82.7 40.4 156 102.6 201.1-.4.2-.8.3-1.2.5-44.7 18.9-84.8 46-119.3 80.6a373.42 373.42 0 00-80.4 119.5A373.6 373.6 0 00137 888.8a8 8 0 008 8.2h59.9c4.3 0 7.9-3.5 8-7.8 2-77.2 32.9-149.5 87.6-204.3C357 628.2 432.2 597 512.2 597c56.7 0 111.1 15.7 158 45.1a8.1 8.1 0 008.1.3zM512.2 521c-45.8 0-88.9-17.9-121.4-50.4A171.2 171.2 0 01340.5 349c0-45.9 17.9-89.1 50.3-121.6S466.3 177 512.2 177s88.9 17.9 121.4 50.4A171.2 171.2 0 01683.9 349c0 45.9-17.9 89.1-50.3 121.6C601.1 503.1 558 521 512.2 521zM880 759h-84v-84c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v84h-84c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h84v84c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-84h84c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"user-add",theme:"outlined"},ie=function(v,_){return j.createElement(Q,W({},v,{ref:_,icon:ne}))},de=j.forwardRef(ie);const{Option:u}=h,pe=({users:S,departments:v,teams:_,zones:A,fetchUsers:T,fetchDepartments:k,fetchTeams:D,loading:L})=>{var E,Z,R;const[M,f]=j.useState(!1),[t,O]=j.useState(null),[y]=s.useForm(),[P,C]=j.useState(!1),[o,B]=j.useState(null),[F]=s.useForm(),[N,U]=j.useState(null),n=JSON.parse(localStorage.getItem("user")),d=(n==null?void 0:n.role)==="Superadmin",m=(n==null?void 0:n.role)==="Admin",w=(n==null?void 0:n.role)==="Team Leader";j.useEffect(()=>{},[]);const V=N?S.filter(e=>{var l;return((l=e.zone)==null?void 0:l._id)===N}):S,z=()=>{O(null),y.resetFields(),y.setFieldsValue({role:"Employee",status:"Active"}),f(!0)},J=e=>{var l,r,c;O(e),y.setFieldsValue({name:e.name,email:e.email,mobile:e.mobile,role:e.role,status:e.status,department:(l=e.department)==null?void 0:l._id,team:(r=e.team)==null?void 0:r._id,zone:(c=e.zone)==null?void 0:c._id}),f(!0)},K=async()=>{var e,l,r,c;try{const i=await y.validateFields();if(t&&!i.password&&delete i.password,w&&t){if(i.role!==t.role){p.error("Team Leaders cannot change user roles.");return}if(i.department!==((e=t.department)==null?void 0:e._id)){p.error("Team Leaders cannot change user departments.");return}if(i.team!==((l=t.team)==null?void 0:l._id)){p.error("Team Leaders cannot change user teams.");return}}t?(await g.put(`/api/users/${t._id}`,i),p.success("User updated successfully")):(await g.post("/api/users",i),p.success("User created successfully")),f(!1),T(),(d||m)&&(D(),k())}catch(i){console.error(i),p.error(((c=(r=i==null?void 0:i.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to submit user")}},X=async e=>{var l,r;try{if((d||m)&&n._id===e){p.error("You cannot delete your own account.");return}await g.delete(`/api/users/${e}`),p.success("User deleted"),T(),(d||m)&&(D(),k())}catch(c){p.error(((r=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:r.message)||"Delete failed")}},Y=e=>{var l,r,c,i,I,$;B(e),F.setFieldsValue({currentDepartment:(l=e.department)==null?void 0:l.name,currentTeam:(r=e.team)==null?void 0:r.name,currentZone:((c=e.zone)==null?void 0:c.name)||"N/A",newDepartment:(i=e.department)==null?void 0:i._id,newTeam:(I=e.team)==null?void 0:I._id,newZone:($=e.zone)==null?void 0:$._id}),C(!0)},G=async()=>{var e,l;try{const r=await F.validateFields(),{newDepartment:c,newTeam:i,newZone:I}=r;await g.put(`/api/users/transfer/${o._id}`,{newDepartmentId:c,newTeamId:i,newZoneId:I}),p.success(`${o.name} transferred successfully`),C(!1),T(),D(),k()}catch(r){console.error("Transfer error:",r),p.error(((l=(e=r==null?void 0:r.response)==null?void 0:e.data)==null?void 0:l.message)||"Failed to transfer user")}},H=[{title:"Name",dataIndex:"name",key:"name"},{title:"Email",dataIndex:"email",key:"email"},{title:"Mobile",dataIndex:"mobile",key:"mobile"},{title:"Role",dataIndex:"role",key:"role"},{title:"Status",dataIndex:"status",key:"status"},{title:"Department",dataIndex:"department",key:"department",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Team",dataIndex:"team",key:"team",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Zone",dataIndex:"zone",key:"zone",render:e=>(e==null?void 0:e.name)||"N/A"},{title:"Actions",key:"actions",render:(e,l)=>{var r;return a.jsxs(ae,{children:[(d||m||w&&n.team===((r=l.team)==null?void 0:r._id))&&a.jsx(x,{icon:a.jsx(le,{}),onClick:()=>J(l)}),(d||m)&&a.jsx(x,{icon:a.jsx(te,{}),onClick:()=>Y(l),title:"Transfer User to another Team/Department/Zone"}),(d||m)&&a.jsx(re,{title:"Delete this user?",onConfirm:()=>X(l._id),disabled:n._id===l._id,children:a.jsx(x,{danger:!0,icon:a.jsx(se,{}),disabled:n._id===l._id})})]})}}];return a.jsxs(a.Fragment,{children:[a.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[a.jsx("h2",{children:"User Management"}),a.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"16px"},children:[(d||m)&&a.jsx(h,{placeholder:"Filter by Zone",allowClear:!0,style:{width:200},onChange:e=>U(e),value:N,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))}),(d||m)&&a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},icon:a.jsx(de,{}),onClick:z,children:"Create User"})]})]}),a.jsx(ee,{columns:H,dataSource:V,loading:L,rowKey:"_id",bordered:!0}),a.jsx(q,{title:t?"Edit User":"Create User",open:M,onClose:()=>f(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx(x,{onClick:()=>f(!1),style:{marginRight:8},children:"Cancel"}),a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:K,children:t?"Update":"Create"})]}),children:a.jsxs(s,{form:y,layout:"vertical",children:[a.jsx(s.Item,{name:"name",label:"Name",rules:[{required:!0,message:"Name is required"}],children:a.jsx(b,{disabled:w&&t&&n._id!==t._id})}),a.jsx(s.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email is required"},{type:"email",message:"Invalid email format"}],children:a.jsx(b,{disabled:w&&t&&n._id!==t._id})}),a.jsx(s.Item,{name:"mobile",label:"Mobile",children:a.jsx(b,{disabled:w&&t&&n._id!==t._id})}),(!t&&(d||m)||t&&(d||m))&&a.jsx(s.Item,{name:"password",label:"Password",rules:t?[]:[{required:!0,message:"Password is required"}],children:a.jsx(b.Password,{placeholder:t?"Leave blank to keep current password":""})}),a.jsx(s.Item,{name:"role",label:"Role",rules:[{required:!0,message:"Please select a role"}],children:a.jsxs(h,{placeholder:"Select role",disabled:w&&t&&n._id!==t._id,children:[a.jsx(u,{value:"Superadmin",disabled:!d,children:"Superadmin"}),a.jsx(u,{value:"Admin",disabled:!d,children:"Admin"}),a.jsx(u,{value:"Team Leader",children:"Team Leader"}),a.jsx(u,{value:"Employee",children:"Employee"})]})}),a.jsx(s.Item,{name:"status",label:"Status",rules:[{required:!0,message:"Please select status"}],children:a.jsxs(h,{placeholder:"Select status",disabled:w&&t&&n._id!==t._id,children:[a.jsx(u,{value:"Active",children:"Active"}),a.jsx(u,{value:"Inactive",children:"Inactive"})]})}),(d||m)&&a.jsx(s.Item,{name:"department",label:"Department",children:a.jsx(h,{placeholder:"Select department",allowClear:!0,children:v.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})}),(d||m)&&a.jsx(s.Item,{name:"team",label:"Team",children:a.jsx(h,{placeholder:"Select team",allowClear:!0,children:_.map(e=>{var l;return a.jsxs(u,{value:e._id,children:[e.name," (",((l=e.department)==null?void 0:l.name)||"N/A",")"]},e._id)})})}),(d||m)&&a.jsx(s.Item,{name:"zone",label:"Zone",children:a.jsx(h,{placeholder:"Select zone",allowClear:!0,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})})]})}),a.jsx(q,{title:`Transfer User: ${o==null?void 0:o.name}`,open:P,onClose:()=>C(!1),width:420,destroyOnClose:!0,styles:{body:{paddingBottom:80}},footer:a.jsxs("div",{style:{textAlign:"right"},children:[a.jsx(x,{onClick:()=>C(!1),style:{marginRight:8},children:"Cancel"}),a.jsx(x,{type:"primary",style:{backgroundColor:"#ef7a1b",borderColor:"#orange",color:"white"},onClick:G,children:"Transfer"})]}),children:a.jsxs(s,{form:F,layout:"vertical",children:[a.jsx(s.Item,{label:"Current Department",children:a.jsx(b,{value:((E=o==null?void 0:o.department)==null?void 0:E.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{label:"Current Team",children:a.jsx(b,{value:((Z=o==null?void 0:o.team)==null?void 0:Z.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{label:"Current Zone",children:a.jsx(b,{value:((R=o==null?void 0:o.zone)==null?void 0:R.name)||"N/A",disabled:!0})}),a.jsx(s.Item,{name:"newDepartment",label:"New Department (Optional)",children:a.jsx(h,{placeholder:"Select new department",allowClear:!0,children:v.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})}),a.jsx(s.Item,{name:"newTeam",label:"New Team (Optional)",children:a.jsx(h,{placeholder:"Select new team",allowClear:!0,children:_.map(e=>{var l;return a.jsxs(u,{value:e._id,children:[e.name," (",((l=e.department)==null?void 0:l.name)||"N/A",")"]},e._id)})})}),a.jsx(s.Item,{name:"newZone",label:"New Zone (Optional)",children:a.jsx(h,{placeholder:"Select new zone",allowClear:!0,children:A.map(e=>a.jsx(u,{value:e._id,children:e.name},e._id))})})]})})]})};export{pe as default};
